{"ast":null,"code":"import _classCallCheck from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/andrew/code/yb-architecture/animations/src/LeaderLeasesAnimation.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport anime from 'animejs/lib/anime.es.js';\nimport MainDiagram from './svg/MainDiagram';\nimport { Constants } from './constants';\n\nvar HelperFunctions = require('./HelperFunctions');\n\nvar ANIMATION_STATE_INITIAL = \"LEADER_LEASE_INITIAL\";\nvar ANIMATION_STATE_INTRODUCTION_MADE = \"ANIMATION_STATE_INTRODUCTION_MADE\";\nvar ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS = \"ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS\";\nvar ANIMATION_STATE_CLIENT_WROTE_TO_ORIGINAL_LEADER = \"ANIMATION_STATE_CLIENT_WROTE_TO_ORIGINAL_LEADER\";\nvar ANIMATION_STATE_VALUE1_COMMITTED = \"ANIMATION_STATE_VALUE1_COMMITTED\";\nvar ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED = \"ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED\";\nvar ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED = \"ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED\";\nvar ANIMATION_STATE_NEW_LEADER_ELECTED = \"ANIMATION_STATE_NEW_LEADER_ELECTED\";\nvar ANIMATION_STATE_TIMER_STARTED_ON_ORIGINAL_LEADER = \"ANIMATION_STATE_TIMER_STARTED_ON_ORIGINAL_LEADER\";\nvar ANIMATION_STATE_TIMER_STARTED_ON_NEW_LEADER = \"ANIMATION_STATE_TIMER_STARTED_ON_NEW_LEADER\";\nvar ANIMATION_STATE_POST_NEW_LEADER_VALUE2_COMMITTED = \"ANIMATION_STATE_POST_NEW_LEADER_VALUE2_COMMITTED\";\nvar ANIMATION_STATE_POST_NEW_LEADER_LOG_ACK_RECEIVED_FROM_FOLLOWER = \"ANIMATION_STATE_POST_NEW_LEADER_LOG_ACK_RECEIVED_FROM_FOLLOWER\";\nvar ANIMATION_STATE_NEW_LEADER_SENT_LEASES = \"ANIMATION_STATE_NEW_LEADER_SENT_LEASES\";\nvar SET_VALUE1 = \"V1\";\nvar SET_VALUE2 = \"V2\";\nvar ORIGINAL_LEADER_TIMER_DURATION = 9000;\nvar NODE_A_TIMER_DURATION = 14000;\nvar NODE_B_TIMER_DURATION = 30000;\nexport var LeaderLeaseAnimation =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(LeaderLeaseAnimation, _Component);\n\n  function LeaderLeaseAnimation(props) {\n    var _this;\n\n    _classCallCheck(this, LeaderLeaseAnimation);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(LeaderLeaseAnimation).call(this, props));\n    _this.state = {};\n\n    _this.init();\n\n    return _this;\n  }\n\n  _createClass(LeaderLeaseAnimation, [{\n    key: \"init\",\n    value: function init() {\n      this.animationState = ANIMATION_STATE_INITIAL;\n      this.nodeATimerAnimation = null;\n      this.nodeBTimerAnimation = null;\n      this.nodeCTimerAnimation = null;\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.mainTextSect = document.getElementById('main-text-sect');\n      this.timersAreActive = false;\n    }\n  }, {\n    key: \"pause\",\n    value: function pause() {\n      if (this.timersAreActive) {\n        this.pauseTimers();\n      }\n    }\n  }, {\n    key: \"resume\",\n    value: function resume() {\n      if (this.timersAreActive) {\n        this.resumeTimers();\n      }\n    }\n  }, {\n    key: \"onNext\",\n    value: function onNext() {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this2.onNextInternal(resolve, reject);\n      });\n    }\n  }, {\n    key: \"onNextInternal\",\n    value: function onNextInternal(resolve, reject) {\n      var _this3 = this;\n\n      switch (this.animationState) {\n        case ANIMATION_STATE_INITIAL:\n          {\n            //////////////////// initial setup ////////////////////\n            // hide all outer circles (TODO: revisit this approach)\n            var nodeOuterCircles = document.getElementsByClassName('node-outer-circle');\n\n            for (var i = 0; i < nodeOuterCircles.length; i++) {\n              HelperFunctions.hideElement(nodeOuterCircles[i]);\n            } // make Node C  the leader\n\n\n            var nodeC = document.getElementById('node-c-circle');\n            nodeC.classList.add('leader-node'); //////////////////////////////////////////////////////\n\n            this.changeMainText('Read-problem solution in YugaByte DB...', function () {\n              _this3.animationState = ANIMATION_STATE_INTRODUCTION_MADE;\n              resolve({\n                animationState: _this3.animationState,\n                delay: 1000\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_INTRODUCTION_MADE:\n          {\n            this.changeMainText('Leader replicates a lease interval to followers', function () {\n              _this3.timersAreActive = true; // this.nodeCTimerAnimation = HelperFunctions.startLeaseTimer(Constants.NODE_C, ORIGINAL_LEADER_TIMER_DURATION);\n\n              _this3.nodeCTimerAnimation = HelperFunctions.startMyLeaseTimer(Constants.NODE_C, ORIGINAL_LEADER_TIMER_DURATION);\n              var leaseToA = document.getElementById('node-c-lease-to-node-a');\n              var nodeALeaseAnimation = anime({\n                targets: leaseToA,\n                translateX: -280,\n                translateY: 0,\n                easing: 'linear',\n                duration: 1500,\n                begin: function begin() {\n                  HelperFunctions.showElement(leaseToA);\n                },\n                complete: function complete() {\n                  HelperFunctions.hideElement(leaseToA);\n                  leaseToA.style.transform = 'none';\n                }\n              });\n              var leaseToB = document.getElementById('node-c-lease-to-node-b');\n              var nodeBLeaseAnimation = anime({\n                targets: leaseToB,\n                translateX: -150,\n                translateY: -280,\n                easing: 'linear',\n                duration: 1500,\n                begin: function begin() {\n                  HelperFunctions.showElement(leaseToB);\n                },\n                complete: function complete() {\n                  HelperFunctions.hideElement(leaseToB);\n                  leaseToB.style.transform = 'none';\n                }\n              });\n              Promise.all([nodeALeaseAnimation.finished, nodeBLeaseAnimation.finished]).then(function () {\n                // this.startTimers();\n                _this3.nodeATimerAnimation = HelperFunctions.startLeaderLeaseTimer(Constants.NODE_A, NODE_A_TIMER_DURATION);\n                _this3.nodeBTimerAnimation = HelperFunctions.startLeaderLeaseTimer(Constants.NODE_B, NODE_B_TIMER_DURATION);\n                _this3.animationState = ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS;\n                resolve({\n                  animationState: _this3.animationState,\n                  delay: 500\n                });\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS:\n          {\n            this.changeMainText('Client arrives and performs a write', function () {\n              var introduceClientAnimation = HelperFunctions.introduceClient(\"Value: \".concat(SET_VALUE1));\n              introduceClientAnimation.finished.then(function () {\n                var writeAnimation = HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_C, false, HelperFunctions.getSetValueText(SET_VALUE1), false, 0);\n                writeAnimation.finished.then(function () {\n                  _this3.animationState = ANIMATION_STATE_CLIENT_WROTE_TO_ORIGINAL_LEADER;\n                  resolve({\n                    animationState: _this3.animationState,\n                    delay: 1000\n                  });\n                });\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_CLIENT_WROTE_TO_ORIGINAL_LEADER:\n          {\n            this.changeMainText('This starts a raft round to commit value to all nodes', function () {\n              var messageToFollowerAnimations = HelperFunctions.logMessageFromLeaderToFollowers(true, HelperFunctions.getSetValueText(SET_VALUE1), false, 0, _this3.nodeATimerAnimation, _this3.nodeBTimerAnimation, _this3.nodeCTimerAnimation);\n              var finishedPromises = HelperFunctions.getFinishPromises(messageToFollowerAnimations);\n              Promise.all(finishedPromises).then(function () {\n                HelperFunctions.setSVGText({\n                  targetId: \"node-c-main-text\",\n                  text: SET_VALUE1,\n                  showElement: true\n                }); // send confirmation of write to followers\n\n                var confWriteToFollowersAnimation = HelperFunctions.logMessageFromLeaderToFollowers(false, HelperFunctions.getSetValueText(SET_VALUE1), true, 600, _this3.nodeATimerAnimation, _this3.nodeBTimerAnimation);\n                finishedPromises = HelperFunctions.getFinishPromises(confWriteToFollowersAnimation); // and notify client as well\n\n                HelperFunctions.sendLogMessage(Constants.NODE_C, Constants.CLIENT_NODE); // wait for confirmation to reach followers\n\n                Promise.all(finishedPromises).then(function () {\n                  // commit value on followers\n                  HelperFunctions.setSVGText({\n                    targetId: \"node-a-main-text\",\n                    text: SET_VALUE1,\n                    showElement: true\n                  });\n                  HelperFunctions.setSVGText({\n                    targetId: \"node-b-main-text\",\n                    text: SET_VALUE1,\n                    showElement: true\n                  });\n                  _this3.animationState = ANIMATION_STATE_VALUE1_COMMITTED;\n                  resolve({\n                    animationState: _this3.animationState,\n                    delay: 1000\n                  });\n                });\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_VALUE1_COMMITTED:\n          {\n            this.changeMainText('Now suppose the original leader gets network partitioned', function () {\n              // partition original leader\n              HelperFunctions.partitionNodeC();\n              _this3.animationState = ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED;\n              resolve({\n                animationState: _this3.animationState,\n                delay: 100\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED:\n          {\n            this.changeMainText('And Node A gets elected as the new leader', function () {\n              // elect Node A as new leader candidate\n              var nodeA = document.getElementById('node-a-circle');\n              nodeA.classList.add('leader-candidate-node');\n              HelperFunctions.setSVGText({\n                targetId: 'node-a-term-text',\n                text: \"Term: 1\"\n              });\n              HelperFunctions.setSVGText({\n                targetId: 'node-b-term-text',\n                text: \"Term: 1\"\n              });\n              _this3.animationState = ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED;\n              resolve({\n                animationState: _this3.animationState,\n                delay: 1000\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED:\n          {\n            this.changeMainText('Client tries to write to new leader but update fails, as old leader can still serve reads', function () {\n              _this3.resumeTimers();\n\n              HelperFunctions.setSVGText({\n                targetId: 'client-node-main-text',\n                text: SET_VALUE2\n              });\n              var messageContrainerElement = document.getElementById('client-message');\n              var messageElement = document.getElementById('client-message-circle');\n              var messageTextElement = document.getElementById('client-message-text');\n              HelperFunctions.messageFromClient(Constants.NODE_A, {\n                onBegin: function onBegin() {\n                  HelperFunctions.showElement(messageContrainerElement);\n                  messageElement.classList.add('log-message');\n                  HelperFunctions.setSVGText({\n                    targetId: 'client-message-text',\n                    text: ''\n                  });\n                },\n                onChangeComplete: function onChangeComplete() {\n                  messageElement.classList.remove('log-message');\n                  messageElement.classList.add('error-message');\n                  HelperFunctions.setSVGText({\n                    targetId: 'client-message-text',\n                    text: 'Rejected'\n                  }); // messageTextElement\n                },\n                onComplete: function onComplete() {\n                  messageElement.classList.remove('error-message');\n                  HelperFunctions.hideElement(messageContrainerElement);\n                  messageContrainerElement.style.transform = 'none';\n                  HelperFunctions.setSVGText({\n                    targetId: 'client-message-text',\n                    text: ''\n                  });\n                },\n                alternate: true\n              });\n\n              _this3.nodeCTimerAnimation.finished.then(function () {\n                _this3.nodeCTimerAnimation = null;\n\n                _this3.changeMainText(\"Original leader lease time has expired and it has stepped downed\");\n\n                var nodeC = document.getElementById('node-c-circle');\n                nodeC.classList.remove('leader-node');\n              });\n\n              _this3.nodeATimerAnimation.finished.then(function () {\n                var nodeA = document.getElementById('node-a-circle');\n                nodeA.classList.remove('leader-candidate-node');\n                nodeA.classList.add('leader-node');\n\n                _this3.changeMainText(\"Node A's leader lease timer has expired as well and has become the new leader now\", function () {\n                  _this3.pauseTimers();\n\n                  _this3.animationState = ANIMATION_STATE_NEW_LEADER_ELECTED; // Make sure we perform next before the new leader's timer expires\n\n                  resolve({\n                    animationState: _this3.animationState,\n                    delay: 100\n                  });\n                }, 0);\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_NEW_LEADER_ELECTED:\n          {\n            // hide Node A's leader lease timer\n            HelperFunctions.hideElement(document.getElementById(HelperFunctions.leaderLeaseTimerId(Constants.NODE_A))); // and start its my lease timer\n\n            this.nodeATimerAnimation = HelperFunctions.startMyLeaseTimer(Constants.NODE_A, NODE_A_TIMER_DURATION); // then send leader lease message to B\n\n            var leaseToB = document.getElementById('node-a-lease-to-node-b');\n            var nodeBLeaseAnimation = anime({\n              targets: leaseToB,\n              translateX: 150,\n              translateY: -280,\n              easing: 'linear',\n              duration: 1500,\n              begin: function begin() {\n                HelperFunctions.showElement(leaseToB);\n              },\n              complete: function complete() {\n                HelperFunctions.hideElement(leaseToB);\n                leaseToB.style.transform = 'none';\n\n                _this3.nodeBTimerAnimation.restart();\n\n                _this3.animationState = ANIMATION_STATE_NEW_LEADER_SENT_LEASES;\n                resolve({\n                  animationState: _this3.animationState,\n                  delay: 100\n                });\n              }\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_NEW_LEADER_SENT_LEASES:\n          {\n            this.changeMainText(\"From here on, client can write messages to the new leader\", function () {\n              // initiate a raft round\n              // client message to A\n              var animation = HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_A, false, HelperFunctions.getSetValueText(SET_VALUE2), false, 0);\n              animation.finished.then(function () {\n                // message with ack from A to B\n                var messageToBAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, true, HelperFunctions.getSetValueText(SET_VALUE2), false, 0, _this3.nodeBTimerAnimation, _this3.nodeATimerAnimation);\n                messageToBAnimation.finished.then(function () {\n                  HelperFunctions.setSVGText({\n                    targetId: 'node-a-main-text',\n                    text: SET_VALUE2\n                  }); // confirmation message back to B and the client\n\n                  var confirmToClientAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.CLIENT_NODE, false, HelperFunctions.getSetValueText(SET_VALUE2), 0);\n                  var confirmToBAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, false, HelperFunctions.getSetValueText(SET_VALUE2), true, 300, _this3.nodeBTimerAnimation);\n                  Promise.all([confirmToClientAnimation.finished, confirmToBAnimation.finished]).then(function () {\n                    HelperFunctions.setSVGText({\n                      targetId: 'node-b-main-text',\n                      text: SET_VALUE2\n                    });\n                    _this3.animationState = ANIMATION_STATE_POST_NEW_LEADER_VALUE2_COMMITTED;\n                    resolve({\n                      animationState: _this3.animationState,\n                      delay: 100\n                    });\n                  });\n                });\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_POST_NEW_LEADER_VALUE2_COMMITTED:\n          {\n            this.stopTimers();\n            this.animationState = Constants.ANIMATION_STATE_FINISHED;\n            resolve({\n              animationState: this.animationState,\n              delay: 100\n            });\n            break;\n          }\n\n        case Constants.ANIMATION_STATE_FINISHED:\n          {\n            console.log('Animation finished. Nothing to do');\n            resolve({\n              animationState: this.animationState,\n              delay: 100\n            });\n            break;\n          }\n\n        default:\n          console.error('Unrecognized state: ' + this.animationState);\n      }\n    }\n  }, {\n    key: \"changeMainText\",\n    value: function changeMainText(text, onComplete, delay) {\n      HelperFunctions.setTextWithAnimation(this.mainTextSect, text, onComplete, delay);\n    }\n  }, {\n    key: \"restartTimers\",\n    value: function restartTimers() {\n      if (this.nodeATimerAnimation) {\n        this.nodeATimerAnimation.restart();\n      }\n\n      if (this.nodeBTimerAnimation) {\n        this.nodeBTimerAnimation.restart();\n      }\n\n      if (this.nodeCTimerAnimation) {\n        this.nodeCTimerAnimation.restart();\n      }\n    }\n  }, {\n    key: \"stopTimers\",\n    value: function stopTimers() {\n      this.timersAreActive = false;\n      this.pauseTimers();\n    }\n  }, {\n    key: \"pauseTimers\",\n    value: function pauseTimers() {\n      if (this.nodeATimerAnimation) {\n        this.nodeATimerAnimation.pause();\n      }\n\n      if (this.nodeBTimerAnimation) {\n        this.nodeBTimerAnimation.pause();\n      }\n\n      if (this.nodeCTimerAnimation) {\n        this.nodeCTimerAnimation.pause();\n      }\n    }\n  }, {\n    key: \"resumeTimers\",\n    value: function resumeTimers() {\n      if (this.nodeATimerAnimation) {\n        this.nodeATimerAnimation.play();\n      }\n\n      if (this.nodeBTimerAnimation) {\n        this.nodeBTimerAnimation.play();\n      }\n\n      if (this.nodeCTimerAnimation) {\n        this.nodeCTimerAnimation.play();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 413\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        id: \"main-diagram\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 414\n        },\n        __self: this\n      }, React.createElement(MainDiagram, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 415\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        id: \"main-text-sect\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 417\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return LeaderLeaseAnimation;\n}(Component);\nexport default LeaderLeaseAnimation;","map":{"version":3,"sources":["/Users/andrew/code/yb-architecture/animations/src/LeaderLeasesAnimation.js"],"names":["React","Component","anime","MainDiagram","Constants","HelperFunctions","require","ANIMATION_STATE_INITIAL","ANIMATION_STATE_INTRODUCTION_MADE","ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS","ANIMATION_STATE_CLIENT_WROTE_TO_ORIGINAL_LEADER","ANIMATION_STATE_VALUE1_COMMITTED","ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED","ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED","ANIMATION_STATE_NEW_LEADER_ELECTED","ANIMATION_STATE_TIMER_STARTED_ON_ORIGINAL_LEADER","ANIMATION_STATE_TIMER_STARTED_ON_NEW_LEADER","ANIMATION_STATE_POST_NEW_LEADER_VALUE2_COMMITTED","ANIMATION_STATE_POST_NEW_LEADER_LOG_ACK_RECEIVED_FROM_FOLLOWER","ANIMATION_STATE_NEW_LEADER_SENT_LEASES","SET_VALUE1","SET_VALUE2","ORIGINAL_LEADER_TIMER_DURATION","NODE_A_TIMER_DURATION","NODE_B_TIMER_DURATION","LeaderLeaseAnimation","props","state","init","animationState","nodeATimerAnimation","nodeBTimerAnimation","nodeCTimerAnimation","mainTextSect","document","getElementById","timersAreActive","pauseTimers","resumeTimers","Promise","resolve","reject","onNextInternal","nodeOuterCircles","getElementsByClassName","i","length","hideElement","nodeC","classList","add","changeMainText","delay","startMyLeaseTimer","NODE_C","leaseToA","nodeALeaseAnimation","targets","translateX","translateY","easing","duration","begin","showElement","complete","style","transform","leaseToB","nodeBLeaseAnimation","all","finished","then","startLeaderLeaseTimer","NODE_A","NODE_B","introduceClientAnimation","introduceClient","writeAnimation","sendLogMessage","CLIENT_NODE","getSetValueText","messageToFollowerAnimations","logMessageFromLeaderToFollowers","finishedPromises","getFinishPromises","setSVGText","targetId","text","confWriteToFollowersAnimation","partitionNodeC","nodeA","messageContrainerElement","messageElement","messageTextElement","messageFromClient","onBegin","onChangeComplete","remove","onComplete","alternate","leaderLeaseTimerId","restart","animation","messageToBAnimation","confirmToClientAnimation","confirmToBAnimation","stopTimers","ANIMATION_STATE_FINISHED","console","log","error","setTextWithAnimation","pause","play"],"mappings":"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","sourcesContent":["\nimport React, { Component } from 'react';\nimport './App.css';\nimport anime from 'animejs/lib/anime.es.js';\nimport MainDiagram from './svg/MainDiagram';\nimport {Constants} from './constants';\n\nvar HelperFunctions = require('./HelperFunctions');\n\n\nconst ANIMATION_STATE_INITIAL = \"LEADER_LEASE_INITIAL\";\nconst ANIMATION_STATE_INTRODUCTION_MADE = \"ANIMATION_STATE_INTRODUCTION_MADE\";\nconst ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS = \"ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS\";\nconst ANIMATION_STATE_CLIENT_WROTE_TO_ORIGINAL_LEADER = \"ANIMATION_STATE_CLIENT_WROTE_TO_ORIGINAL_LEADER\";\nconst ANIMATION_STATE_VALUE1_COMMITTED = \"ANIMATION_STATE_VALUE1_COMMITTED\";\nconst ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED = \"ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED\";\nconst ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED = \"ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED\";\nconst ANIMATION_STATE_NEW_LEADER_ELECTED = \"ANIMATION_STATE_NEW_LEADER_ELECTED\";\nconst ANIMATION_STATE_TIMER_STARTED_ON_ORIGINAL_LEADER = \"ANIMATION_STATE_TIMER_STARTED_ON_ORIGINAL_LEADER\";\nconst ANIMATION_STATE_TIMER_STARTED_ON_NEW_LEADER = \"ANIMATION_STATE_TIMER_STARTED_ON_NEW_LEADER\";\nconst ANIMATION_STATE_POST_NEW_LEADER_VALUE2_COMMITTED = \"ANIMATION_STATE_POST_NEW_LEADER_VALUE2_COMMITTED\";\nconst ANIMATION_STATE_POST_NEW_LEADER_LOG_ACK_RECEIVED_FROM_FOLLOWER = \"ANIMATION_STATE_POST_NEW_LEADER_LOG_ACK_RECEIVED_FROM_FOLLOWER\";\nconst ANIMATION_STATE_NEW_LEADER_SENT_LEASES = \"ANIMATION_STATE_NEW_LEADER_SENT_LEASES\";\n\nconst SET_VALUE1=\"V1\";\nconst SET_VALUE2=\"V2\";\nconst ORIGINAL_LEADER_TIMER_DURATION = 9000;\nconst NODE_A_TIMER_DURATION = 14000;\nconst NODE_B_TIMER_DURATION = 30000;\n\nexport class LeaderLeaseAnimation extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t}\n\t\tthis.init();\n\t}\n\tinit() {\n\t\tthis.animationState = ANIMATION_STATE_INITIAL;\n\t\tthis.nodeATimerAnimation = null;\n\t\tthis.nodeBTimerAnimation = null;\n\t\tthis.nodeCTimerAnimation = null;\n\n\t}\n\tcomponentDidMount() {\n\t\tthis.mainTextSect = document.getElementById('main-text-sect');\n\t\tthis.timersAreActive = false;\n\t}\n\n\tpause() {\n\t\tif (this.timersAreActive) {\n\t\t\tthis.pauseTimers();\n\t\t}\n\t}\n\tresume() {\n\t\tif (this.timersAreActive) {\n\t\t\tthis.resumeTimers();\n\t\t}\n\t}\n\tonNext() {\n\t\treturn new Promise((resolve,reject) => {\n\t\t\tthis.onNextInternal(resolve,reject);\n\t\t});\n\t}\n\n\tonNextInternal(resolve,reject) {\n\t\tswitch(this.animationState) {\n\t\t\tcase ANIMATION_STATE_INITIAL: {\n\t\t\t\t//////////////////// initial setup ////////////////////\n\n\t\t\t\t// hide all outer circles (TODO: revisit this approach)\n\t\t\t\tvar nodeOuterCircles = document.getElementsByClassName('node-outer-circle');\n\t\t\t\tfor (var i = 0; i < nodeOuterCircles.length; i++){\n\t\t\t\t\tHelperFunctions.hideElement(nodeOuterCircles[i]);\n\t\t\t\t}\n\t\t\t\t// make Node C  the leader\n\t\t\t\tvar nodeC = document.getElementById('node-c-circle');\n\t\t\t\tnodeC.classList.add('leader-node');\n\t\t\t\t//////////////////////////////////////////////////////\n\t\t\t\tthis.changeMainText('Read-problem solution in YugaByte DB...', () => {\n\t\t\t\t\t\tthis.animationState = ANIMATION_STATE_INTRODUCTION_MADE;\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\t\tdelay: 1000,\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_INTRODUCTION_MADE: {\n\t\t\t\tthis.changeMainText('Leader replicates a lease interval to followers', () => {\n\n\t\t\t\t\tthis.timersAreActive = true;\n\t\t\t\t\t// this.nodeCTimerAnimation = HelperFunctions.startLeaseTimer(Constants.NODE_C, ORIGINAL_LEADER_TIMER_DURATION);\n\t\t\t\t\tthis.nodeCTimerAnimation = HelperFunctions.startMyLeaseTimer(Constants.NODE_C, ORIGINAL_LEADER_TIMER_DURATION);\n\n\t\t\t\t\tvar leaseToA = document.getElementById('node-c-lease-to-node-a');\n\t\t\t\t\tvar nodeALeaseAnimation = anime({\n\t\t\t\t\t\ttargets: leaseToA,\n\t\t\t\t\t\ttranslateX: -280,\n\t\t\t\t\t\ttranslateY: 0,\n\t\t\t\t\t\teasing: 'linear',\n\t\t\t\t\t\tduration: 1500,\n\t\t\t\t\t\tbegin: () => {\n\t\t\t\t\t\t\tHelperFunctions.showElement(leaseToA);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcomplete: () =>{\n\t\t\t\t\t\t\tHelperFunctions.hideElement(leaseToA);\n\t\t\t\t\t\t\tleaseToA.style.transform = 'none';\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tvar leaseToB = document.getElementById('node-c-lease-to-node-b');\n\t\t\t\t\tvar nodeBLeaseAnimation = anime({\n\t\t\t\t\t\ttargets: leaseToB,\n\t\t\t\t\t\ttranslateX: -150,\n\t\t\t\t\t\ttranslateY: -280,\n\t\t\t\t\t\teasing: 'linear',\n\t\t\t\t\t\tduration: 1500,\n\t\t\t\t\t\tbegin: () => {\n\t\t\t\t\t\t\tHelperFunctions.showElement(leaseToB);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcomplete: () =>{\n\t\t\t\t\t\t\tHelperFunctions.hideElement(leaseToB);\n\t\t\t\t\t\t\tleaseToB.style.transform = 'none';\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tPromise.all([nodeALeaseAnimation.finished,nodeBLeaseAnimation.finished]).then(() => {\n\t\t\t\t\t\t// this.startTimers();\n\t\t\t\t\t\tthis.nodeATimerAnimation = HelperFunctions.startLeaderLeaseTimer(Constants.NODE_A, NODE_A_TIMER_DURATION);\n\t\t\t\t\t\tthis.nodeBTimerAnimation = HelperFunctions.startLeaderLeaseTimer(Constants.NODE_B, NODE_B_TIMER_DURATION);\n\n\t\t\t\t\t\tthis.animationState = ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS;\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\t\tdelay: 500,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS: {\n\t\t\t\tthis.changeMainText('Client arrives and performs a write', () => {\n\t\t\t\t\tvar introduceClientAnimation = HelperFunctions.introduceClient(`Value: ${SET_VALUE1}`);\n\t\t\t\t\tintroduceClientAnimation.finished.then(() => {\n\t\t\t\t\t\tvar writeAnimation = HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_C, false, HelperFunctions.getSetValueText(SET_VALUE1), false, 0);\n\t\t\t\t\t\twriteAnimation.finished.then(() => {\n\t\t\t\t\t\t\tthis.animationState = ANIMATION_STATE_CLIENT_WROTE_TO_ORIGINAL_LEADER;\n\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\t\t\tdelay: 1000,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_CLIENT_WROTE_TO_ORIGINAL_LEADER: {\n\t\t\t\tthis.changeMainText('This starts a raft round to commit value to all nodes', () => {\n\t\t\t\t\tvar messageToFollowerAnimations = HelperFunctions.logMessageFromLeaderToFollowers(true,HelperFunctions.getSetValueText(SET_VALUE1), false, 0, this.nodeATimerAnimation, this.nodeBTimerAnimation, this.nodeCTimerAnimation);\n\t\t\t\t\tvar finishedPromises = HelperFunctions.getFinishPromises(messageToFollowerAnimations);\n\n\t\t\t\t\tPromise.all(finishedPromises).then(() => {\n\t\t\t\t\t\tHelperFunctions.setSVGText({\n\t\t\t\t\t\t\ttargetId: \"node-c-main-text\",\n\t\t\t\t\t\t\ttext:SET_VALUE1,\n\t\t\t\t\t\t\tshowElement: true});\n\n\t\t\t\t\t\t// send confirmation of write to followers\n\t\t\t\t\t\tvar confWriteToFollowersAnimation = HelperFunctions.logMessageFromLeaderToFollowers(false, HelperFunctions.getSetValueText(SET_VALUE1), true,600, this.nodeATimerAnimation, this.nodeBTimerAnimation);\n\t\t\t\t\t\tfinishedPromises = HelperFunctions.getFinishPromises(confWriteToFollowersAnimation);\n\n\t\t\t\t\t\t// and notify client as well\n\t\t\t\t\t\tHelperFunctions.sendLogMessage(Constants.NODE_C, Constants.CLIENT_NODE);\n\n\t\t\t\t\t\t// wait for confirmation to reach followers\n\t\t\t\t\t\tPromise.all(finishedPromises).then(() => {\n\t\t\t\t\t\t\t// commit value on followers\n\t\t\t\t\t\t\tHelperFunctions.setSVGText({\n\t\t\t\t\t\t\t\ttargetId: \"node-a-main-text\",\n\t\t\t\t\t\t\t\ttext:SET_VALUE1,\n\t\t\t\t\t\t\t\tshowElement: true});\n\t\t\t\t\t\t\tHelperFunctions.setSVGText({\n\t\t\t\t\t\t\t\t\ttargetId: \"node-b-main-text\",\n\t\t\t\t\t\t\t\t\ttext:SET_VALUE1,\n\t\t\t\t\t\t\t\t\tshowElement: true});\n\n\t\t\t\t\t\t\tthis.animationState = ANIMATION_STATE_VALUE1_COMMITTED;\n\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\t\t\tdelay: 1000,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_VALUE1_COMMITTED: {\n\t\t\t\tthis.changeMainText('Now suppose the original leader gets network partitioned', () => {\n\t\t\t\t\t// partition original leader\n\t\t\t\t\tHelperFunctions.partitionNodeC();\n\n\t\t\t\t\tthis.animationState = ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED;\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\tdelay: 100,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED: {\n\t\t\t\tthis.changeMainText('And Node A gets elected as the new leader', () => {\n\t\t\t\t\t// elect Node A as new leader candidate\n\t\t\t\t\tvar nodeA = document.getElementById('node-a-circle');\n\t\t\t\t\tnodeA.classList.add('leader-candidate-node');\n\t\t\t\t\tHelperFunctions.setSVGText({targetId: 'node-a-term-text', text: \"Term: 1\"});\n\t\t\t\t\tHelperFunctions.setSVGText({targetId: 'node-b-term-text', text: \"Term: 1\"});\n\n\t\t\t\t\tthis.animationState = ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED;\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\tdelay: 1000,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED: {\n\t\t\t\tthis.changeMainText('Client tries to write to new leader but update fails, as old leader can still serve reads', () => {\n\t\t\t\t\t\tthis.resumeTimers();\n\n\t\t\t\t\t\tHelperFunctions.setSVGText({targetId: 'client-node-main-text', text: SET_VALUE2 });\n\n\t\t\t\t\t\tvar messageContrainerElement = document.getElementById('client-message');\n\t\t\t\t\t\tvar messageElement = document.getElementById('client-message-circle');\n\t\t\t\t\t\tvar messageTextElement = document.getElementById('client-message-text');\n\n\t\t\t\t\t\tHelperFunctions.messageFromClient(Constants.NODE_A,\t{\n\t\t\t\t\t\t\tonBegin: () => {\n\t\t\t\t\t\t\t\tHelperFunctions.showElement(messageContrainerElement);\n\t\t\t\t\t\t\t\tmessageElement.classList.add('log-message');\n\t\t\t\t\t\t\t\tHelperFunctions.setSVGText({targetId: 'client-message-text', text: ''});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonChangeComplete: () => {\n\t\t\t\t\t\t\t\tmessageElement.classList.remove('log-message');\n\t\t\t\t\t\t\t\tmessageElement.classList.add('error-message');\n\t\t\t\t\t\t\t\tHelperFunctions.setSVGText({targetId: 'client-message-text', text: 'Rejected'});\n\t\t\t\t\t\t\t\t// messageTextElement\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonComplete: () => {\n\t\t\t\t\t\t\t\tmessageElement.classList.remove('error-message');\n\t\t\t\t\t\t\t\tHelperFunctions.hideElement(messageContrainerElement);\n\t\t\t\t\t\t\t\tmessageContrainerElement.style.transform = 'none';\n\t\t\t\t\t\t\t\tHelperFunctions.setSVGText({targetId: 'client-message-text', text: ''});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\talternate: true,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.nodeCTimerAnimation.finished.then(() => {\n\t\t\t\t\t\t\tthis.nodeCTimerAnimation = null;\n\n\t\t\t\t\t\t\tthis.changeMainText(\"Original leader lease time has expired and it has stepped downed\");\n\t\t\t\t\t\t\tvar nodeC = document.getElementById('node-c-circle');\n\t\t\t\t\t\t\tnodeC.classList.remove('leader-node');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.nodeATimerAnimation.finished.then(() => {\n\t\t\t\t\t\t\tvar nodeA = document.getElementById('node-a-circle');\n\t\t\t\t\t\t\tnodeA.classList.remove('leader-candidate-node');\n\t\t\t\t\t\t\tnodeA.classList.add('leader-node');\n\n\t\t\t\t\t\t\tthis.changeMainText(\"Node A's leader lease timer has expired as well and has become the new leader now\", () => {\n\t\t\t\t\t\t\t\tthis.pauseTimers();\n\t\t\t\t\t\t\t\tthis.animationState = ANIMATION_STATE_NEW_LEADER_ELECTED;\n\n\t\t\t\t\t\t\t\t// Make sure we perform next before the new leader's timer expires\n\t\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\t\t\t\tdelay: 100,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_NEW_LEADER_ELECTED: {\n\t\t\t\t// hide Node A's leader lease timer\n\t\t\t\tHelperFunctions.hideElement(document.getElementById(HelperFunctions.leaderLeaseTimerId(Constants.NODE_A)));\n\n\t\t\t\t// and start its my lease timer\n\t\t\t\tthis.nodeATimerAnimation = HelperFunctions.startMyLeaseTimer(Constants.NODE_A, NODE_A_TIMER_DURATION);\n\n\t\t\t\t// then send leader lease message to B\n\t\t\t\tvar leaseToB = document.getElementById('node-a-lease-to-node-b');\n\t\t\t\tvar nodeBLeaseAnimation = anime({\n\t\t\t\t\ttargets: leaseToB,\n\t\t\t\t\ttranslateX: 150,\n\t\t\t\t\ttranslateY: -280,\n\t\t\t\t\teasing: 'linear',\n\t\t\t\t\tduration: 1500,\n\t\t\t\t\tbegin: () => {\n\t\t\t\t\t\tHelperFunctions.showElement(leaseToB);\n\t\t\t\t\t},\n\t\t\t\t\tcomplete: () =>{\n\t\t\t\t\t\tHelperFunctions.hideElement(leaseToB);\n\t\t\t\t\t\tleaseToB.style.transform = 'none';\n\n\t\t\t\t\t\tthis.nodeBTimerAnimation.restart();\n\t\t\t\t\t\tthis.animationState = ANIMATION_STATE_NEW_LEADER_SENT_LEASES;\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\t\tdelay: 100,\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_NEW_LEADER_SENT_LEASES: {\n\t\t\t\tthis.changeMainText(\"From here on, client can write messages to the new leader\", () => {\n\t\t\t\t\t// initiate a raft round\n\t\t\t\t\t\n\t\t\t\t\t// client message to A\n\t\t\t\t\tvar animation = HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_A, false, HelperFunctions.getSetValueText(SET_VALUE2), false, 0);\n\n\t\t\t\t\tanimation.finished.then(() => {\n\t\t\t\t\t\t// message with ack from A to B\n\t\t\t\t\t\tvar messageToBAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, true, HelperFunctions.getSetValueText(SET_VALUE2), false, 0, this.nodeBTimerAnimation, this.nodeATimerAnimation);\n\n\t\t\t\t\t\tmessageToBAnimation.finished.then(() => {\n\t\t\t\t\t\t\tHelperFunctions.setSVGText({targetId: 'node-a-main-text', text: SET_VALUE2 });\n\n\t\t\t\t\t\t\t// confirmation message back to B and the client\n\t\t\t\t\t\t\tvar confirmToClientAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.CLIENT_NODE, false, HelperFunctions.getSetValueText(SET_VALUE2), 0);\n\t\t\t\t\t\t\tvar confirmToBAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, false, HelperFunctions.getSetValueText(SET_VALUE2), true, 300, this.nodeBTimerAnimation);\n\n\t\t\t\t\t\t\tPromise.all([confirmToClientAnimation.finished, confirmToBAnimation.finished]).then(() => {\n\t\t\t\t\t\t\t\tHelperFunctions.setSVGText({targetId: 'node-b-main-text', text: SET_VALUE2 });\n\n\t\t\t\t\t\t\t\tthis.animationState = ANIMATION_STATE_POST_NEW_LEADER_VALUE2_COMMITTED;\n\t\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\t\t\t\tdelay: 100,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_POST_NEW_LEADER_VALUE2_COMMITTED: {\n\t\t\t\tthis.stopTimers();\n\t\t\t\tthis.animationState = Constants.ANIMATION_STATE_FINISHED;\n\t\t\t\tresolve({\n\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\tdelay: 100,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase Constants.ANIMATION_STATE_FINISHED: {\n\t\t\t\tconsole.log('Animation finished. Nothing to do');\n\t\t\t\tresolve({\n\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\tdelay: 100,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tconsole.error('Unrecognized state: ' + this.animationState);\n\t\t}\n\t}\n\tchangeMainText(text, onComplete, delay) {\n\t\tHelperFunctions.setTextWithAnimation(this.mainTextSect, text, onComplete, delay);\n\t}\n\trestartTimers() {\n\t\tif (this.nodeATimerAnimation) {\n\t\t\tthis.nodeATimerAnimation.restart();\n\t\t}\n\t\tif (this.nodeBTimerAnimation) {\n\t\t\tthis.nodeBTimerAnimation.restart();\n\t\t}\n\t\tif (this.nodeCTimerAnimation) {\n\t\t\tthis.nodeCTimerAnimation.restart();\n\t\t}\n\t}\n\tstopTimers() {\n\t\tthis.timersAreActive = false;\n\t\tthis.pauseTimers();\n\t}\n\tpauseTimers() {\n\t\tif (this.nodeATimerAnimation) {\n\t\t\tthis.nodeATimerAnimation.pause();\n\t\t}\n\t\tif (this.nodeBTimerAnimation) {\n\t\t\tthis.nodeBTimerAnimation.pause();\n\t\t}\n\t\tif (this.nodeCTimerAnimation) {\n\t\t\tthis.nodeCTimerAnimation.pause();\n\t\t}\n\t}\n\tresumeTimers() {\n\t\tif (this.nodeATimerAnimation) {\n\t\t\tthis.nodeATimerAnimation.play();\n\t\t}\n\t\tif (this.nodeBTimerAnimation) {\n\t\t\tthis.nodeBTimerAnimation.play();\n\t\t}\n\t\tif (this.nodeCTimerAnimation) {\n\t\t\tthis.nodeCTimerAnimation.play();\n\t\t}\n\t}\n\n\trender() {\n\t\treturn(\n\t\t\t<div>\n\t\t\t\t<div id=\"main-diagram\" >\n\t\t\t\t\t<MainDiagram/>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"main-text-sect\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default LeaderLeaseAnimation;\n"]},"metadata":{},"sourceType":"module"}