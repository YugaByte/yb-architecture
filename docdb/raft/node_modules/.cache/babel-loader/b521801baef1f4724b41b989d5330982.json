{"ast":null,"code":"import _classCallCheck from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/andrew/code/yb-architecture/animations/src/ReadFailureAnimation.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport anime from 'animejs/lib/anime.es.js';\nimport MainDiagram from './svg/MainDiagram';\nimport { Constants } from './constants';\n\nvar HelperFunctions = require('./HelperFunctions');\n\nvar ANIMATION_STATE_UNSAFE_READ = \"ANIMATION_STATE_UNSAFE_READ\";\nvar ANIMATION_STATE_NODE_C_PARTITIONED = \"ANIMATION_STATE_NODE_C_PARTITIONED\";\nvar ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER = \"ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER\";\nvar ANIMATION_STATE_CLIENT_SET_OPERATION = 'ANIMATION_STATE_CLIENT_SET_OPERATION';\nvar ANIMATION_STATE_CLIENT_READ_FROM_NODE_C = 'ANIMATION_STATE_CLIENT_READ_FROM_NODE_C';\nvar ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER = \"ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER\";\nvar ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE = 'ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE';\nvar SET_VALUE2 = \"V2\";\nexport var ReadOperationAnimation =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ReadOperationAnimation, _Component);\n\n  function ReadOperationAnimation(props) {\n    var _this;\n\n    _classCallCheck(this, ReadOperationAnimation);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ReadOperationAnimation).call(this, props));\n    _this.animationState = Constants.ANIMATION_STATE_INITIAL;\n    _this.state = {\n      animationFinished: false,\n      previousEnabled: true\n    };\n    return _this;\n  }\n\n  _createClass(ReadOperationAnimation, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.mainTextSect = document.getElementById('center-message-text');\n    }\n  }, {\n    key: \"pause\",\n    value: function pause() {}\n  }, {\n    key: \"resume\",\n    value: function resume() {}\n  }, {\n    key: \"onNext\",\n    value: function onNext() {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this2.onNextInternal(resolve, reject);\n      });\n    }\n  }, {\n    key: \"onNextInternal\",\n    value: function onNextInternal(resolve, reject) {\n      var _this3 = this;\n\n      // Text Containers underneath each Node\n      var nodeATextContainer = document.getElementById('node-a-term-text-rect');\n      var nodeBTextContainer = document.getElementById('node-b-term-text-rect');\n      var nodeCTextContainer = document.getElementById('node-c-term-text-rect'); // Text Term (Line 1)\n\n      var nodeATermText = document.getElementById('node-a-term-text');\n      var nodeBTermText = document.getElementById('node-b-term-text');\n      var nodeCTermText = document.getElementById('node-c-term-text'); // Highlight for Text Term (Line 1) -> Only 2 needed\n\n      var nodeATermHighlight = document.getElementById('node-a-term-highlight');\n      var nodeBTermHighlight = document.getElementById('node-b-term-highlight'); // Text Extra (Line 2)\n\n      var nodeAExtraText = document.getElementById('node-a-extra-text');\n      var nodeBExtraText = document.getElementById('node-b-extra-text');\n      var nodeCExtraText = document.getElementById('node-c-extra-text'); // Highlight for Text Extra (Line 2)\n\n      var nodeAExtraHighlight = document.getElementById('node-a-text-highlight'); // Text Extra (Line 3)\n\n      var nodeAExtraText2 = document.getElementById('node-a-extra-text2'); // MESSAGE OBJECTS\n\n      var nodeAMessageBubble = document.getElementById('node-a-message-bubble');\n      var nodeAMessageStatus = document.getElementById('node-a-message-status'); // Client\n\n      var clientMessageBubble = document.getElementById('client-message-bubble');\n      var clientQueryMessage = document.getElementById('client-query-message');\n      var clientMessageBackground = document.getElementById('client-message-status-bg');\n\n      switch (this.animationState) {\n        case Constants.ANIMATION_STATE_INITIAL:\n          {\n            //////////////////// initial setup ////////////////////\n            // hide all outer circles (TODO: revisit this approach)\n            var nodeOuterCircles = document.getElementsByClassName('node-outer-circle');\n\n            for (var i = 0; i < nodeOuterCircles.length; i++) {\n              HelperFunctions.hideElement(nodeOuterCircles[i]);\n            } //////////////////////////////////////////////////////\n\n\n            this.changeMainText('Let\\'s say we have a 3-node raft group.<br />C is the raft leader, all nodes have data <br />k = V1', function () {\n              // make Node C the Leader\n              var nodeC = document.getElementById('node-c-circle');\n              nodeC.classList.add('leader-node');\n              HelperFunctions.showElement(nodeATextContainer);\n              HelperFunctions.showElement(nodeBTextContainer);\n              HelperFunctions.showElement(nodeCTextContainer);\n              nodeATermText.innerHTML = 'Term: 1';\n              nodeBTermText.innerHTML = 'Term: 1';\n              nodeCTermText.innerHTML = 'Term: 1';\n              nodeAExtraText.innerHTML = '(k, V1)';\n              nodeBExtraText.innerHTML = '(k, V1)';\n              nodeCExtraText.innerHTML = '(k, V1)';\n              _this3.animationState = ANIMATION_STATE_UNSAFE_READ;\n              resolve({\n                animationState: _this3.animationState,\n                delay: 100\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_UNSAFE_READ:\n          {\n            this.changeMainText('Unsafe to read from raft leader without majority heartbeats. This sequence explains why.', function () {\n              _this3.animationState = ANIMATION_STATE_NODE_C_PARTITIONED;\n              resolve({\n                animationState: _this3.animationState,\n                delay: 100\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_NODE_C_PARTITIONED:\n          {\n            this.changeMainText('');\n            var altBubbleText = document.getElementById('node-c-message-text-alt');\n            HelperFunctions.showElement(document.getElementById('node-c-message-bubble-alt'));\n            var contentLine1 = {\n              index: 0,\n              str: 'Now imagine raft leader C gets\\n partitioned from followers\\n[but not from client]'\n            };\n            anime({\n              targets: contentLine1,\n              index: contentLine1.str.length,\n              easing: 'linear',\n              duration: 1500,\n              update: function update() {\n                altBubbleText.innerText = contentLine1.str.substr(0, contentLine1.index);\n              },\n              complete: function complete() {\n                HelperFunctions.partitionNodeC();\n                _this3.animationState = ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER;\n                resolve({\n                  animationState: _this3.animationState,\n                  delay: 100\n                });\n              }\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER:\n          {\n            document.getElementById('node-c-message-text-alt').innerText = '';\n            HelperFunctions.hideElement(document.getElementById('node-c-message-bubble-alt'));\n            HelperFunctions.showElement(nodeAMessageBubble);\n            var content = {\n              index: 0,\n              str: 'This results in A and B\\n electing a new raft\\nleader, say A.'\n            };\n            anime({\n              targets: content,\n              index: content.str.length,\n              easing: 'linear',\n              duration: 1300,\n              update: function update() {\n                nodeAMessageStatus.innerHTML = content.str.substr(0, content.index);\n              },\n              complete: function complete() {\n                var nodeA = document.getElementById('node-a-circle');\n                nodeA.classList.add('leader-node');\n                HelperFunctions.setSVGText({\n                  targetId: 'node-a-term-text',\n                  text: \"Term: 2\"\n                });\n                HelperFunctions.setSVGText({\n                  targetId: 'node-b-term-text',\n                  text: \"Term: 2\"\n                });\n                HelperFunctions.showElement(nodeATermHighlight);\n                HelperFunctions.showElement(nodeBTermHighlight);\n                _this3.animationState = ANIMATION_STATE_CLIENT_SET_OPERATION;\n                resolve({\n                  animationState: _this3.animationState,\n                  delay: 100\n                });\n              }\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_CLIENT_SET_OPERATION:\n          {\n            /**\n             *  Update: (monospaced) UPDATE T SET value = V2 WHERE key = k \n             *  (Get rid of committed but leave uncommitted and change node\n             *  subtext to k: V1, and highlight the value. \n             *  After Node A sends msg to client, show Client: “Update successful!”\n             */\n            nodeAMessageStatus.innerHTML = '';\n            HelperFunctions.hideElement(nodeAMessageBubble);\n            HelperFunctions.hideElement(nodeATermHighlight);\n            HelperFunctions.hideElement(nodeBTermHighlight);\n            HelperFunctions.introduceClient();\n            var clientContent1 = {\n              index: 0,\n              str: 'UPDATE T SET'\n            };\n            var clientContent2 = {\n              index: 0,\n              str: 'value = V2 WHERE'\n            };\n            var clientContent3 = {\n              index: 0,\n              str: ' key = k'\n            };\n            var statusText1 = document.getElementById('client-query-message-text1');\n            var statusText2 = document.getElementById('client-query-message-text2');\n            var statusText3 = document.getElementById('client-query-message-text3');\n            HelperFunctions.showElement(clientMessageBubble);\n            HelperFunctions.showElement(clientMessageBackground);\n            HelperFunctions.showElement(clientQueryMessage);\n            anime({\n              targets: clientContent1,\n              index: clientContent1.str.length,\n              easing: 'linear',\n              duration: 400,\n              update: function update() {\n                statusText1.textContent = clientContent1.str.substr(0, clientContent1.index);\n              },\n              complete: function complete() {\n                anime({\n                  targets: clientContent2,\n                  index: clientContent2.str.length,\n                  easing: 'linear',\n                  duration: 400,\n                  update: function update() {\n                    statusText2.textContent = clientContent2.str.substr(0, clientContent2.index);\n                  },\n                  complete: function complete() {\n                    anime({\n                      targets: clientContent3,\n                      index: clientContent3.str.length,\n                      easing: 'linear',\n                      duration: 400,\n                      update: function update() {\n                        statusText3.textContent = clientContent3.str.substr(0, clientContent3.index);\n                      },\n                      complete: function complete() {\n                        var animation = HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_A, false, false, '(k, V2)');\n                        animation.finished.then(function () {\n                          var nodeAToBAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, true, false, '(k, V2)');\n                          nodeAToBAnimation.finished.then(function () {\n                            document.getElementById('client-query-message-text1').innerHTML = '';\n                            document.getElementById('client-query-message-text2').innerHTML = '';\n                            document.getElementById('client-query-message-text3').innerHTML = '';\n                            HelperFunctions.hideElement(clientMessageBubble);\n                            HelperFunctions.showElement(nodeAMessageBubble); // send commit confirmation back to B\n\n                            var aToBAnim = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, false, false, '', true, 600);\n                            nodeAExtraText.innerHTML = '(k, V2)';\n                            HelperFunctions.showElement(nodeAExtraHighlight);\n                            HelperFunctions.hideElement(nodeAExtraText2);\n                            aToBAnim.finished.then(function () {\n                              HelperFunctions.showElement(document.getElementById('node-b-text-highlight'));\n                              document.getElementById('node-b-extra-text').innerHTML = '(k, V2)';\n                              HelperFunctions.hideElement(document.getElementById('node-b-extra-text2'));\n                            });\n                            nodeAMessageStatus.innerHTML = '';\n                            HelperFunctions.hideElement(nodeAMessageBubble); // notify client as well\n\n                            var messageToClientAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.CLIENT_NODE);\n                            messageToClientAnimation.finished.then(function () {\n                              HelperFunctions.showElement(clientMessageBubble);\n                              HelperFunctions.hideElement(clientQueryMessage);\n                              document.getElementById('client-message-status').textContent = 'Update successful!';\n                              _this3.animationState = ANIMATION_STATE_CLIENT_READ_FROM_NODE_C;\n                              resolve({\n                                animationState: _this3.animationState,\n                                delay: 100\n                              });\n                            });\n                          });\n                        });\n                      }\n                    });\n                  }\n                });\n              }\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_CLIENT_READ_FROM_NODE_C:\n          {\n            nodeAMessageStatus.innerHTML = '';\n            HelperFunctions.hideElement(nodeAMessageBubble);\n            HelperFunctions.hideElement(document.getElementById('node-a-text-highlight'));\n            HelperFunctions.hideElement(document.getElementById('node-b-text-highlight'));\n            document.getElementById('client-query-message-text1').innerHTML = '';\n            document.getElementById('client-query-message-text2').innerHTML = '';\n            document.getElementById('client-query-message-text3').innerHTML = '';\n            HelperFunctions.hideElement(clientMessageBubble);\n            HelperFunctions.hideElement(clientQueryMessage);\n            document.getElementById('client-message-status').innerHTML = '';\n            this.changeMainText('Now the client queries C. This should return value = ' + SET_VALUE2, function () {\n              _this3.animationState = ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER;\n              resolve({\n                animationState: _this3.animationState,\n                delay: 100\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER:\n          {\n            this.changeMainText('');\n\n            var _statusText = document.getElementById('client-query-message-text1');\n\n            var _statusText2 = document.getElementById('client-query-message-text2');\n\n            _statusText.innerHTML = '';\n            _statusText2.innerHTML = '';\n            HelperFunctions.showElement(clientMessageBubble);\n            HelperFunctions.showElement(clientMessageBackground);\n            HelperFunctions.showElement(clientQueryMessage);\n            HelperFunctions.hideElement(document.getElementById('node-c-extra-text2'));\n            var _clientContent = {\n              index: 0,\n              str: 'SELECT value'\n            };\n            var _clientContent2 = {\n              index: 0,\n              str: 'FROM T WHERE key = k'\n            };\n            anime({\n              targets: _clientContent,\n              index: _clientContent.str.length,\n              easing: 'linear',\n              duration: 400,\n              update: function update() {\n                _statusText.innerHTML = _clientContent.str.substr(0, _clientContent.index);\n              },\n              complete: function complete() {\n                anime({\n                  targets: _clientContent2,\n                  index: _clientContent2.str.length,\n                  easing: 'linear',\n                  duration: 600,\n                  update: function update() {\n                    _statusText2.innerHTML = _clientContent2.str.substr(0, _clientContent2.index);\n                  },\n                  complete: function complete() {\n                    HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_C, false);\n                    _this3.animationState = ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE;\n                    resolve({\n                      animationState: _this3.animationState,\n                      delay: 100\n                    });\n                  }\n                });\n              }\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE:\n          {\n            HelperFunctions.hideElement(clientMessageBubble);\n            HelperFunctions.hideElement(clientMessageBackground);\n            HelperFunctions.hideElement(clientQueryMessage);\n\n            var _altBubbleText = document.getElementById('node-c-message-text-alt');\n\n            HelperFunctions.showElement(document.getElementById('node-c-message-bubble-alt'));\n            var _contentLine = {\n              index: 0,\n              str: 'C thinks it is the raft leader.\\nWithout majority heartbeats,\\nC will respond with value = V1'\n            };\n            anime({\n              targets: _contentLine,\n              index: _contentLine.str.length,\n              easing: 'linear',\n              duration: 1500,\n              update: function update() {\n                _altBubbleText.innerText = _contentLine.str.substr(0, _contentLine.index);\n              },\n              complete: function complete() {\n                var animation = HelperFunctions.sendLogMessage(Constants.NODE_C, Constants.CLIENT_NODE, false);\n                animation.finished.then(function () {\n                  HelperFunctions.showElement(document.getElementById('client-node-value-alt'));\n                  document.getElementById('client-node-value-error-header').innerHTML = 'Value: V1';\n                  document.getElementById('client-node-value-error-subtitle').innerHTML = 'Expected value = V2';\n                });\n                _this3.animationState = Constants.ANIMATION_STATE_FINISHED;\n\n                _this3.setState({\n                  animationFinished: true\n                });\n\n                resolve({\n                  animationState: _this3.animationState,\n                  delay: 100\n                });\n              }\n            });\n            break;\n          }\n\n        case Constants.ANIMATION_STATE_FINISHED:\n          {\n            resolve({\n              animationState: this.animationState,\n              delay: 100\n            });\n            break;\n          }\n\n        default:\n          console.error('Unrecognized state: ' + this.animationState);\n      }\n    }\n  }, {\n    key: \"onPrevious\",\n    value: function onPrevious() {\n      var _this4 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this4.onPreviousInternal(resolve, reject);\n      });\n    }\n  }, {\n    key: \"onPreviousInternal\",\n    value: function onPreviousInternal(resolve, reject) {\n      var _this5 = this;\n\n      // Text Containers underneath each Node\n      var nodeATextContainer = document.getElementById('node-a-term-text-rect');\n      var nodeBTextContainer = document.getElementById('node-b-term-text-rect');\n      var nodeCTextContainer = document.getElementById('node-c-term-text-rect'); // Text Term (Line 1)\n\n      var nodeATermText = document.getElementById('node-a-term-text');\n      var nodeBTermText = document.getElementById('node-b-term-text');\n      var nodeCTermText = document.getElementById('node-c-term-text'); // Highlight for Text Term (Line 1) -> Only 2 needed\n\n      var nodeATermHighlight = document.getElementById('node-a-term-highlight');\n      var nodeBTermHighlight = document.getElementById('node-b-term-highlight'); // Text Extra (Line 2)\n\n      var nodeAExtraText = document.getElementById('node-a-extra-text');\n      var nodeBExtraText = document.getElementById('node-b-extra-text');\n      var nodeCExtraText = document.getElementById('node-c-extra-text'); // Highlight for Text Extra (Line 2)\n\n      var nodeAExtraHighlight = document.getElementById('node-a-text-highlight');\n      var nodeBExtraHighlight = document.getElementById('node-b-text-highlight'); // Text Extra (Line 3)\n\n      var nodeAExtraText2 = document.getElementById('node-a-extra-text2'); // MESSAGE OBJECTS\n\n      var nodeAMessageBubble = document.getElementById('node-a-message-bubble');\n      var nodeAMessageStatus = document.getElementById('node-a-message-status'); // Client\n\n      var clientMessageBubble = document.getElementById('client-message-bubble');\n      var clientQueryMessage = document.getElementById('client-query-message');\n      var clientMessageBackground = document.getElementById('client-message-status-bg'); // MISC\n\n      var partitionWrap = document.getElementById('node-c-partition-wrap');\n\n      switch (this.animationState) {\n        case ANIMATION_STATE_UNSAFE_READ:\n          {\n            var nodeC = document.getElementById('node-c-circle');\n            nodeC.classList.remove('leader-node');\n            HelperFunctions.hideElement(nodeATextContainer);\n            HelperFunctions.hideElement(nodeBTextContainer);\n            HelperFunctions.hideElement(nodeCTextContainer);\n            nodeATermText.innerHTML = '';\n            nodeBTermText.innerHTML = '';\n            nodeCTermText.innerHTML = '';\n            nodeAExtraText.innerHTML = '';\n            nodeBExtraText.innerHTML = '';\n            nodeCExtraText.innerHTML = '';\n            this.changeMainText('');\n            this.animationState = Constants.ANIMATION_STATE_INITIAL;\n            resolve({\n              animationState: this.animationState,\n              delay: 100\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_NODE_C_PARTITIONED:\n          {\n            var nodeC = document.getElementById('node-c-circle');\n            nodeC.classList.remove('leader-node');\n            nodeATermText.innerHTML = '';\n            nodeBTermText.innerHTML = '';\n            nodeCTermText.innerHTML = '';\n            nodeAExtraText.innerHTML = '';\n            nodeBExtraText.innerHTML = '';\n            nodeCExtraText.innerHTML = '';\n            this.changeMainText('Let\\'s say we have a 3-node raft group.<br />C is the raft leader, all nodes have data <br />k = V1', function () {\n              nodeATermText.innerHTML = 'Term: 1';\n              nodeBTermText.innerHTML = 'Term: 1';\n              nodeCTermText.innerHTML = 'Term: 1';\n              nodeAExtraText.innerHTML = '(k, V1)';\n              nodeBExtraText.innerHTML = '(k, V1)';\n              nodeCExtraText.innerHTML = '(k, V1)';\n              nodeC.classList.add('leader-node');\n              _this5.animationState = ANIMATION_STATE_UNSAFE_READ;\n              resolve({\n                animationState: _this5.animationState,\n                delay: 100\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER:\n          {\n            HelperFunctions.hideElement(partitionWrap);\n            HelperFunctions.hideElement(document.getElementById('node-c-message-bubble-alt'));\n            document.getElementById('node-c-message-text-alt').innerText = '';\n            this.changeMainText('Unsafe to read from raft leader without majority heartbeats. This sequence explains why.', function () {\n              _this5.animationState = ANIMATION_STATE_NODE_C_PARTITIONED;\n              resolve({\n                animationState: _this5.animationState,\n                delay: 100\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_CLIENT_SET_OPERATION:\n          {\n            var nodeA = document.getElementById('node-a-circle');\n            nodeA.classList.remove('leader-node');\n            HelperFunctions.hideElement(partitionWrap);\n            nodeATermText.innerHTML = 'Term: 1';\n            nodeBTermText.innerHTML = 'Term: 1';\n            HelperFunctions.hideElement(nodeATermHighlight);\n            HelperFunctions.hideElement(nodeBTermHighlight);\n            HelperFunctions.hideElement(document.getElementById('node-a-message-bubble'));\n            nodeAMessageStatus.innerText = '';\n            var altBubbleText = document.getElementById('node-c-message-text-alt');\n            HelperFunctions.showElement(document.getElementById('node-c-message-bubble-alt'));\n            var contentLine1 = {\n              index: 0,\n              str: 'Now imagine raft leader C gets\\n partitioned from followers\\n[but not from client]'\n            };\n            anime({\n              targets: contentLine1,\n              index: contentLine1.str.length,\n              easing: 'linear',\n              duration: 1500,\n              update: function update() {\n                altBubbleText.innerText = contentLine1.str.substr(0, contentLine1.index);\n              },\n              complete: function complete() {\n                HelperFunctions.showElement(partitionWrap);\n                _this5.animationState = ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER;\n                resolve({\n                  animationState: _this5.animationState,\n                  delay: 100\n                });\n              }\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_CLIENT_READ_FROM_NODE_C:\n          {\n            HelperFunctions.hideElement(clientMessageBubble);\n            HelperFunctions.hideElement(document.getElementById('client-node'));\n            HelperFunctions.hideElement(document.getElementById('client-message-circle'));\n            document.getElementById('client-message-status').innerHTML = '';\n            HelperFunctions.hideElement(nodeAExtraHighlight);\n            HelperFunctions.hideElement(nodeBExtraHighlight);\n            nodeAExtraText.innerText = '(k, V1)';\n            nodeBExtraText.innerText = '(k, V1)';\n            HelperFunctions.setSVGText({\n              targetId: 'node-a-term-text',\n              text: \"Term: 1\"\n            });\n            HelperFunctions.setSVGText({\n              targetId: 'node-b-term-text',\n              text: \"Term: 1\"\n            });\n            HelperFunctions.showElement(nodeAMessageBubble);\n            var content = {\n              index: 0,\n              str: 'This results in A and B\\n electing a new raft\\nleader, say A.'\n            };\n            anime({\n              targets: content,\n              index: content.str.length,\n              easing: 'linear',\n              duration: 1300,\n              update: function update() {\n                nodeAMessageStatus.innerHTML = content.str.substr(0, content.index);\n              },\n              complete: function complete() {\n                var nodeA = document.getElementById('node-a-circle');\n                nodeA.classList.add('leader-node');\n                HelperFunctions.setSVGText({\n                  targetId: 'node-a-term-text',\n                  text: \"Term: 2\"\n                });\n                HelperFunctions.setSVGText({\n                  targetId: 'node-b-term-text',\n                  text: \"Term: 2\"\n                });\n                HelperFunctions.showElement(nodeATermHighlight);\n                HelperFunctions.showElement(nodeBTermHighlight);\n                _this5.animationState = ANIMATION_STATE_CLIENT_SET_OPERATION;\n                resolve({\n                  animationState: _this5.animationState,\n                  delay: 100\n                });\n              }\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER:\n          {\n            this.changeMainText('');\n            nodeAMessageStatus.innerHTML = '';\n            HelperFunctions.hideElement(nodeAMessageBubble);\n            HelperFunctions.hideElement(nodeATermHighlight);\n            HelperFunctions.hideElement(nodeBTermHighlight);\n            HelperFunctions.introduceClient();\n            var clientContent1 = {\n              index: 0,\n              str: 'UPDATE T SET'\n            };\n            var clientContent2 = {\n              index: 0,\n              str: 'value = V2 WHERE'\n            };\n            var clientContent3 = {\n              index: 0,\n              str: ' key = k'\n            };\n            var statusText1 = document.getElementById('client-query-message-text1');\n            var statusText2 = document.getElementById('client-query-message-text2');\n            var statusText3 = document.getElementById('client-query-message-text3');\n            statusText1.innerHTML = '';\n            statusText2.innerHTML = '';\n            statusText3.innerHTML = '';\n            HelperFunctions.showElement(clientMessageBubble);\n            HelperFunctions.showElement(clientMessageBackground);\n            HelperFunctions.showElement(clientQueryMessage);\n            anime({\n              targets: clientContent1,\n              index: clientContent1.str.length,\n              easing: 'linear',\n              duration: 400,\n              update: function update() {\n                statusText1.textContent = clientContent1.str.substr(0, clientContent1.index);\n              },\n              complete: function complete() {\n                anime({\n                  targets: clientContent2,\n                  index: clientContent2.str.length,\n                  easing: 'linear',\n                  duration: 400,\n                  update: function update() {\n                    statusText2.textContent = clientContent2.str.substr(0, clientContent2.index);\n                  },\n                  complete: function complete() {\n                    anime({\n                      targets: clientContent3,\n                      index: clientContent3.str.length,\n                      easing: 'linear',\n                      duration: 400,\n                      update: function update() {\n                        statusText3.textContent = clientContent3.str.substr(0, clientContent3.index);\n                      },\n                      complete: function complete() {\n                        var animation = HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_A, false, false, '(k, V2)');\n                        animation.finished.then(function () {\n                          var nodeAToBAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, true, false, '(k, V2)');\n                          nodeAToBAnimation.finished.then(function () {\n                            document.getElementById('client-query-message-text1').innerHTML = '';\n                            document.getElementById('client-query-message-text2').innerHTML = '';\n                            document.getElementById('client-query-message-text3').innerHTML = '';\n                            HelperFunctions.hideElement(clientMessageBubble);\n                            HelperFunctions.showElement(nodeAMessageBubble); // send commit confirmation back to B\n\n                            var aToBAnim = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, false, false, '', true, 600);\n                            nodeAExtraText.innerHTML = '(k, V2)';\n                            HelperFunctions.showElement(nodeAExtraHighlight);\n                            HelperFunctions.hideElement(nodeAExtraText2);\n                            aToBAnim.finished.then(function () {\n                              HelperFunctions.showElement(document.getElementById('node-b-text-highlight'));\n                              document.getElementById('node-b-extra-text').innerHTML = '(k, V2)';\n                              HelperFunctions.hideElement(document.getElementById('node-b-extra-text2'));\n                            });\n                            nodeAMessageStatus.innerHTML = '';\n                            HelperFunctions.hideElement(nodeAMessageBubble); // notify client as well\n\n                            var messageToClientAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.CLIENT_NODE);\n                            messageToClientAnimation.finished.then(function () {\n                              HelperFunctions.showElement(clientMessageBubble);\n                              document.getElementById('client-message-status').textContent = 'Update successful!';\n                              _this5.animationState = ANIMATION_STATE_CLIENT_READ_FROM_NODE_C;\n                              resolve({\n                                animationState: _this5.animationState,\n                                delay: 100\n                              });\n                            });\n                          });\n                        });\n                      }\n                    });\n                  }\n                });\n              }\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE:\n          {\n            HelperFunctions.hideElement(clientMessageBackground);\n            HelperFunctions.hideElement(clientQueryMessage);\n            HelperFunctions.hideElement(clientMessageBubble);\n            this.changeMainText('Now the client queries C. This should return value = ' + SET_VALUE2, function () {\n              _this5.animationState = ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER;\n              resolve({\n                animationState: _this5.animationState,\n                delay: 100\n              });\n            });\n            break;\n          }\n\n        case Constants.ANIMATION_STATE_FINISHED:\n          {\n            this.setState({\n              animationFinished: false\n            });\n            document.getElementById('node-c-message-text-alt').innerHTML = '';\n            HelperFunctions.hideElement(document.getElementById('client-node-value-alt'));\n            HelperFunctions.hideElement(document.getElementById('node-c-message-bubble-alt'));\n\n            var _statusText3 = document.getElementById('client-query-message-text1');\n\n            var _statusText4 = document.getElementById('client-query-message-text2');\n\n            _statusText3.innerHTML = '';\n            _statusText4.innerHTML = '';\n            HelperFunctions.showElement(clientMessageBubble);\n            HelperFunctions.showElement(clientMessageBackground);\n            HelperFunctions.showElement(clientQueryMessage);\n            HelperFunctions.hideElement(document.getElementById('node-c-extra-text2'));\n            var _clientContent3 = {\n              index: 0,\n              str: 'SELECT value'\n            };\n            var _clientContent4 = {\n              index: 0,\n              str: 'FROM T WHERE key = k'\n            };\n            anime({\n              targets: _clientContent3,\n              index: _clientContent3.str.length,\n              easing: 'linear',\n              duration: 400,\n              update: function update() {\n                _statusText3.innerHTML = _clientContent3.str.substr(0, _clientContent3.index);\n              },\n              complete: function complete() {\n                anime({\n                  targets: _clientContent4,\n                  index: _clientContent4.str.length,\n                  easing: 'linear',\n                  duration: 600,\n                  update: function update() {\n                    _statusText4.innerHTML = _clientContent4.str.substr(0, _clientContent4.index);\n                  },\n                  complete: function complete() {\n                    var animation = HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_C, false);\n                    _this5.animationState = ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE;\n                    resolve({\n                      animationState: _this5.animationState,\n                      delay: 100\n                    });\n                  }\n                });\n              }\n            });\n            break;\n          }\n\n        default:\n          console.error('Unrecognized state: ' + this.animationState);\n      }\n    }\n  }, {\n    key: \"changeMainText\",\n    value: function changeMainText(text, onComplete) {\n      HelperFunctions.setTextWithAnimation(this.mainTextSect, text, onComplete);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 772\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        id: \"main-diagram\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 773\n        },\n        __self: this\n      }, React.createElement(MainDiagram, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 774\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        id: \"main-text-sect\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 776\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return ReadOperationAnimation;\n}(Component);\nexport default ReadOperationAnimation;","map":{"version":3,"sources":["/Users/andrew/code/yb-architecture/animations/src/ReadFailureAnimation.js"],"names":["React","Component","anime","MainDiagram","Constants","HelperFunctions","require","ANIMATION_STATE_UNSAFE_READ","ANIMATION_STATE_NODE_C_PARTITIONED","ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER","ANIMATION_STATE_CLIENT_SET_OPERATION","ANIMATION_STATE_CLIENT_READ_FROM_NODE_C","ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER","ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE","SET_VALUE2","ReadOperationAnimation","props","animationState","ANIMATION_STATE_INITIAL","state","animationFinished","previousEnabled","mainTextSect","document","getElementById","Promise","resolve","reject","onNextInternal","nodeATextContainer","nodeBTextContainer","nodeCTextContainer","nodeATermText","nodeBTermText","nodeCTermText","nodeATermHighlight","nodeBTermHighlight","nodeAExtraText","nodeBExtraText","nodeCExtraText","nodeAExtraHighlight","nodeAExtraText2","nodeAMessageBubble","nodeAMessageStatus","clientMessageBubble","clientQueryMessage","clientMessageBackground","nodeOuterCircles","getElementsByClassName","i","length","hideElement","changeMainText","nodeC","classList","add","showElement","innerHTML","delay","altBubbleText","contentLine1","index","str","targets","easing","duration","update","innerText","substr","complete","partitionNodeC","content","nodeA","setSVGText","targetId","text","introduceClient","clientContent1","clientContent2","clientContent3","statusText1","statusText2","statusText3","textContent","animation","sendLogMessage","CLIENT_NODE","NODE_A","finished","then","nodeAToBAnimation","NODE_B","aToBAnim","messageToClientAnimation","NODE_C","ANIMATION_STATE_FINISHED","setState","console","error","onPreviousInternal","nodeBExtraHighlight","partitionWrap","remove","onComplete","setTextWithAnimation"],"mappings":"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","sourcesContent":["\nimport React, { Component } from 'react';\nimport './App.css';\nimport anime from 'animejs/lib/anime.es.js';\nimport MainDiagram from './svg/MainDiagram';\nimport { Constants } from './constants';\n\nvar HelperFunctions = require('./HelperFunctions');\n\nconst ANIMATION_STATE_UNSAFE_READ = \"ANIMATION_STATE_UNSAFE_READ\";\nconst ANIMATION_STATE_NODE_C_PARTITIONED = \"ANIMATION_STATE_NODE_C_PARTITIONED\";\nconst ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER = \"ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER\";\nconst ANIMATION_STATE_CLIENT_SET_OPERATION = 'ANIMATION_STATE_CLIENT_SET_OPERATION';\nconst ANIMATION_STATE_CLIENT_READ_FROM_NODE_C = 'ANIMATION_STATE_CLIENT_READ_FROM_NODE_C';\nconst ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER = \"ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER\";\nconst ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE = 'ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE';\n\nconst SET_VALUE2=\"V2\";\n\nexport class ReadOperationAnimation extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.animationState = Constants.ANIMATION_STATE_INITIAL;\n\t\tthis.state = {\n      animationFinished: false,\n      previousEnabled: true,\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.mainTextSect = document.getElementById('center-message-text');\n\t}\n\n\tpause() {\n\t}\n\tresume() {\n\t}\n\n\tonNext() {\n\t\treturn new Promise((resolve,reject) => {\n\t\t\tthis.onNextInternal(resolve,reject);\n\t\t});\n\t}\n\n\tonNextInternal(resolve,reject) {\n    // Text Containers underneath each Node\n    const nodeATextContainer = document.getElementById('node-a-term-text-rect');\n    const nodeBTextContainer = document.getElementById('node-b-term-text-rect');\n    const nodeCTextContainer = document.getElementById('node-c-term-text-rect');\n    // Text Term (Line 1)\n    const nodeATermText = document.getElementById('node-a-term-text');\n    const nodeBTermText = document.getElementById('node-b-term-text');\n    const nodeCTermText = document.getElementById('node-c-term-text');\n    // Highlight for Text Term (Line 1) -> Only 2 needed\n    const nodeATermHighlight = document.getElementById('node-a-term-highlight');\n    const nodeBTermHighlight = document.getElementById('node-b-term-highlight');\n    // Text Extra (Line 2)\n    const nodeAExtraText = document.getElementById('node-a-extra-text');\n    const nodeBExtraText = document.getElementById('node-b-extra-text');\n    const nodeCExtraText = document.getElementById('node-c-extra-text');\n    // Highlight for Text Extra (Line 2)\n    const nodeAExtraHighlight = document.getElementById('node-a-text-highlight');\n    // Text Extra (Line 3)\n    const nodeAExtraText2 = document.getElementById('node-a-extra-text2');\n\n    // MESSAGE OBJECTS\n    const nodeAMessageBubble = document.getElementById('node-a-message-bubble');\n    const nodeAMessageStatus = document.getElementById('node-a-message-status');\n\n    // Client\n    const clientMessageBubble = document.getElementById('client-message-bubble');\n    const clientQueryMessage = document.getElementById('client-query-message');\n    const clientMessageBackground = document.getElementById('client-message-status-bg');\n\n\t\tswitch(this.animationState) {\n\t\t\tcase Constants.ANIMATION_STATE_INITIAL: {\n\t\t\t\t//////////////////// initial setup ////////////////////\n\n\t\t\t\t// hide all outer circles (TODO: revisit this approach)\n\t\t\t\tvar nodeOuterCircles = document.getElementsByClassName('node-outer-circle');\n\t\t\t\tfor (var i = 0; i < nodeOuterCircles.length; i++) {\n\t\t\t\t\tHelperFunctions.hideElement(nodeOuterCircles[i]);\n\t\t\t\t}\n\t\t\t\t//////////////////////////////////////////////////////\n\t\t\t\tthis.changeMainText('Let\\'s say we have a 3-node raft group.<br />C is the raft leader, all nodes have data <br />k = V1', () => {\n\t\t\t\t\t// make Node C the Leader\n\t\t\t\t\tvar nodeC = document.getElementById('node-c-circle');\n\t\t\t\t\tnodeC.classList.add('leader-node');\n          HelperFunctions.showElement(nodeATextContainer);\n          HelperFunctions.showElement(nodeBTextContainer);\n          HelperFunctions.showElement(nodeCTextContainer);\n\n          nodeATermText.innerHTML = 'Term: 1';\n          nodeBTermText.innerHTML = 'Term: 1';\n          nodeCTermText.innerHTML = 'Term: 1';\n\n          nodeAExtraText.innerHTML = '(k, V1)';\n          nodeBExtraText.innerHTML = '(k, V1)';\n          nodeCExtraText.innerHTML = '(k, V1)';\n          this.animationState = ANIMATION_STATE_UNSAFE_READ;\n          resolve({\n            animationState: this.animationState,\n            delay: 100,\n          });\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_UNSAFE_READ: {\n\t\t\t\tthis.changeMainText('Unsafe to read from raft leader without majority heartbeats. This sequence explains why.', () => {\n\t\t\t\t\tthis.animationState = ANIMATION_STATE_NODE_C_PARTITIONED;\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\tdelay: 100,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_NODE_C_PARTITIONED: {\n\t\t\t\tthis.changeMainText('');\n        const altBubbleText = document.getElementById('node-c-message-text-alt');\n        HelperFunctions.showElement(document.getElementById('node-c-message-bubble-alt'));\n\n\t\t\t\tconst contentLine1 = {\n\t\t\t\t\tindex: 0,\n\t\t\t\t\tstr: 'Now imagine raft leader C gets\\n partitioned from followers\\n[but not from client]'\n        };\n\n        anime({\n          targets: contentLine1,\n          index: contentLine1.str.length,\n          easing: 'linear',\n          duration: 1500,\n          update: function() {\n            altBubbleText.innerText = contentLine1.str.substr(0, contentLine1.index);\n          },\n          complete: () => {\n            HelperFunctions.partitionNodeC()\n            this.animationState = ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER;\n            resolve({\n              animationState: this.animationState,\n              delay: 100,\n            });\n          }\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER: {\n        document.getElementById('node-c-message-text-alt').innerText = '';\n        HelperFunctions.hideElement(document.getElementById('node-c-message-bubble-alt'));\n        HelperFunctions.showElement(nodeAMessageBubble);\n        const content = {\n\t\t\t\t\tindex: 0,\n\t\t\t\t\tstr: 'This results in A and B\\n electing a new raft\\nleader, say A.'\n        };\n\n        anime({\n          targets: content,\n          index: content.str.length,\n          easing: 'linear',\n          duration: 1300,\n          update: function() {\n            nodeAMessageStatus.innerHTML = content.str.substr(0, content.index);\n          },\n          complete: () => {\n            var nodeA = document.getElementById('node-a-circle');\n            nodeA.classList.add('leader-node');\n            HelperFunctions.setSVGText({targetId: 'node-a-term-text', text: \"Term: 2\"});\n            HelperFunctions.setSVGText({targetId: 'node-b-term-text', text: \"Term: 2\"});\n            HelperFunctions.showElement(nodeATermHighlight);\n            HelperFunctions.showElement(nodeBTermHighlight);\n            this.animationState = ANIMATION_STATE_CLIENT_SET_OPERATION;\n            resolve({\n              animationState: this.animationState,\n              delay: 100,\n            });\n          }\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_CLIENT_SET_OPERATION: {\n        /**\n         *  Update: (monospaced) UPDATE T SET value = V2 WHERE key = k \n         *  (Get rid of committed but leave uncommitted and change node\n         *  subtext to k: V1, and highlight the value. \n         *  After Node A sends msg to client, show Client: “Update successful!”\n         */\n        nodeAMessageStatus.innerHTML = '';\n        HelperFunctions.hideElement(nodeAMessageBubble);\n        HelperFunctions.hideElement(nodeATermHighlight);\n        HelperFunctions.hideElement(nodeBTermHighlight);\n        HelperFunctions.introduceClient();\n\n        const clientContent1 = {\n          index: 0,\n          str: 'UPDATE T SET'\n        }\n        const clientContent2 = {\n          index: 0,\n          str: 'value = V2 WHERE'\n        }\n        const clientContent3 = {\n          index: 0,\n          str: ' key = k'\n        }\n        \n        const statusText1 = document.getElementById('client-query-message-text1');\n        const statusText2 = document.getElementById('client-query-message-text2');\n        const statusText3 = document.getElementById('client-query-message-text3');\n        HelperFunctions.showElement(clientMessageBubble);\n        HelperFunctions.showElement(clientMessageBackground);\n        HelperFunctions.showElement(clientQueryMessage);\n        anime({\n          targets: clientContent1,\n          index: clientContent1.str.length,\n          easing: 'linear',\n          duration: 400,\n          update: function() {\n            statusText1.textContent = clientContent1.str.substr(0, clientContent1.index);\n          },\n          complete: () => {\n            anime({\n              targets: clientContent2,\n              index: clientContent2.str.length,\n              easing: 'linear',\n              duration: 400,\n              update: function () {\n                statusText2.textContent = clientContent2.str.substr(0, clientContent2.index);\n              },\n              complete: () => {\n                anime({\n                  targets: clientContent3,\n                  index: clientContent3.str.length,\n                  easing: 'linear',\n                  duration: 400,\n                  update: function () {\n                    statusText3.textContent = clientContent3.str.substr(0, clientContent3.index);\n                  },\n                  complete: () => {   \n                    var animation = HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_A, false, false, '(k, V2)');\n                    animation.finished.then(() => {\n                      var nodeAToBAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, true, false, '(k, V2)');\n                      nodeAToBAnimation.finished.then(() => {\n                        document.getElementById('client-query-message-text1').innerHTML = '';\n                        document.getElementById('client-query-message-text2').innerHTML = '';\n                        document.getElementById('client-query-message-text3').innerHTML = '';\n                        HelperFunctions.hideElement(clientMessageBubble);\n                        HelperFunctions.showElement(nodeAMessageBubble);\n                        \n                        // send commit confirmation back to B\n                        var aToBAnim = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, false, false, '', true, 600);\n                        nodeAExtraText.innerHTML = '(k, V2)';\n                        HelperFunctions.showElement(nodeAExtraHighlight);\n                        HelperFunctions.hideElement(nodeAExtraText2);\n\n                        aToBAnim.finished.then(() => {\n                          HelperFunctions.showElement(document.getElementById('node-b-text-highlight'));\n                          document.getElementById('node-b-extra-text').innerHTML = '(k, V2)';\n                          HelperFunctions.hideElement(document.getElementById('node-b-extra-text2'));\n                        });\n\n                        nodeAMessageStatus.innerHTML = '';\n                        HelperFunctions.hideElement(nodeAMessageBubble);\n\n                        // notify client as well\n                        var messageToClientAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.CLIENT_NODE);\n\n                        messageToClientAnimation.finished.then(() => {\n                          HelperFunctions.showElement(clientMessageBubble);\n                          HelperFunctions.hideElement(clientQueryMessage);\n                          document.getElementById('client-message-status').textContent = 'Update successful!';\n                          this.animationState = ANIMATION_STATE_CLIENT_READ_FROM_NODE_C;\n                          resolve({\n                            animationState: this.animationState,\n                            delay: 100,\n                          });\n                        });\n                      });\n                    })\n                  }\n                });\n              }\n            });\n          }\n        });\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_CLIENT_READ_FROM_NODE_C: {\n        nodeAMessageStatus.innerHTML = '';\n        HelperFunctions.hideElement(nodeAMessageBubble);\n        HelperFunctions.hideElement(document.getElementById('node-a-text-highlight'));\n        HelperFunctions.hideElement(document.getElementById('node-b-text-highlight'));\n        document.getElementById('client-query-message-text1').innerHTML = ''\n        document.getElementById('client-query-message-text2').innerHTML = ''\n        document.getElementById('client-query-message-text3').innerHTML = ''\n        HelperFunctions.hideElement(clientMessageBubble);\n        HelperFunctions.hideElement(clientQueryMessage);\n        document.getElementById('client-message-status').innerHTML = '';\n        \n        this.changeMainText('Now the client queries C. This should return value = ' + SET_VALUE2, () => {\n          this.animationState = ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER;\n            resolve({\n              animationState: this.animationState,\n              delay: 100,\n            });\n        });\n        break;\n      }\n      case ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER: {\n        this.changeMainText('');\n        const statusText1 = document.getElementById('client-query-message-text1');\n        const statusText2 = document.getElementById('client-query-message-text2');\n        statusText1.innerHTML = '';\n        statusText2.innerHTML = '';\n        HelperFunctions.showElement(clientMessageBubble);\n        HelperFunctions.showElement(clientMessageBackground);\n        HelperFunctions.showElement(clientQueryMessage);\n\n        HelperFunctions.hideElement(document.getElementById('node-c-extra-text2'));\n\n        const clientContent1 = {\n          index: 0,\n          str: 'SELECT value'\n        }\n        const clientContent2 = {\n          index: 0,\n          str: 'FROM T WHERE key = k'\n        }\n\n        anime({\n          targets: clientContent1,\n          index: clientContent1.str.length,\n          easing: 'linear',\n          duration: 400,\n          update: function() {\n            statusText1.innerHTML = clientContent1.str.substr(0, clientContent1.index);\n          },\n          complete: () => {\n            anime({\n              targets: clientContent2,\n              index: clientContent2.str.length,\n              easing: 'linear',\n              duration: 600,\n              update: function() {\n                statusText2.innerHTML = clientContent2.str.substr(0, clientContent2.index);\n              },\n              complete: () => {\n                HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_C, false);\n                this.animationState = ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE;\n                resolve({\n                  animationState: this.animationState,\n                  delay: 100,\n                });\n              }\n            }); \n          }\n        });\n\t\t\t\tbreak;\n      }\n      case ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE: {\n        HelperFunctions.hideElement(clientMessageBubble);\n        HelperFunctions.hideElement(clientMessageBackground);\n        HelperFunctions.hideElement(clientQueryMessage);\n        const altBubbleText = document.getElementById('node-c-message-text-alt');\n        HelperFunctions.showElement(document.getElementById('node-c-message-bubble-alt'));\n\n\t\t\t\tconst contentLine1 = {\n\t\t\t\t\tindex: 0,\n\t\t\t\t\tstr: 'C thinks it is the raft leader.\\nWithout majority heartbeats,\\nC will respond with value = V1'\n        };\n\n        anime({\n          targets: contentLine1,\n          index: contentLine1.str.length,\n          easing: 'linear',\n          duration: 1500,\n          update: function() {\n            altBubbleText.innerText = contentLine1.str.substr(0, contentLine1.index);\n          },\n          complete: () => {\n            var animation = HelperFunctions.sendLogMessage(Constants.NODE_C, Constants.CLIENT_NODE, false);\n            animation.finished.then(() => {\n              HelperFunctions.showElement(document.getElementById('client-node-value-alt'));\n              document.getElementById('client-node-value-error-header').innerHTML = 'Value: V1';\n              document.getElementById('client-node-value-error-subtitle').innerHTML = 'Expected value = V2';\n            });\n            this.animationState = Constants.ANIMATION_STATE_FINISHED;\n            this.setState({ animationFinished: true });\n            resolve({\n              animationState: this.animationState,\n              delay: 100,\n            });\n          }\n        });\n        break;\n      }\n\t\t\tcase Constants.ANIMATION_STATE_FINISHED: {\n\t\t\t\tresolve({\n\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\tdelay: 100,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tconsole.error('Unrecognized state: ' + this.animationState);\n\t\t}\n\t}\n\n  onPrevious() {\n\t\treturn new Promise((resolve,reject) => {\n\t\t\tthis.onPreviousInternal(resolve,reject);\n\t\t});\n\t}\n  \n  onPreviousInternal(resolve, reject) {\n    // Text Containers underneath each Node\n    const nodeATextContainer = document.getElementById('node-a-term-text-rect');\n    const nodeBTextContainer = document.getElementById('node-b-term-text-rect');\n    const nodeCTextContainer = document.getElementById('node-c-term-text-rect');\n    // Text Term (Line 1)\n    const nodeATermText = document.getElementById('node-a-term-text');\n    const nodeBTermText = document.getElementById('node-b-term-text');\n    const nodeCTermText = document.getElementById('node-c-term-text');\n    // Highlight for Text Term (Line 1) -> Only 2 needed\n    const nodeATermHighlight = document.getElementById('node-a-term-highlight');\n    const nodeBTermHighlight = document.getElementById('node-b-term-highlight');\n    // Text Extra (Line 2)\n    const nodeAExtraText = document.getElementById('node-a-extra-text');\n    const nodeBExtraText = document.getElementById('node-b-extra-text');\n    const nodeCExtraText = document.getElementById('node-c-extra-text');\n    // Highlight for Text Extra (Line 2)\n    const nodeAExtraHighlight = document.getElementById('node-a-text-highlight');\n    const nodeBExtraHighlight = document.getElementById('node-b-text-highlight');\n    // Text Extra (Line 3)\n    const nodeAExtraText2 = document.getElementById('node-a-extra-text2');\n\n    // MESSAGE OBJECTS\n    const nodeAMessageBubble = document.getElementById('node-a-message-bubble');\n    const nodeAMessageStatus = document.getElementById('node-a-message-status');\n\n    // Client\n    const clientMessageBubble = document.getElementById('client-message-bubble');\n    const clientQueryMessage = document.getElementById('client-query-message');\n    const clientMessageBackground = document.getElementById('client-message-status-bg');\n\n    // MISC\n    const partitionWrap = document.getElementById('node-c-partition-wrap');\n\n    switch(this.animationState) {\n      case ANIMATION_STATE_UNSAFE_READ: {\n        var nodeC = document.getElementById('node-c-circle');\n        nodeC.classList.remove('leader-node');\n        HelperFunctions.hideElement(nodeATextContainer);\n        HelperFunctions.hideElement(nodeBTextContainer);\n        HelperFunctions.hideElement(nodeCTextContainer);\n        nodeATermText.innerHTML = '';\n        nodeBTermText.innerHTML = '';\n        nodeCTermText.innerHTML = '';\n        nodeAExtraText.innerHTML = '';\n        nodeBExtraText.innerHTML = '';\n        nodeCExtraText.innerHTML = '';\n        this.changeMainText('');\n        this.animationState = Constants.ANIMATION_STATE_INITIAL;\n        resolve({\n          animationState: this.animationState,\n          delay: 100,\n        });\n        break;\n      }\n      case ANIMATION_STATE_NODE_C_PARTITIONED: {\n        var nodeC = document.getElementById('node-c-circle');\n        nodeC.classList.remove('leader-node');\n        nodeATermText.innerHTML = '';\n        nodeBTermText.innerHTML = '';\n        nodeCTermText.innerHTML = '';\n        nodeAExtraText.innerHTML = '';\n        nodeBExtraText.innerHTML = '';\n        nodeCExtraText.innerHTML = '';\n        this.changeMainText('Let\\'s say we have a 3-node raft group.<br />C is the raft leader, all nodes have data <br />k = V1', () => {\n          nodeATermText.innerHTML = 'Term: 1';\n          nodeBTermText.innerHTML = 'Term: 1';\n          nodeCTermText.innerHTML = 'Term: 1';\n\n          nodeAExtraText.innerHTML = '(k, V1)';\n          nodeBExtraText.innerHTML = '(k, V1)';\n          nodeCExtraText.innerHTML = '(k, V1)';\n          nodeC.classList.add('leader-node');\n          this.animationState = ANIMATION_STATE_UNSAFE_READ;\n          resolve({\n            animationState: this.animationState,\n            delay: 100,\n          });\n        });\n        break;\n      }\n      case ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER: {\n        HelperFunctions.hideElement(partitionWrap);\n        HelperFunctions.hideElement(document.getElementById('node-c-message-bubble-alt'));\n        document.getElementById('node-c-message-text-alt').innerText = '';\n        this.changeMainText('Unsafe to read from raft leader without majority heartbeats. This sequence explains why.', () => {\n          this.animationState = ANIMATION_STATE_NODE_C_PARTITIONED;\n          resolve({\n            animationState: this.animationState,\n            delay: 100,\n          });\n        });\n        break;\n      }\n      case ANIMATION_STATE_CLIENT_SET_OPERATION: {\n        var nodeA = document.getElementById('node-a-circle');\n        nodeA.classList.remove('leader-node');\n        HelperFunctions.hideElement(partitionWrap);\n        nodeATermText.innerHTML = 'Term: 1';\n        nodeBTermText.innerHTML = 'Term: 1';\n        HelperFunctions.hideElement(nodeATermHighlight);\n        HelperFunctions.hideElement(nodeBTermHighlight);\n        HelperFunctions.hideElement(document.getElementById('node-a-message-bubble'));\n        nodeAMessageStatus.innerText = '';\n        const altBubbleText = document.getElementById('node-c-message-text-alt');\n        HelperFunctions.showElement(document.getElementById('node-c-message-bubble-alt'));\n\n\t\t\t\tconst contentLine1 = {\n\t\t\t\t\tindex: 0,\n\t\t\t\t\tstr: 'Now imagine raft leader C gets\\n partitioned from followers\\n[but not from client]'\n        };\n\n        anime({\n          targets: contentLine1,\n          index: contentLine1.str.length,\n          easing: 'linear',\n          duration: 1500,\n          update: function() {\n            altBubbleText.innerText = contentLine1.str.substr(0, contentLine1.index);\n          },\n          complete: () => {\n            HelperFunctions.showElement(partitionWrap);\n            this.animationState = ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER;\n            resolve({\n              animationState: this.animationState,\n              delay: 100,\n            });\n          }\n        });\n        break;\n      }\n      case ANIMATION_STATE_CLIENT_READ_FROM_NODE_C: {\n        HelperFunctions.hideElement(clientMessageBubble);\n        HelperFunctions.hideElement(document.getElementById('client-node'));\n        HelperFunctions.hideElement(document.getElementById('client-message-circle'));\n        document.getElementById('client-message-status').innerHTML = '';\n        HelperFunctions.hideElement(nodeAExtraHighlight);\n        HelperFunctions.hideElement(nodeBExtraHighlight);\n        nodeAExtraText.innerText = '(k, V1)';\n        nodeBExtraText.innerText = '(k, V1)';\n        HelperFunctions.setSVGText({targetId: 'node-a-term-text', text: \"Term: 1\"});\n        HelperFunctions.setSVGText({targetId: 'node-b-term-text', text: \"Term: 1\"});\n        HelperFunctions.showElement(nodeAMessageBubble);\n        const content = {\n\t\t\t\t\tindex: 0,\n\t\t\t\t\tstr: 'This results in A and B\\n electing a new raft\\nleader, say A.'\n        };\n\n        anime({\n          targets: content,\n          index: content.str.length,\n          easing: 'linear',\n          duration: 1300,\n          update: function() {\n            nodeAMessageStatus.innerHTML = content.str.substr(0, content.index);\n          },\n          complete: () => {\n            var nodeA = document.getElementById('node-a-circle');\n            nodeA.classList.add('leader-node');\n            HelperFunctions.setSVGText({targetId: 'node-a-term-text', text: \"Term: 2\"});\n            HelperFunctions.setSVGText({targetId: 'node-b-term-text', text: \"Term: 2\"});\n            HelperFunctions.showElement(nodeATermHighlight);\n            HelperFunctions.showElement(nodeBTermHighlight);\n            this.animationState = ANIMATION_STATE_CLIENT_SET_OPERATION;\n            resolve({\n              animationState: this.animationState,\n              delay: 100,\n            });\n          }\n\t\t\t\t});\n        break;\n      }\n      case ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER: {\n        this.changeMainText('');\n        nodeAMessageStatus.innerHTML = '';\n        HelperFunctions.hideElement(nodeAMessageBubble);\n        HelperFunctions.hideElement(nodeATermHighlight);\n        HelperFunctions.hideElement(nodeBTermHighlight);\n        HelperFunctions.introduceClient();\n\n        const clientContent1 = {\n          index: 0,\n          str: 'UPDATE T SET'\n        }\n        const clientContent2 = {\n          index: 0,\n          str: 'value = V2 WHERE'\n        }\n        const clientContent3 = {\n          index: 0,\n          str: ' key = k'\n        }\n        \n        const statusText1 = document.getElementById('client-query-message-text1');\n        const statusText2 = document.getElementById('client-query-message-text2');\n        const statusText3 = document.getElementById('client-query-message-text3');\n        statusText1.innerHTML = '';\n        statusText2.innerHTML = '';\n        statusText3.innerHTML = '';\n        HelperFunctions.showElement(clientMessageBubble);\n        HelperFunctions.showElement(clientMessageBackground);\n        HelperFunctions.showElement(clientQueryMessage);\n        anime({\n          targets: clientContent1,\n          index: clientContent1.str.length,\n          easing: 'linear',\n          duration: 400,\n          update: function() {\n            statusText1.textContent = clientContent1.str.substr(0, clientContent1.index);\n          },\n          complete: () => {\n            anime({\n              targets: clientContent2,\n              index: clientContent2.str.length,\n              easing: 'linear',\n              duration: 400,\n              update: function () {\n                statusText2.textContent = clientContent2.str.substr(0, clientContent2.index);\n              },\n              complete: () => {\n                anime({\n                  targets: clientContent3,\n                  index: clientContent3.str.length,\n                  easing: 'linear',\n                  duration: 400,\n                  update: function () {\n                    statusText3.textContent = clientContent3.str.substr(0, clientContent3.index);\n                  },\n                  complete: () => {   \n                    var animation = HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_A, false, false, '(k, V2)');\n                    animation.finished.then(() => {\n                      var nodeAToBAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, true, false, '(k, V2)');\n                      nodeAToBAnimation.finished.then(() => {\n                        document.getElementById('client-query-message-text1').innerHTML = '';\n                        document.getElementById('client-query-message-text2').innerHTML = '';\n                        document.getElementById('client-query-message-text3').innerHTML = '';\n                        HelperFunctions.hideElement(clientMessageBubble);\n                        HelperFunctions.showElement(nodeAMessageBubble);\n                        \n                        // send commit confirmation back to B\n                        var aToBAnim = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, false, false, '', true, 600);\n                        nodeAExtraText.innerHTML = '(k, V2)';\n                        HelperFunctions.showElement(nodeAExtraHighlight);\n                        HelperFunctions.hideElement(nodeAExtraText2);\n\n                        aToBAnim.finished.then(() => {\n                          HelperFunctions.showElement(document.getElementById('node-b-text-highlight'));\n                          document.getElementById('node-b-extra-text').innerHTML = '(k, V2)';\n                          HelperFunctions.hideElement(document.getElementById('node-b-extra-text2'));\n                        });\n\n                        nodeAMessageStatus.innerHTML = '';\n                        HelperFunctions.hideElement(nodeAMessageBubble);\n\n                        // notify client as well\n                        var messageToClientAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.CLIENT_NODE);\n\n                        messageToClientAnimation.finished.then(() => {\n                          HelperFunctions.showElement(clientMessageBubble);\n                          document.getElementById('client-message-status').textContent = 'Update successful!';\n                          this.animationState = ANIMATION_STATE_CLIENT_READ_FROM_NODE_C;\n                          resolve({\n                            animationState: this.animationState,\n                            delay: 100,\n                          });\n                        });\n                      });\n                    })\n                  }\n                });\n              }\n            });\n          }\n        });\n        break;\n      }\n\n\n      case ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE: {\n        HelperFunctions.hideElement(clientMessageBackground);\n        HelperFunctions.hideElement(clientQueryMessage);\n        HelperFunctions.hideElement(clientMessageBubble);\n        this.changeMainText('Now the client queries C. This should return value = ' + SET_VALUE2, () => {\n          this.animationState = ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER;\n            resolve({\n              animationState: this.animationState,\n              delay: 100,\n            });\n        });\n        break;\n      }\n      case Constants.ANIMATION_STATE_FINISHED: {\n        this.setState({ animationFinished: false });\n        document.getElementById('node-c-message-text-alt').innerHTML = '';\n\n        HelperFunctions.hideElement(document.getElementById('client-node-value-alt'));\n        HelperFunctions.hideElement(document.getElementById('node-c-message-bubble-alt'));\n\n        const statusText1 = document.getElementById('client-query-message-text1');\n        const statusText2 = document.getElementById('client-query-message-text2');\n        statusText1.innerHTML = '';\n        statusText2.innerHTML = '';\n        HelperFunctions.showElement(clientMessageBubble);\n        HelperFunctions.showElement(clientMessageBackground);\n        HelperFunctions.showElement(clientQueryMessage);\n\n        HelperFunctions.hideElement(document.getElementById('node-c-extra-text2'));\n\n        const clientContent1 = {\n          index: 0,\n          str: 'SELECT value'\n        }\n        const clientContent2 = {\n          index: 0,\n          str: 'FROM T WHERE key = k'\n        }\n\n        anime({\n          targets: clientContent1,\n          index: clientContent1.str.length,\n          easing: 'linear',\n          duration: 400,\n          update: function() {\n            statusText1.innerHTML = clientContent1.str.substr(0, clientContent1.index);\n          },\n          complete: () => {\n            anime({\n              targets: clientContent2,\n              index: clientContent2.str.length,\n              easing: 'linear',\n              duration: 600,\n              update: function() {\n                statusText2.innerHTML = clientContent2.str.substr(0, clientContent2.index);\n              },\n              complete: () => {\n                var animation = HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_C, false);\n                this.animationState = ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE;\n                resolve({\n                  animationState: this.animationState,\n                  delay: 100,\n                });\n              }\n            }); \n          }\n        });\n        break;\n      }\n      default:\n        console.error('Unrecognized state: ' + this.animationState);\n    }\n  }\n\n\tchangeMainText(text, onComplete) {\n\t\tHelperFunctions.setTextWithAnimation(this.mainTextSect, text, onComplete);\n  }\n\n\trender() {\n\t\treturn(\n\t\t\t<div>\n\t\t\t\t<div id=\"main-diagram\">\n\t\t\t\t\t<MainDiagram/>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"main-text-sect\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default ReadOperationAnimation;\n"]},"metadata":{},"sourceType":"module"}