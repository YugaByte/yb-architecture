{"ast":null,"code":"import _classCallCheck from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/andrew/code/yb-architecture/animations/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/andrew/code/yb-architecture/animations/src/LeaderLeasesAnimation.js\";\nimport React, { Component } from 'react';\nimport './App.css';\nimport anime from 'animejs/lib/anime.es.js';\nimport MainDiagram from './svg/MainDiagram';\nimport { Constants } from './constants';\n\nvar HelperFunctions = require('./HelperFunctions');\n\nvar ANIMATION_STATE_INITIAL = \"LEADER_LEASE_INITIAL\";\nvar ANIMATION_STATE_LEADER_REPLICATES_LEASE = \"ANIMATION_STATE_LEADER_REPLICATES_LEASE\";\nvar ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS = \"ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS\";\nvar ANIMATION_STATE_LEADER_READS_PROTOCOL = 'ANIMATION_STATE_LEADER_READS_PROTOCOL';\nvar ANIMATION_STATE_START_LEADER_LEASE = 'ANIMATION_STATE_START_LEADER_LEASE';\nvar ANIMATION_STATE_CLIENT_WROTE_TO_ORIGINAL_LEADER = \"ANIMATION_STATE_CLIENT_WROTE_TO_ORIGINAL_LEADER\";\nvar ANIMATION_STATE_VALUE1_COMMITTED = \"ANIMATION_STATE_VALUE1_COMMITTED\";\nvar ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED = \"ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED\";\nvar ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED = \"ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED\";\nvar ANIMATION_STATE_NEW_LEADER_ELECTED = \"ANIMATION_STATE_NEW_LEADER_ELECTED\";\nvar ANIMATION_STATE_TIMER_STARTED_ON_ORIGINAL_LEADER = \"ANIMATION_STATE_TIMER_STARTED_ON_ORIGINAL_LEADER\";\nvar ANIMATION_STATE_TIMER_STARTED_ON_NEW_LEADER = \"ANIMATION_STATE_TIMER_STARTED_ON_NEW_LEADER\";\nvar ANIMATION_STATE_POST_NEW_LEADER_VALUE2_COMMITTED = \"ANIMATION_STATE_POST_NEW_LEADER_VALUE2_COMMITTED\";\nvar ANIMATION_STATE_POST_NEW_LEADER_LOG_ACK_RECEIVED_FROM_FOLLOWER = \"ANIMATION_STATE_POST_NEW_LEADER_LOG_ACK_RECEIVED_FROM_FOLLOWER\";\nvar ANIMATION_STATE_NEW_LEADER_SENT_LEASES = \"ANIMATION_STATE_NEW_LEADER_SENT_LEASES\";\nvar SET_VALUE1 = \"V1\";\nvar SET_VALUE2 = \"V2\";\nvar ORIGINAL_LEADER_TIMER_DURATION = 16000;\nvar NODE_A_TIMER_DURATION = 14000;\nvar NODE_B_TIMER_DURATION = 30000;\nexport var LeaderLeaseAnimation =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(LeaderLeaseAnimation, _Component);\n\n  function LeaderLeaseAnimation(props) {\n    var _this;\n\n    _classCallCheck(this, LeaderLeaseAnimation);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(LeaderLeaseAnimation).call(this, props));\n    _this.animationState = ANIMATION_STATE_INITIAL;\n    _this.state = {};\n\n    _this.init();\n\n    return _this;\n  }\n\n  _createClass(LeaderLeaseAnimation, [{\n    key: \"init\",\n    value: function init() {\n      this.nodeATimerAnimation = null;\n      this.nodeBTimerAnimation = null;\n      this.nodeCTimerAnimation = null;\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.mainTextSect = document.getElementById('center-message-text');\n      this.timersAreActive = false;\n    }\n  }, {\n    key: \"pause\",\n    value: function pause() {\n      if (this.timersAreActive) {\n        this.pauseTimers();\n      }\n    }\n  }, {\n    key: \"resume\",\n    value: function resume() {\n      if (this.timersAreActive) {\n        this.resumeTimers();\n      }\n    }\n  }, {\n    key: \"onNext\",\n    value: function onNext() {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this2.onNextInternal(resolve, reject);\n      });\n    }\n  }, {\n    key: \"onNextInternal\",\n    value: function onNextInternal(resolve, reject) {\n      var _this3 = this;\n\n      // Text Containers underneath each Node\n      var nodeATextContainer = document.getElementById('node-a-term-text-rect');\n      var nodeBTextContainer = document.getElementById('node-b-term-text-rect');\n      var nodeCTextContainer = document.getElementById('node-c-term-text-rect'); // Text Term (Line 1)\n\n      var nodeATermText = document.getElementById('node-a-term-text');\n      var nodeBTermText = document.getElementById('node-b-term-text');\n      var nodeCTermText = document.getElementById('node-c-term-text'); // Highlight for Text Term (Line 1) -> Only 2 needed\n\n      var nodeATermHighlight = document.getElementById('node-a-term-highlight');\n      var nodeBTermHighlight = document.getElementById('node-b-term-highlight'); // Text Extra (Line 2)\n\n      var nodeAExtraText = document.getElementById('node-a-extra-text');\n      var nodeBExtraText = document.getElementById('node-b-extra-text');\n      var nodeCExtraText = document.getElementById('node-c-extra-text'); // Highlight for Text Extra (Line 2)\n\n      var nodeAExtraHighlight = document.getElementById('node-a-text-highlight');\n      var nodeBExtraHighlight = document.getElementById('node-b-text-highlight');\n      var nodeCExtraHighlight = document.getElementById('node-c-text-highlight'); // Text Extra (Line 3)\n\n      var nodeAExtraText2 = document.getElementById('node-a-extra-text2');\n      var nodeBExtraText2 = document.getElementById('node-b-extra-text2');\n      var nodeCExtraText2 = document.getElementById('node-c-extra-text2'); // MESSAGE OBJECTS\n\n      var nodeAMessageBubble = document.getElementById('node-a-message-bubble');\n      var nodeAMessageStatus = document.getElementById('node-a-message-status');\n      var nodeCMessageBubble = document.getElementById('node-c-message-bubble');\n      var nodeCMessageStatus = document.getElementById('node-c-message-status');\n      var clientMessageBubble = document.getElementById('client-message-bubble');\n      var clientMessageStatus = document.getElementById('client-message-status');\n\n      switch (this.animationState) {\n        case ANIMATION_STATE_INITIAL:\n          {\n            //////////////////// initial setup ////////////////////\n            // hide all outer circles (TODO: revisit this approach)\n            var nodeOuterCircles = document.getElementsByClassName('node-outer-circle');\n\n            for (var i = 0; i < nodeOuterCircles.length; i++) {\n              HelperFunctions.hideElement(nodeOuterCircles[i]);\n            } //////////////////////////////////////////////////////\n\n\n            this.changeMainText('Let\\'s say we have a 3-node raft group.<br />C is the raft leader, all nodes have data <br />k = V1', function () {\n              // make Node C  the leader\n              var nodeC = document.getElementById('node-c-circle');\n              nodeC.classList.add('leader-node');\n              HelperFunctions.showElement(nodeATextContainer);\n              HelperFunctions.showElement(nodeBTextContainer);\n              HelperFunctions.showElement(nodeCTextContainer);\n              nodeATermText.innerHTML = 'Term: 1';\n              nodeBTermText.innerHTML = 'Term: 1';\n              nodeCTermText.innerHTML = 'Term: 1';\n              nodeAExtraText.innerHTML = '(k, V1)';\n              nodeBExtraText.innerHTML = '(k, V1)';\n              nodeCExtraText.innerHTML = '(k, V1)';\n              _this3.animationState = ANIMATION_STATE_LEADER_READS_PROTOCOL;\n              resolve({\n                animationState: _this3.animationState,\n                delay: 1000\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_LEADER_READS_PROTOCOL:\n          {\n            this.changeMainText('Performing raft-protocol, leader-only reads safely using leader leases', function () {\n              _this3.animationState = ANIMATION_STATE_START_LEADER_LEASE;\n              resolve({\n                animationState: _this3.animationState,\n                delay: 1000\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_START_LEADER_LEASE:\n          {\n            this.changeMainText('');\n            HelperFunctions.showElement(nodeCMessageBubble);\n            HelperFunctions.showElement(nodeCMessageStatus);\n            var statusText1 = document.getElementById('node-c-message-status-text1');\n            var statusText2 = document.getElementById('node-c-message-status-text2');\n            var contentLine1 = {\n              index: 0,\n              str: 'Raft leader starts a'\n            };\n            var contentLine2 = {\n              index: 0,\n              str: 'new lease timer for itself'\n            };\n            anime({\n              targets: contentLine1,\n              index: contentLine1.str.length,\n              easing: 'linear',\n              duration: 600,\n              update: function update() {\n                statusText1.textContent = contentLine1.str.substr(0, contentLine1.index);\n              },\n              complete: function complete() {\n                anime({\n                  targets: contentLine2,\n                  index: contentLine2.str.length,\n                  easing: 'linear',\n                  duration: 600,\n                  update: function update() {\n                    statusText2.textContent = contentLine2.str.substr(0, contentLine2.index);\n                  },\n                  complete: function complete() {\n                    _this3.timersAreActive = true; // this.nodeCTimerAnimation = HelperFunctions.startLeaseTimer(Constants.NODE_C, ORIGINAL_LEADER_TIMER_DURATION);\n\n                    _this3.nodeCTimerAnimation = HelperFunctions.startMyLeaseTimer(Constants.NODE_C, 1000, 90);\n                    console.log(_this3.nodeCTimerAnimation); // this.nodeCTimerAnimation.finished.then((args) => {\n\n                    _this3.animationState = ANIMATION_STATE_LEADER_REPLICATES_LEASE;\n                    resolve({\n                      animationState: _this3.animationState,\n                      delay: 100\n                    }); // });\n                  }\n                });\n              }\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_LEADER_REPLICATES_LEASE:\n          {\n            // this.changeMainText('Leader replicates a lease interval to followers', () => {\n            HelperFunctions.hideElement(nodeCMessageBubble);\n            HelperFunctions.hideElement(nodeCMessageStatus); // this.timersAreActive = true;\n            // // this.nodeCTimerAnimation = HelperFunctions.startLeaseTimer(Constants.NODE_C, ORIGINAL_LEADER_TIMER_DURATION);\n            // this.nodeCTimerAnimation = HelperFunctions.startMyLeaseTimer(Constants.NODE_C, ORIGINAL_LEADER_TIMER_DURATION);\n\n            HelperFunctions.showElement(document.getElementById('node-c-message-bubble-alt'));\n            document.getElementById('node-c-message-text-alt').innerHTML = 'Raft leader then replicates a \\nlease interval to followers. Note that\\nthe Leader Lease timer on C has started before replicating to A and B.';\n            var leaseToA = document.getElementById('node-c-lease-to-node-a');\n            var nodeALeaseAnimation = anime({\n              targets: leaseToA,\n              translateX: -280,\n              translateY: 0,\n              easing: 'linear',\n              duration: 1500,\n              begin: function begin() {\n                HelperFunctions.showElement(leaseToA);\n              },\n              complete: function complete() {\n                HelperFunctions.hideElement(leaseToA);\n                leaseToA.style.transform = 'none';\n              }\n            });\n            var leaseToB = document.getElementById('node-c-lease-to-node-b');\n            var nodeBLeaseAnimation = anime({\n              targets: leaseToB,\n              translateX: -150,\n              translateY: -280,\n              easing: 'linear',\n              duration: 1500,\n              begin: function begin() {\n                HelperFunctions.showElement(leaseToB);\n              },\n              complete: function complete() {\n                HelperFunctions.hideElement(leaseToB);\n                leaseToB.style.transform = 'none';\n              }\n            });\n            Promise.all([nodeALeaseAnimation.finished, nodeBLeaseAnimation.finished]).then(function () {\n              // this.startTimers();\n              _this3.nodeATimerAnimation = HelperFunctions.startLeaderLeaseTimer(Constants.NODE_A, NODE_A_TIMER_DURATION);\n              _this3.nodeBTimerAnimation = HelperFunctions.startLeaderLeaseTimer(Constants.NODE_B, NODE_B_TIMER_DURATION);\n              _this3.animationState = ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS;\n              resolve({\n                animationState: _this3.animationState,\n                delay: 500\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS:\n          {\n            this.changeMainText('');\n            var introduceClientAnimation = HelperFunctions.introduceClient(\"Value: \".concat(SET_VALUE1));\n            introduceClientAnimation.finished.then(function () {\n              var statusElem = document.getElementById('client-message-status');\n              var clientContent = {\n                index: 0,\n                str: \"SET k = \".concat(SET_VALUE1)\n              };\n              var statusText = document.getElementById('client-message-status-text2');\n              document.getElementById('client-message-status-text1').textContent = 'Client: ';\n              HelperFunctions.showElement(document.getElementById('client-message-bubble'));\n              HelperFunctions.showElement(statusElem);\n              anime({\n                targets: clientContent,\n                index: clientContent.str.length,\n                easing: 'linear',\n                duration: 600,\n                update: function update() {\n                  statusText.textContent = clientContent.str.substr(0, clientContent.index);\n                },\n                complete: function complete() {\n                  var writeAnimation = HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_C, false, false, HelperFunctions.getSetValueText(SET_VALUE1), false, 0);\n                  writeAnimation.finished.then(function () {\n                    var messageToFollowerAnimations = HelperFunctions.logMessageFromLeaderToFollowers(true, HelperFunctions.getSetValueText(SET_VALUE1), false, 0, _this3.nodeATimerAnimation, _this3.nodeBTimerAnimation, _this3.nodeCTimerAnimation);\n                    var finishedPromises = HelperFunctions.getFinishPromises(messageToFollowerAnimations);\n                    Promise.all(finishedPromises).then(function () {\n                      // send confirmation of write to followers\n                      var confWriteToFollowersAnimation = HelperFunctions.logMessageFromLeaderToFollowers(false, HelperFunctions.getSetValueText(SET_VALUE1), true, 600, _this3.nodeATimerAnimation, _this3.nodeBTimerAnimation);\n                      finishedPromises = HelperFunctions.getFinishPromises(confWriteToFollowersAnimation); // and notify client as well\n\n                      HelperFunctions.sendLogMessage(Constants.NODE_C, Constants.CLIENT_NODE); // wait for confirmation to reach followers\n\n                      Promise.all(finishedPromises).then(function () {\n                        _this3.animationState = ANIMATION_STATE_VALUE1_COMMITTED;\n                        resolve({\n                          animationState: _this3.animationState,\n                          delay: 1000\n                        });\n                      });\n                    });\n                  });\n                }\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_VALUE1_COMMITTED:\n          {\n            HelperFunctions.hideElement(document.getElementById('client-message-status'));\n            HelperFunctions.hideElement(document.getElementById('client-message-bubble'));\n            this.changeMainText('Now suppose the original leader gets network partitioned', function () {\n              // partition original leader\n              HelperFunctions.partitionNodeC();\n              _this3.animationState = ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED;\n              resolve({\n                animationState: _this3.animationState,\n                delay: 100\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED:\n          {\n            this.changeMainText('And Node A gets elected as the new leader', function () {\n              // elect Node A as new leader candidate\n              var nodeA = document.getElementById('node-a-circle');\n              nodeA.classList.add('leader-candidate-node');\n              HelperFunctions.setSVGText({\n                targetId: 'node-a-term-text',\n                text: \"Term: 2\"\n              });\n              HelperFunctions.setSVGText({\n                targetId: 'node-b-term-text',\n                text: \"Term: 2\"\n              });\n              _this3.animationState = ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED;\n              resolve({\n                animationState: _this3.animationState,\n                delay: 1000\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED:\n          {\n            this.changeMainText('Client tries to write to new leader but update fails, as old leader can still serve reads', function () {\n              _this3.resumeTimers();\n\n              var messageContrainerElement = document.getElementById('client-message');\n              var messageElement = document.getElementById('client-message-circle');\n              var messageTextElement = document.getElementById('client-message-text');\n              HelperFunctions.messageFromClient(Constants.NODE_A, {\n                onBegin: function onBegin() {\n                  HelperFunctions.showElement(messageContrainerElement);\n                  messageElement.classList.add('log-message');\n                  HelperFunctions.setSVGText({\n                    targetId: 'client-message-text',\n                    text: ''\n                  });\n                },\n                onChangeComplete: function onChangeComplete() {\n                  messageElement.classList.remove('log-message');\n                  messageElement.classList.add('error-message');\n                  HelperFunctions.setSVGText({\n                    targetId: 'client-message-text',\n                    text: 'Rejected'\n                  }); // messageTextElement\n                },\n                onComplete: function onComplete() {\n                  messageElement.classList.remove('error-message');\n                  HelperFunctions.hideElement(messageContrainerElement);\n                  messageContrainerElement.style.transform = 'none';\n                  HelperFunctions.setSVGText({\n                    targetId: 'client-message-text',\n                    text: ''\n                  });\n                },\n                alternate: true\n              });\n\n              _this3.nodeCTimerAnimation.finished.then(function () {\n                _this3.nodeCTimerAnimation = null;\n\n                _this3.changeMainText(\"Original leader lease time has expired and it has stepped down\");\n\n                var nodeC = document.getElementById('node-c-circle');\n                nodeC.classList.remove('leader-node');\n              });\n\n              _this3.nodeATimerAnimation.finished.then(function () {\n                var nodeA = document.getElementById('node-a-circle');\n                nodeA.classList.remove('leader-candidate-node');\n                nodeA.classList.add('leader-node');\n\n                _this3.changeMainText(\"Node A's leader lease timer has expired as well and has become the new leader now\", function () {\n                  _this3.pauseTimers();\n\n                  _this3.animationState = ANIMATION_STATE_NEW_LEADER_ELECTED; // Make sure we perform next before the new leader's timer expires\n\n                  resolve({\n                    animationState: _this3.animationState,\n                    delay: 100\n                  });\n                }, 0);\n              });\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_NEW_LEADER_ELECTED:\n          {\n            // hide Node A's leader lease timer\n            HelperFunctions.hideElement(document.getElementById(HelperFunctions.leaderLeaseTimerId(Constants.NODE_A))); // and start its my lease timer\n\n            this.nodeATimerAnimation = HelperFunctions.startMyLeaseTimer(Constants.NODE_A, NODE_A_TIMER_DURATION); // then send leader lease message to B\n\n            var leaseToB = document.getElementById('node-a-lease-to-node-b');\n            var nodeBLeaseAnimation = anime({\n              targets: leaseToB,\n              translateX: 150,\n              translateY: -280,\n              easing: 'linear',\n              duration: 1500,\n              begin: function begin() {\n                HelperFunctions.showElement(leaseToB);\n              },\n              complete: function complete() {\n                HelperFunctions.hideElement(leaseToB);\n                leaseToB.style.transform = 'none';\n\n                _this3.nodeBTimerAnimation.restart();\n\n                _this3.animationState = ANIMATION_STATE_NEW_LEADER_SENT_LEASES;\n                resolve({\n                  animationState: _this3.animationState,\n                  delay: 100\n                });\n              }\n            });\n            break;\n          }\n\n        case ANIMATION_STATE_NEW_LEADER_SENT_LEASES:\n          {\n            this.changeMainText(\"From here on, client can write messages to the new leader\", function () {\n              // initiate a raft round\n              // client message to A\n              var animation = HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_A, false, false, HelperFunctions.getSetValueText(SET_VALUE2), false, 0);\n              animation.finished.then(function () {\n                // message with ack from A to B\n                var messageToBAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, true, false, HelperFunctions.getSetValueText(SET_VALUE2), false, 0, _this3.nodeBTimerAnimation, _this3.nodeATimerAnimation);\n                messageToBAnimation.finished.then(function () {\n                  // confirmation message back to B and the client\n                  var confirmToClientAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.CLIENT_NODE, false, false, HelperFunctions.getSetValueText(SET_VALUE2), 0);\n                  var confirmToBAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, false, false, HelperFunctions.getSetValueText(SET_VALUE2), true, 300, _this3.nodeBTimerAnimation);\n                  Promise.all([confirmToClientAnimation.finished, confirmToBAnimation.finished]).then(function () {\n                    _this3.animationState = Constants.ANIMATION_STATE_FINISHED;\n\n                    _this3.stopTimers();\n\n                    _this3.setState({\n                      animationFinished: true\n                    });\n\n                    resolve({\n                      animationState: _this3.animationState,\n                      delay: 100\n                    });\n                  });\n                });\n              });\n            });\n            break;\n          }\n\n        case Constants.ANIMATION_STATE_FINISHED:\n          {\n            console.log('Animation finished. Nothing to do');\n            resolve({\n              animationState: this.animationState,\n              delay: 100\n            });\n            break;\n          }\n\n        default:\n          console.error('Unrecognized state: ' + this.animationState);\n      }\n    }\n  }, {\n    key: \"changeMainText\",\n    value: function changeMainText(text, onComplete, delay) {\n      HelperFunctions.setTextWithAnimation(this.mainTextSect, text, onComplete, delay);\n    }\n  }, {\n    key: \"restartTimers\",\n    value: function restartTimers() {\n      if (this.nodeATimerAnimation) {\n        this.nodeATimerAnimation.restart();\n      }\n\n      if (this.nodeBTimerAnimation) {\n        this.nodeBTimerAnimation.restart();\n      }\n\n      if (this.nodeCTimerAnimation) {\n        this.nodeCTimerAnimation.restart();\n      }\n    }\n  }, {\n    key: \"stopTimers\",\n    value: function stopTimers() {\n      this.timersAreActive = false;\n      this.pauseTimers();\n    }\n  }, {\n    key: \"pauseTimers\",\n    value: function pauseTimers() {\n      if (this.nodeATimerAnimation) {\n        this.nodeATimerAnimation.pause();\n      }\n\n      if (this.nodeBTimerAnimation) {\n        this.nodeBTimerAnimation.pause();\n      }\n\n      if (this.nodeCTimerAnimation) {\n        this.nodeCTimerAnimation.pause();\n      }\n    }\n  }, {\n    key: \"resumeTimers\",\n    value: function resumeTimers() {\n      if (this.nodeATimerAnimation) {\n        this.nodeATimerAnimation.play();\n      }\n\n      if (this.nodeBTimerAnimation) {\n        this.nodeBTimerAnimation.play();\n      }\n\n      if (this.nodeCTimerAnimation) {\n        this.nodeCTimerAnimation.play();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 504\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        id: \"main-diagram\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 505\n        },\n        __self: this\n      }, React.createElement(MainDiagram, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 506\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        id: \"main-text-sect\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 508\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return LeaderLeaseAnimation;\n}(Component);\nexport default LeaderLeaseAnimation;","map":{"version":3,"sources":["/Users/andrew/code/yb-architecture/animations/src/LeaderLeasesAnimation.js"],"names":["React","Component","anime","MainDiagram","Constants","HelperFunctions","require","ANIMATION_STATE_INITIAL","ANIMATION_STATE_LEADER_REPLICATES_LEASE","ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS","ANIMATION_STATE_LEADER_READS_PROTOCOL","ANIMATION_STATE_START_LEADER_LEASE","ANIMATION_STATE_CLIENT_WROTE_TO_ORIGINAL_LEADER","ANIMATION_STATE_VALUE1_COMMITTED","ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED","ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED","ANIMATION_STATE_NEW_LEADER_ELECTED","ANIMATION_STATE_TIMER_STARTED_ON_ORIGINAL_LEADER","ANIMATION_STATE_TIMER_STARTED_ON_NEW_LEADER","ANIMATION_STATE_POST_NEW_LEADER_VALUE2_COMMITTED","ANIMATION_STATE_POST_NEW_LEADER_LOG_ACK_RECEIVED_FROM_FOLLOWER","ANIMATION_STATE_NEW_LEADER_SENT_LEASES","SET_VALUE1","SET_VALUE2","ORIGINAL_LEADER_TIMER_DURATION","NODE_A_TIMER_DURATION","NODE_B_TIMER_DURATION","LeaderLeaseAnimation","props","animationState","state","init","nodeATimerAnimation","nodeBTimerAnimation","nodeCTimerAnimation","mainTextSect","document","getElementById","timersAreActive","pauseTimers","resumeTimers","Promise","resolve","reject","onNextInternal","nodeATextContainer","nodeBTextContainer","nodeCTextContainer","nodeATermText","nodeBTermText","nodeCTermText","nodeATermHighlight","nodeBTermHighlight","nodeAExtraText","nodeBExtraText","nodeCExtraText","nodeAExtraHighlight","nodeBExtraHighlight","nodeCExtraHighlight","nodeAExtraText2","nodeBExtraText2","nodeCExtraText2","nodeAMessageBubble","nodeAMessageStatus","nodeCMessageBubble","nodeCMessageStatus","clientMessageBubble","clientMessageStatus","nodeOuterCircles","getElementsByClassName","i","length","hideElement","changeMainText","nodeC","classList","add","showElement","innerHTML","delay","statusText1","statusText2","contentLine1","index","str","contentLine2","targets","easing","duration","update","textContent","substr","complete","startMyLeaseTimer","NODE_C","console","log","leaseToA","nodeALeaseAnimation","translateX","translateY","begin","style","transform","leaseToB","nodeBLeaseAnimation","all","finished","then","startLeaderLeaseTimer","NODE_A","NODE_B","introduceClientAnimation","introduceClient","statusElem","clientContent","statusText","writeAnimation","sendLogMessage","CLIENT_NODE","getSetValueText","messageToFollowerAnimations","logMessageFromLeaderToFollowers","finishedPromises","getFinishPromises","confWriteToFollowersAnimation","partitionNodeC","nodeA","setSVGText","targetId","text","messageContrainerElement","messageElement","messageTextElement","messageFromClient","onBegin","onChangeComplete","remove","onComplete","alternate","leaderLeaseTimerId","restart","animation","messageToBAnimation","confirmToClientAnimation","confirmToBAnimation","ANIMATION_STATE_FINISHED","stopTimers","setState","animationFinished","error","setTextWithAnimation","pause","play"],"mappings":"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","sourcesContent":["\nimport React, { Component } from 'react';\nimport './App.css';\nimport anime from 'animejs/lib/anime.es.js';\nimport MainDiagram from './svg/MainDiagram';\nimport { Constants } from './constants';\n\nvar HelperFunctions = require('./HelperFunctions');\n\n\nconst ANIMATION_STATE_INITIAL = \"LEADER_LEASE_INITIAL\";\nconst ANIMATION_STATE_LEADER_REPLICATES_LEASE = \"ANIMATION_STATE_LEADER_REPLICATES_LEASE\";\nconst ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS = \"ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS\";\nconst ANIMATION_STATE_LEADER_READS_PROTOCOL = 'ANIMATION_STATE_LEADER_READS_PROTOCOL';\nconst ANIMATION_STATE_START_LEADER_LEASE = 'ANIMATION_STATE_START_LEADER_LEASE';\nconst ANIMATION_STATE_CLIENT_WROTE_TO_ORIGINAL_LEADER = \"ANIMATION_STATE_CLIENT_WROTE_TO_ORIGINAL_LEADER\";\nconst ANIMATION_STATE_VALUE1_COMMITTED = \"ANIMATION_STATE_VALUE1_COMMITTED\";\nconst ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED = \"ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED\";\nconst ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED = \"ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED\";\nconst ANIMATION_STATE_NEW_LEADER_ELECTED = \"ANIMATION_STATE_NEW_LEADER_ELECTED\";\nconst ANIMATION_STATE_TIMER_STARTED_ON_ORIGINAL_LEADER = \"ANIMATION_STATE_TIMER_STARTED_ON_ORIGINAL_LEADER\";\nconst ANIMATION_STATE_TIMER_STARTED_ON_NEW_LEADER = \"ANIMATION_STATE_TIMER_STARTED_ON_NEW_LEADER\";\nconst ANIMATION_STATE_POST_NEW_LEADER_VALUE2_COMMITTED = \"ANIMATION_STATE_POST_NEW_LEADER_VALUE2_COMMITTED\";\nconst ANIMATION_STATE_POST_NEW_LEADER_LOG_ACK_RECEIVED_FROM_FOLLOWER = \"ANIMATION_STATE_POST_NEW_LEADER_LOG_ACK_RECEIVED_FROM_FOLLOWER\";\nconst ANIMATION_STATE_NEW_LEADER_SENT_LEASES = \"ANIMATION_STATE_NEW_LEADER_SENT_LEASES\";\n\nconst SET_VALUE1=\"V1\";\nconst SET_VALUE2=\"V2\";\nconst ORIGINAL_LEADER_TIMER_DURATION = 16000;\nconst NODE_A_TIMER_DURATION = 14000;\nconst NODE_B_TIMER_DURATION = 30000;\n\nexport class LeaderLeaseAnimation extends Component {\n\tconstructor(props) {\n    super(props);\n    this.animationState = ANIMATION_STATE_INITIAL;\n\t\tthis.state = {\n\t\t}\n\t\tthis.init();\n\t}\n\tinit() {\n\t\tthis.nodeATimerAnimation = null;\n\t\tthis.nodeBTimerAnimation = null;\n\t\tthis.nodeCTimerAnimation = null;\n\t}\n\tcomponentDidMount() {\n\t\tthis.mainTextSect = document.getElementById('center-message-text');\n\t\tthis.timersAreActive = false;\n\t}\n\n\tpause() {\n\t\tif (this.timersAreActive) {\n\t\t\tthis.pauseTimers();\n\t\t}\n\t}\n\tresume() {\n\t\tif (this.timersAreActive) {\n\t\t\tthis.resumeTimers();\n\t\t}\n\t}\n\tonNext() {\n\t\treturn new Promise((resolve,reject) => {\n\t\t\tthis.onNextInternal(resolve,reject);\n\t\t});\n\t}\n\n\tonNextInternal(resolve,reject) {\n\t\t// Text Containers underneath each Node\n    const nodeATextContainer = document.getElementById('node-a-term-text-rect');\n    const nodeBTextContainer = document.getElementById('node-b-term-text-rect');\n    const nodeCTextContainer = document.getElementById('node-c-term-text-rect');\n    // Text Term (Line 1)\n    const nodeATermText = document.getElementById('node-a-term-text');\n    const nodeBTermText = document.getElementById('node-b-term-text');\n    const nodeCTermText = document.getElementById('node-c-term-text');\n    // Highlight for Text Term (Line 1) -> Only 2 needed\n    const nodeATermHighlight = document.getElementById('node-a-term-highlight');\n    const nodeBTermHighlight = document.getElementById('node-b-term-highlight');\n    // Text Extra (Line 2)\n    const nodeAExtraText = document.getElementById('node-a-extra-text');\n    const nodeBExtraText = document.getElementById('node-b-extra-text');\n    const nodeCExtraText = document.getElementById('node-c-extra-text');\n    // Highlight for Text Extra (Line 2)\n    const nodeAExtraHighlight = document.getElementById('node-a-text-highlight');\n    const nodeBExtraHighlight = document.getElementById('node-b-text-highlight');\n    const nodeCExtraHighlight = document.getElementById('node-c-text-highlight');\n    // Text Extra (Line 3)\n    const nodeAExtraText2 = document.getElementById('node-a-extra-text2');\n    const nodeBExtraText2 = document.getElementById('node-b-extra-text2');\n    const nodeCExtraText2 = document.getElementById('node-c-extra-text2'); \n\n    // MESSAGE OBJECTS\n    const nodeAMessageBubble = document.getElementById('node-a-message-bubble');\n    const nodeAMessageStatus = document.getElementById('node-a-message-status');\n    const nodeCMessageBubble = document.getElementById('node-c-message-bubble');\n    const nodeCMessageStatus = document.getElementById('node-c-message-status');\n    const clientMessageBubble = document.getElementById('client-message-bubble');\n    const clientMessageStatus = document.getElementById('client-message-status');\n\n\t\tswitch(this.animationState) {\n\t\t\tcase ANIMATION_STATE_INITIAL: {\n\t\t\t\t//////////////////// initial setup ////////////////////\n\n\t\t\t\t// hide all outer circles (TODO: revisit this approach)\n\t\t\t\tvar nodeOuterCircles = document.getElementsByClassName('node-outer-circle');\n\t\t\t\tfor (var i = 0; i < nodeOuterCircles.length; i++){\n\t\t\t\t\tHelperFunctions.hideElement(nodeOuterCircles[i]);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//////////////////////////////////////////////////////\n\t\t\t\tthis.changeMainText('Let\\'s say we have a 3-node raft group.<br />C is the raft leader, all nodes have data <br />k = V1', () => {\n          // make Node C  the leader\n          var nodeC = document.getElementById('node-c-circle');\n          nodeC.classList.add('leader-node');\n          HelperFunctions.showElement(nodeATextContainer);\n          HelperFunctions.showElement(nodeBTextContainer);\n          HelperFunctions.showElement(nodeCTextContainer);\n\n          nodeATermText.innerHTML = 'Term: 1';\n          nodeBTermText.innerHTML = 'Term: 1';\n          nodeCTermText.innerHTML = 'Term: 1';\n\n          nodeAExtraText.innerHTML = '(k, V1)';\n          nodeBExtraText.innerHTML = '(k, V1)';\n          nodeCExtraText.innerHTML = '(k, V1)';\n          this.animationState = ANIMATION_STATE_LEADER_READS_PROTOCOL;\n          resolve({\n            animationState: this.animationState,\n            delay: 1000,\n          });\n\t\t\t\t});\n\t\t\t\tbreak;\n      }\n      case ANIMATION_STATE_LEADER_READS_PROTOCOL: {\n        this.changeMainText('Performing raft-protocol, leader-only reads safely using leader leases', () => {\n          this.animationState = ANIMATION_STATE_START_LEADER_LEASE;\n          resolve({\n            animationState: this.animationState,\n            delay: 1000,\n          });\n        });\n        break;\n      }\n      case ANIMATION_STATE_START_LEADER_LEASE: {\n        this.changeMainText('');\n        HelperFunctions.showElement(nodeCMessageBubble);\n        HelperFunctions.showElement(nodeCMessageStatus);\n        const statusText1 = document.getElementById('node-c-message-status-text1');\n        const statusText2 = document.getElementById('node-c-message-status-text2');\n\n        const contentLine1 = {\n          index: 0,\n          str: 'Raft leader starts a'\n        }\n        const contentLine2 = {\n          index: 0,\n          str: 'new lease timer for itself'\n        }\n        anime({\n          targets: contentLine1,\n          index: contentLine1.str.length,\n          easing: 'linear',\n          duration: 600,\n          update: function() {\n            statusText1.textContent = contentLine1.str.substr(0, contentLine1.index);\n          },\n          complete: () => {\n            anime({\n              targets: contentLine2,\n              index: contentLine2.str.length,\n              easing: 'linear',\n              duration: 600,\n              update: function() {\n                statusText2.textContent = contentLine2.str.substr(0, contentLine2.index);\n              },\n              complete: () => {\n                this.timersAreActive = true;\n                // this.nodeCTimerAnimation = HelperFunctions.startLeaseTimer(Constants.NODE_C, ORIGINAL_LEADER_TIMER_DURATION);\n                this.nodeCTimerAnimation = HelperFunctions.startMyLeaseTimer(Constants.NODE_C, 1000, 90);\n                console.log(this.nodeCTimerAnimation);\n                // this.nodeCTimerAnimation.finished.then((args) => {\n                  this.animationState = ANIMATION_STATE_LEADER_REPLICATES_LEASE;\n                  resolve({\n                    animationState: this.animationState,\n                    delay: 100,\n                  });\n                // });\n              }\n            });\n          }\n        });\n        break;\n      }\n\t\t\tcase ANIMATION_STATE_LEADER_REPLICATES_LEASE: {\n\t\t\t\t// this.changeMainText('Leader replicates a lease interval to followers', () => {\n        HelperFunctions.hideElement(nodeCMessageBubble);\n        HelperFunctions.hideElement(nodeCMessageStatus);\n        // this.timersAreActive = true;\n        // // this.nodeCTimerAnimation = HelperFunctions.startLeaseTimer(Constants.NODE_C, ORIGINAL_LEADER_TIMER_DURATION);\n        // this.nodeCTimerAnimation = HelperFunctions.startMyLeaseTimer(Constants.NODE_C, ORIGINAL_LEADER_TIMER_DURATION);\n        HelperFunctions.showElement(document.getElementById('node-c-message-bubble-alt'));\n        document.getElementById('node-c-message-text-alt').innerHTML = 'Raft leader then replicates a \\nlease interval to followers. Note that\\nthe Leader Lease timer on C has started before replicating to A and B.'\n        var leaseToA = document.getElementById('node-c-lease-to-node-a');\n        var nodeALeaseAnimation = anime({\n          targets: leaseToA,\n          translateX: -280,\n          translateY: 0,\n          easing: 'linear',\n          duration: 1500,\n          begin: () => {\n            HelperFunctions.showElement(leaseToA);\n          },\n          complete: () =>{\n            HelperFunctions.hideElement(leaseToA);\n            leaseToA.style.transform = 'none';\n          },\n        });\n\n        var leaseToB = document.getElementById('node-c-lease-to-node-b');\n        var nodeBLeaseAnimation = anime({\n          targets: leaseToB,\n          translateX: -150,\n          translateY: -280,\n          easing: 'linear',\n          duration: 1500,\n          begin: () => {\n            HelperFunctions.showElement(leaseToB);\n          },\n          complete: () =>{\n            HelperFunctions.hideElement(leaseToB);\n            leaseToB.style.transform = 'none';\n          },\n        });\n        Promise.all([nodeALeaseAnimation.finished,nodeBLeaseAnimation.finished]).then(() => {\n          // this.startTimers();\n          this.nodeATimerAnimation = HelperFunctions.startLeaderLeaseTimer(Constants.NODE_A, NODE_A_TIMER_DURATION);\n          this.nodeBTimerAnimation = HelperFunctions.startLeaderLeaseTimer(Constants.NODE_B, NODE_B_TIMER_DURATION);\n\n          this.animationState = ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS;\n          resolve({\n            animationState: this.animationState,\n            delay: 500,\n          });\n        });\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_LEASES_SENT_TO_FOLLOWERS: {\n        this.changeMainText('');\n        var introduceClientAnimation = HelperFunctions.introduceClient(`Value: ${SET_VALUE1}`);\n        introduceClientAnimation.finished.then(() => {\n          const statusElem = document.getElementById('client-message-status');\n          const clientContent = {\n            index: 0,\n            str: `SET k = ${SET_VALUE1}`\n          }\n          const statusText = document.getElementById('client-message-status-text2');\n          \n          document.getElementById('client-message-status-text1').textContent = 'Client: ';\n          HelperFunctions.showElement(document.getElementById('client-message-bubble'));\n          HelperFunctions.showElement(statusElem);\n          anime({\n            targets: clientContent,\n            index: clientContent.str.length,\n            easing: 'linear',\n            duration: 600,\n            update: function() {\n              statusText.textContent = clientContent.str.substr(0, clientContent.index);\n            },\n            complete: () => {\n              var writeAnimation = HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_C, false, false, HelperFunctions.getSetValueText(SET_VALUE1), false, 0);\n              writeAnimation.finished.then(() => {\n                var messageToFollowerAnimations = HelperFunctions.logMessageFromLeaderToFollowers(true,HelperFunctions.getSetValueText(SET_VALUE1), false, 0, this.nodeATimerAnimation, this.nodeBTimerAnimation, this.nodeCTimerAnimation);\n                var finishedPromises = HelperFunctions.getFinishPromises(messageToFollowerAnimations);\n\n                Promise.all(finishedPromises).then(() => {\n                  // send confirmation of write to followers\n                  var confWriteToFollowersAnimation = HelperFunctions.logMessageFromLeaderToFollowers(false, HelperFunctions.getSetValueText(SET_VALUE1), true,600, this.nodeATimerAnimation, this.nodeBTimerAnimation);\n                  finishedPromises = HelperFunctions.getFinishPromises(confWriteToFollowersAnimation);\n\n                  // and notify client as well\n                  HelperFunctions.sendLogMessage(Constants.NODE_C, Constants.CLIENT_NODE);\n\n                  // wait for confirmation to reach followers\n                  Promise.all(finishedPromises).then(() => {\n                    this.animationState = ANIMATION_STATE_VALUE1_COMMITTED;\n                    resolve({\n                      animationState: this.animationState,\n                      delay: 1000,\n                    });\n                  });\n                });\n              });\n            }\n          });\n        });\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_VALUE1_COMMITTED: {\n        HelperFunctions.hideElement(document.getElementById('client-message-status'));\n        HelperFunctions.hideElement(document.getElementById('client-message-bubble'));\n\t\t\t\tthis.changeMainText('Now suppose the original leader gets network partitioned', () => {\n\t\t\t\t\t// partition original leader\n\t\t\t\t\tHelperFunctions.partitionNodeC();\n\n\t\t\t\t\tthis.animationState = ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED;\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\tdelay: 100,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED: {\n\t\t\t\tthis.changeMainText('And Node A gets elected as the new leader', () => {\n\t\t\t\t\t// elect Node A as new leader candidate\n\t\t\t\t\tvar nodeA = document.getElementById('node-a-circle');\n\t\t\t\t\tnodeA.classList.add('leader-candidate-node');\n\t\t\t\t\tHelperFunctions.setSVGText({targetId: 'node-a-term-text', text: \"Term: 2\"});\n\t\t\t\t\tHelperFunctions.setSVGText({targetId: 'node-b-term-text', text: \"Term: 2\"});\n\n\t\t\t\t\tthis.animationState = ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED;\n\t\t\t\t\tresolve({\n\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\tdelay: 1000,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED: {\n\t\t\t\tthis.changeMainText('Client tries to write to new leader but update fails, as old leader can still serve reads', () => {\n\t\t\t\t\t\tthis.resumeTimers();\n\n\t\t\t\t\t\tvar messageContrainerElement = document.getElementById('client-message');\n\t\t\t\t\t\tvar messageElement = document.getElementById('client-message-circle');\n\t\t\t\t\t\tvar messageTextElement = document.getElementById('client-message-text');\n\n\t\t\t\t\t\tHelperFunctions.messageFromClient(Constants.NODE_A,\t{\n\t\t\t\t\t\t\tonBegin: () => {\n\t\t\t\t\t\t\t\tHelperFunctions.showElement(messageContrainerElement);\n\t\t\t\t\t\t\t\tmessageElement.classList.add('log-message');\n\t\t\t\t\t\t\t\tHelperFunctions.setSVGText({targetId: 'client-message-text', text: ''});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonChangeComplete: () => {\n\t\t\t\t\t\t\t\tmessageElement.classList.remove('log-message');\n\t\t\t\t\t\t\t\tmessageElement.classList.add('error-message');\n\t\t\t\t\t\t\t\tHelperFunctions.setSVGText({targetId: 'client-message-text', text: 'Rejected'});\n\t\t\t\t\t\t\t\t// messageTextElement\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonComplete: () => {\n\t\t\t\t\t\t\t\tmessageElement.classList.remove('error-message');\n\t\t\t\t\t\t\t\tHelperFunctions.hideElement(messageContrainerElement);\n\t\t\t\t\t\t\t\tmessageContrainerElement.style.transform = 'none';\n\t\t\t\t\t\t\t\tHelperFunctions.setSVGText({targetId: 'client-message-text', text: ''});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\talternate: true,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.nodeCTimerAnimation.finished.then(() => {\n\t\t\t\t\t\t\tthis.nodeCTimerAnimation = null;\n\n\t\t\t\t\t\t\tthis.changeMainText(\"Original leader lease time has expired and it has stepped down\");\n\t\t\t\t\t\t\tvar nodeC = document.getElementById('node-c-circle');\n\t\t\t\t\t\t\tnodeC.classList.remove('leader-node');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.nodeATimerAnimation.finished.then(() => {\n\t\t\t\t\t\t\tvar nodeA = document.getElementById('node-a-circle');\n\t\t\t\t\t\t\tnodeA.classList.remove('leader-candidate-node');\n\t\t\t\t\t\t\tnodeA.classList.add('leader-node');\n\n\t\t\t\t\t\t\tthis.changeMainText(\"Node A's leader lease timer has expired as well and has become the new leader now\", () => {\n\t\t\t\t\t\t\t\tthis.pauseTimers();\n\t\t\t\t\t\t\t\tthis.animationState = ANIMATION_STATE_NEW_LEADER_ELECTED;\n\n\t\t\t\t\t\t\t\t// Make sure we perform next before the new leader's timer expires\n\t\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\t\t\t\tdelay: 100,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_NEW_LEADER_ELECTED: {\n\t\t\t\t// hide Node A's leader lease timer\n\t\t\t\tHelperFunctions.hideElement(document.getElementById(HelperFunctions.leaderLeaseTimerId(Constants.NODE_A)));\n\n\t\t\t\t// and start its my lease timer\n\t\t\t\tthis.nodeATimerAnimation = HelperFunctions.startMyLeaseTimer(Constants.NODE_A, NODE_A_TIMER_DURATION);\n\n\t\t\t\t// then send leader lease message to B\n\t\t\t\tvar leaseToB = document.getElementById('node-a-lease-to-node-b');\n\t\t\t\tvar nodeBLeaseAnimation = anime({\n\t\t\t\t\ttargets: leaseToB,\n\t\t\t\t\ttranslateX: 150,\n\t\t\t\t\ttranslateY: -280,\n\t\t\t\t\teasing: 'linear',\n\t\t\t\t\tduration: 1500,\n\t\t\t\t\tbegin: () => {\n\t\t\t\t\t\tHelperFunctions.showElement(leaseToB);\n\t\t\t\t\t},\n\t\t\t\t\tcomplete: () =>{\n\t\t\t\t\t\tHelperFunctions.hideElement(leaseToB);\n\t\t\t\t\t\tleaseToB.style.transform = 'none';\n\n\t\t\t\t\t\tthis.nodeBTimerAnimation.restart();\n\t\t\t\t\t\tthis.animationState = ANIMATION_STATE_NEW_LEADER_SENT_LEASES;\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\t\tdelay: 100,\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ANIMATION_STATE_NEW_LEADER_SENT_LEASES: {\n\t\t\t\tthis.changeMainText(\"From here on, client can write messages to the new leader\", () => {\n\t\t\t\t\t// initiate a raft round\n\t\t\t\t\t\n\t\t\t\t\t// client message to A\n\t\t\t\t\tvar animation = HelperFunctions.sendLogMessage(Constants.CLIENT_NODE, Constants.NODE_A, false, false, HelperFunctions.getSetValueText(SET_VALUE2), false, 0);\n\n\t\t\t\t\tanimation.finished.then(() => {\n\t\t\t\t\t\t// message with ack from A to B\n\t\t\t\t\t\tvar messageToBAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, true, false, HelperFunctions.getSetValueText(SET_VALUE2), false, 0, this.nodeBTimerAnimation, this.nodeATimerAnimation);\n\n\t\t\t\t\t\tmessageToBAnimation.finished.then(() => {\n\n\t\t\t\t\t\t\t// confirmation message back to B and the client\n\t\t\t\t\t\t\tvar confirmToClientAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.CLIENT_NODE, false, false, HelperFunctions.getSetValueText(SET_VALUE2), 0);\n\t\t\t\t\t\t\tvar confirmToBAnimation = HelperFunctions.sendLogMessage(Constants.NODE_A, Constants.NODE_B, false, false, HelperFunctions.getSetValueText(SET_VALUE2), true, 300, this.nodeBTimerAnimation);\n\n\t\t\t\t\t\t\tPromise.all([confirmToClientAnimation.finished, confirmToBAnimation.finished]).then(() => {\n\n                this.animationState = Constants.ANIMATION_STATE_FINISHED;\n                this.stopTimers();\n                this.setState({ animationFinished: true });\n\t\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\t\t\t\t\tdelay: 100,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase Constants.ANIMATION_STATE_FINISHED: {\n\t\t\t\tconsole.log('Animation finished. Nothing to do');\n\t\t\t\tresolve({\n\t\t\t\t\tanimationState: this.animationState,\n\t\t\t\t\tdelay: 100,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tconsole.error('Unrecognized state: ' + this.animationState);\n\t\t}\n\t}\n\tchangeMainText(text, onComplete, delay) {\n\t\tHelperFunctions.setTextWithAnimation(this.mainTextSect, text, onComplete, delay);\n\t}\n\trestartTimers() {\n\t\tif (this.nodeATimerAnimation) {\n\t\t\tthis.nodeATimerAnimation.restart();\n\t\t}\n\t\tif (this.nodeBTimerAnimation) {\n\t\t\tthis.nodeBTimerAnimation.restart();\n\t\t}\n\t\tif (this.nodeCTimerAnimation) {\n\t\t\tthis.nodeCTimerAnimation.restart();\n\t\t}\n\t}\n\tstopTimers() {\n\t\tthis.timersAreActive = false;\n\t\tthis.pauseTimers();\n\t}\n\tpauseTimers() {\n\t\tif (this.nodeATimerAnimation) {\n\t\t\tthis.nodeATimerAnimation.pause();\n\t\t}\n\t\tif (this.nodeBTimerAnimation) {\n\t\t\tthis.nodeBTimerAnimation.pause();\n\t\t}\n\t\tif (this.nodeCTimerAnimation) {\n\t\t\tthis.nodeCTimerAnimation.pause();\n\t\t}\n\t}\n\tresumeTimers() {\n\t\tif (this.nodeATimerAnimation) {\n\t\t\tthis.nodeATimerAnimation.play();\n\t\t}\n\t\tif (this.nodeBTimerAnimation) {\n\t\t\tthis.nodeBTimerAnimation.play();\n\t\t}\n\t\tif (this.nodeCTimerAnimation) {\n\t\t\tthis.nodeCTimerAnimation.play();\n\t\t}\n\t}\n\n\trender() {\n\t\treturn(\n\t\t\t<div>\n\t\t\t\t<div id=\"main-diagram\" >\n\t\t\t\t\t<MainDiagram/>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"main-text-sect\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default LeaderLeaseAnimation;\n"]},"metadata":{},"sourceType":"module"}