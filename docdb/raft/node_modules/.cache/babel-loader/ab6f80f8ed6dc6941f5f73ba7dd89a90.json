{"ast":null,"code":"import anime from 'animejs/lib/anime.es.js';\nimport { Constants } from './constants';\nimport { clientNodePositions } from './svg/MainDiagram'; // Set text content of a SVG text element\n// params:{\n//\ttargetId:\n//\ttext:\n//\taddCSSClass:\n//\tshowElement:\n//}\n\nexport function setSVGText(params) {\n  var target = document.getElementById(params.targetId);\n\n  if (params.text) {\n    target.textContent = params.text;\n  }\n\n  if (params.addCSSClass) {\n    target.classList.add(params.addCSSClass);\n  }\n\n  if (params.removeCSSClass) {\n    target.classList.remove(params.removeCSSClass);\n  }\n\n  if (params.showElement) {\n    showElement(target);\n  }\n}\nexport function showElement(element) {\n  element.classList.remove('visibility-hidden');\n  element.classList.add('visibility-visible');\n}\nexport function hideElement(element) {\n  element.classList.remove('visibility-visible');\n  element.classList.add('visibility-hidden');\n}\nexport function delayedNext(animation, delay) {\n  if (!delay) {\n    delay = Constants.DEFAULT_DELAY;\n  }\n\n  setTimeout(function () {\n    return animation.next();\n  }, delay);\n}\nexport function setTextWithAnimation(textSect, text, onComplete, delay) {\n  textSect.innerHTML = text;\n  var ml4 = {};\n  ml4.opacityIn = [0, 1];\n  ml4.scaleIn = [0.2, 1];\n  ml4.scaleOut = 3;\n  ml4.durationIn = 2000;\n  ml4.durationOut = 2000;\n  ml4.delay = delay ? delay : 500;\n  anime({\n    targets: textSect,\n    opacity: ml4.opacityIn,\n    scale: ml4.scaleIn,\n    duration: ml4.durationIn,\n    complete: onComplete,\n    delay: ml4.delay\n  });\n} ///////////////////////////////////////////////////////////////\n//Animation Helpers. TODO: Maybe they should go in AnimationHelper module?\n//////////////////////////////////////////////////////////////\n\nexport function introduceClient(clientTextValue) {\n  var clientNode = document.getElementById(\"client-node\");\n  showElement(clientNode);\n\n  if (clientTextValue) {\n    setSVGText({\n      targetId: \"client-node-value\",\n      text: clientTextValue\n    });\n  }\n\n  var animation = anime({\n    targets: clientNode,\n    translateY: -84\n  });\n  return animation;\n}\nexport function hideClient() {\n  var clientNode = document.getElementById(\"client-node\");\n  hideElement(clientNode);\n  hideElement(document.getElementById('client-message-circle'));\n}\nexport function messageFromClient(destination, params) {\n  var messageElement = document.getElementById('client-message');\n  var translateX = 0;\n  var translateY = 0;\n\n  switch (destination) {\n    case Constants.NODE_C:\n      {\n        translateX = 140;\n        translateY = -140;\n        break;\n      }\n\n    case Constants.NODE_A:\n      {\n        translateX = -160;\n        translateY = -156;\n        break;\n      }\n\n    default:\n      {\n        console.log('messageFromClient: Unrecognized destination: ' + destination);\n        return;\n      }\n  }\n\n  var animation = anime({\n    targets: messageElement,\n    translateX: translateX,\n    translateY: translateY,\n    easing: 'linear',\n    duration: 800,\n    begin: params.onBegin,\n    complete: params.onComplete,\n    changeComplete: params.onChangeComplete,\n    direction: params.alternate ? 'alternate' : 'normal'\n  });\n  return animation;\n}\nexport function sendLogMessage(fromNode, toNode, returnAck, isAck, value, commitValue, delay, destinationTimerAnimation, srcTimerAnimation) {\n  console.log('FromNode: ' + fromNode + \" toNode: \" + toNode + \" returnAck: \" + returnAck + \" value: \" + value + \" commitValue: \" + commitValue);\n  var method = null;\n  var messageElement = null;\n  var textElementId = null;\n  var sourceNodeTextElementId = null;\n  var messageContrainer = null;\n  var additionalTextElementID = null;\n  var sourceNodeAdditionalTextElementId = null;\n\n  switch (fromNode) {\n    case Constants.NODE_A:\n      {\n        method = messageFromA;\n        sourceNodeTextElementId = 'node-a-extra-text';\n        sourceNodeAdditionalTextElementId = 'node-a-extra-text2';\n\n        if (toNode == Constants.NODE_B) {\n          messageElement = document.getElementById('node-a-message-to-b');\n          textElementId = 'node-b-extra-text';\n          additionalTextElementID = 'node-b-extra-text2';\n        } else if (toNode == Constants.NODE_C) {\n          messageElement = document.getElementById('node-a-message-to-c');\n          textElementId = 'node-c-extra-text';\n          additionalTextElementID = 'node-c-extra-text2';\n        } else if (toNode == Constants.CLIENT_NODE) {\n          messageElement = document.getElementById('node-a-message-to-client');\n        }\n\n        break;\n      }\n\n    case Constants.NODE_B:\n      {\n        method = messageFromB;\n        sourceNodeTextElementId = 'node-b-extra-text';\n        sourceNodeAdditionalTextElementId = 'node-b-extra-text2';\n\n        if (toNode == Constants.NODE_A) {\n          messageElement = document.getElementById('node-b-message-to-a');\n          textElementId = 'node-a-extra-text';\n          additionalTextElementID = 'node-a-extra-text2';\n        } else if (toNode == Constants.NODE_C) {\n          messageElement = document.getElementById('node-b-message-to-c');\n          textElementId = 'node-c-extra-text';\n          additionalTextElementID = 'node-c-extra-text2';\n        }\n\n        break;\n      }\n\n    case Constants.NODE_C:\n      {\n        method = messageFromC;\n        sourceNodeTextElementId = 'node-c-extra-text';\n        sourceNodeAdditionalTextElementId = 'node-c-extra-text2';\n\n        if (toNode == Constants.NODE_A) {\n          messageElement = document.getElementById('node-c-message-to-a');\n          textElementId = 'node-a-extra-text';\n          additionalTextElementID = 'node-a-extra-text2';\n        } else if (toNode == Constants.NODE_B) {\n          messageElement = document.getElementById('node-c-message-to-b');\n          textElementId = 'node-b-extra-text';\n          additionalTextElementID = 'node-b-extra-text2';\n        } else if (toNode == Constants.CLIENT_NODE) {\n          messageElement = document.getElementById('node-c-message-to-client');\n        }\n\n        break;\n      }\n\n    case Constants.CLIENT_NODE:\n      {\n        method = messageFromClient;\n        messageElement = document.getElementById('client-message-circle');\n        messageContrainer = document.getElementById('client-message');\n\n        if (toNode == Constants.NODE_A) {\n          textElementId = 'node-a-extra-text';\n          additionalTextElementID = 'node-a-extra-text2';\n        } else if (toNode == Constants.NODE_B) {\n          textElementId = 'node-b-extra-text';\n          additionalTextElementID = 'node-b-extra-text2';\n        } else if (toNode == Constants.NODE_C) {\n          textElementId = 'node-c-extra-text';\n          additionalTextElementID = 'node-c-extra-text2';\n        }\n\n        break;\n      }\n\n    default:\n      {\n        throw new Error('Unrecognized fromNode: ' + fromNode);\n      }\n  }\n\n  var animation = method(toNode, {\n    delay: delay,\n    destinationTimerAnimation: destinationTimerAnimation,\n    onBegin: function onBegin(anim) {\n      showElement(messageElement);\n\n      if (isAck) {\n        messageElement.classList.remove('log-message');\n        messageElement.classList.add('log-message-ack');\n      } else {\n        messageElement.classList.add('log-message');\n        messageElement.classList.remove('log-message-ack');\n      }\n    },\n    onChangeComplete: function onChangeComplete(anim) {\n      console.log('In onChangeComplete. messageElement: ' + messageElement);\n\n      if (destinationTimerAnimation) {\n        console.log('Will restart timer animation');\n        destinationTimerAnimation.restart();\n      }\n\n      if (returnAck) {\n        messageElement.classList.remove('log-message');\n        messageElement.classList.add('log-message-ack');\n      }\n\n      var additionalText = null;\n\n      if (value && textElementId) {\n        var addCSSClass = \"\";\n        var removeCSSClass = \"\";\n\n        if (commitValue) {\n          addCSSClass = \"set-text-committed\";\n          removeCSSClass = \"set-text-uncommitted\";\n          additionalText = Constants.COMMITTED;\n        } else {\n          addCSSClass = \"set-text-uncommitted\";\n          removeCSSClass = \"set-text-committed\";\n          additionalText = Constants.UNCOMMITTED;\n        } // setSVGText({\n        // \ttargetId: textElementId,\n        // \ttext: value,\n        // \taddCSSClass: addCSSClass,\n        // \tremoveCSSClass:removeCSSClass,\n        // \tshowElement: !commitValue,\n        // });\n\n\n        console.log('additionalText: ' + additionalText + 'additionalTextElementID: ' + additionalTextElementID);\n\n        if (additionalText != null && additionalTextElementID) {\n          console.log('will update additionalText');\n          setSVGText({\n            targetId: additionalTextElementID,\n            text: additionalText,\n            addCSSClass: addCSSClass,\n            removeCSSClass: removeCSSClass,\n            showElement: !commitValue\n          });\n        }\n      }\n    },\n    onComplete: function onComplete(anim) {\n      if (returnAck) {\n        messageElement.classList.remove('log-message-ack'); // we got the ack back so uncommitted text should be shown as committed now\n\n        if (value && sourceNodeTextElementId) {\n          setSVGText({\n            targetId: sourceNodeTextElementId,\n            addCSSClass: \"set-text-committed\"\n          });\n        }\n\n        if (value && sourceNodeAdditionalTextElementId) {\n          setSVGText({\n            targetId: sourceNodeAdditionalTextElementId,\n            text: Constants.COMMITTED,\n            addCSSClass: \"set-text-committed\"\n          });\n        }\n      }\n\n      if (srcTimerAnimation) {\n        srcTimerAnimation.restart();\n      }\n\n      messageElement.style.transform = 'none';\n\n      if (messageContrainer) {\n        messageContrainer.style.transform = 'none';\n      }\n    },\n    alternate: returnAck\n  });\n  return animation;\n}\nexport function logMessageFromLeaderToFollowers(withAck, value, commitValue, delay, nodeATimerAnimation, nodeBTimerAnimation, nodeCTimerAnimation) {\n  var nodeAAnimation = sendLogMessage(Constants.NODE_C, Constants.NODE_A, withAck, false, value, commitValue, delay, nodeATimerAnimation, nodeCTimerAnimation);\n  var nodeBAnimation = sendLogMessage(Constants.NODE_C, Constants.NODE_B, withAck, false, value, commitValue, delay, nodeBTimerAnimation, nodeCTimerAnimation);\n  return [nodeAAnimation, nodeBAnimation];\n}\nexport function logMessageAckFromFollowersToLeader(value, commitValue, delay, nodeATimerAnimation, nodeBTimerAnimation, nodeCTimerAnimation) {\n  var nodeAAnimation = sendLogMessage(Constants.NODE_A, Constants.NODE_C, false, true, value, commitValue, delay, nodeATimerAnimation, nodeCTimerAnimation);\n  var nodeBAnimation = sendLogMessage(Constants.NODE_B, Constants.NODE_C, false, true, value, commitValue, delay, nodeBTimerAnimation, nodeCTimerAnimation);\n  return [nodeAAnimation, nodeBAnimation];\n}\nexport function getFinishPromises(animations) {\n  var animationPromises = [];\n  animations.forEach(function (currentAnimation) {\n    animationPromises.push(currentAnimation.finished);\n  });\n  return animationPromises;\n}\nexport function messageFromC(destination, params) {\n  var translateX = 0;\n  var translateY = 0;\n  var targets = \"\";\n\n  if (destination == Constants.NODE_B) {\n    translateX = -140;\n    translateY = -276;\n    targets = '#node-c-message-to-b';\n  } else if (destination == Constants.NODE_A) {\n    targets = '#node-c-message-to-a';\n    translateX = -275;\n  } else if (destination == Constants.CLIENT_NODE) {\n    targets = '#node-c-message-to-client';\n    translateX = -130;\n    translateY = 135;\n  }\n\n  var animation = anime({\n    targets: targets,\n    translateX: translateX,\n    translateY: translateY,\n    easing: 'linear',\n    duration: 1000,\n    direction: params.alternate ? 'alternate' : 'normal',\n    begin: params.onBegin,\n    changeComplete: params.onChangeComplete,\n    complete: params.onComplete,\n    delay: params.delay ? params.delay : 0\n  });\n  return animation;\n}\nexport function messageFromA(destination, params) {\n  var translateX = 0;\n  var translateY = 0;\n  var targets = \"\";\n\n  if (destination == Constants.NODE_B) {\n    translateX = 160;\n    translateY = -290;\n    targets = '#node-a-message-to-b';\n  } else if (destination === Constants.NODE_C) {\n    translateX = 275;\n    targets = '#node-a-message-to-c';\n  } else if (destination == Constants.CLIENT_NODE) {\n    translateX = 150;\n    translateY = 148;\n    targets = '#node-a-message-to-client';\n  } else {\n    console.warning('Unsupported destination: ' + destination);\n    return;\n  }\n\n  var animation = anime({\n    targets: targets,\n    translateX: translateX,\n    translateY: translateY,\n    easing: 'linear',\n    duration: 1000,\n    direction: params.alternate ? 'alternate' : 'normal',\n    begin: params.onBegin,\n    changeComplete: params.onChangeComplete,\n    complete: params.onComplete,\n    delay: params.delay ? params.delay : 0\n  });\n  return animation;\n}\nexport function messageFromB(destination, params) {\n  var translateX = 0;\n  var translateY = 0;\n  var targets = \"\";\n\n  if (destination == Constants.NODE_A) {\n    translateX = -160;\n    translateY = 290;\n    targets = '#node-b-message-to-a';\n  } else if (destination === Constants.NODE_C) {\n    translateX = 140;\n    translateY = 276;\n    targets = '#node-b-message-to-c';\n  } else {\n    console.warning('Unsupported destination: ' + destination);\n    return;\n  }\n\n  var animation = anime({\n    targets: targets,\n    translateX: translateX,\n    translateY: translateY,\n    easing: 'linear',\n    duration: 1000,\n    direction: params.alternate ? 'alternate' : 'normal',\n    begin: params.onBegin,\n    changeComplete: params.onChangeComplete,\n    complete: params.onComplete,\n    delay: params.delay ? params.delay : 0\n  });\n  return animation;\n}\nexport function getSetValueText(value) {\n  return \"Value: \" + value;\n}\nexport function partitionNodeC() {\n  var nodeCPartition = document.getElementById('node-c-partition-wrap');\n  showElement(nodeCPartition);\n}\nexport function startMyLeaseTimer(forNode, duration, percent) {\n  var targetId = myLeaseTimerId(forNode);\n  return startLeaseTimer(targetId, duration, percent);\n}\nexport function startLeaderLeaseTimer(forNode, duration, percent) {\n  var targetId = leaderLeaseTimerId(forNode);\n  return startLeaseTimer(targetId, duration, percent);\n}\n/**\n * Function that returns animation for a lease timer. This animation will run for\n * a specific `duration` until it reaches the specified `percent` limit.\n * @param {string} targetId String of html element id for this animation to run on\n * @param {number} duration Milliseconds until animation finishes\n * @param {number} percent  Target percentage to be remaining after animation is over, default is 0.\n */\n\nexport function startLeaseTimer(targetId, duration) {\n  var percent = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  var timer = document.getElementById(targetId);\n  showElement(timer);\n  var innerRect = document.getElementById(targetId + '-inner');\n  var calculatedWidth = \"\".concat(percent / 100.0 * 80, \"px\");\n  var animation = anime({\n    targets: innerRect,\n    width: calculatedWidth,\n    easing: 'easeOutCubic',\n    duration: duration\n  });\n  return animation;\n}\nexport function myLeaseTimerId(forNode) {\n  return constructTimerId(\"mlease-rect-\", forNode);\n}\nexport function leaderLeaseTimerId(forNode) {\n  return constructTimerId(\"llease-rect\", forNode);\n}\n\nfunction constructTimerId(prefix, forNode) {\n  var id = prefix;\n\n  switch (forNode) {\n    case Constants.NODE_C:\n      {\n        id += \"node-c\";\n        break;\n      }\n\n    case Constants.NODE_B:\n      {\n        id += \"node-b\";\n        break;\n      }\n\n    case Constants.NODE_A:\n      {\n        id += \"node-a\";\n        break;\n      }\n\n    default:\n      {\n        console.error(\"Unrecognized Node: \" + forNode);\n      }\n  }\n\n  return id;\n}","map":{"version":3,"sources":["/Users/andrew/code/yb-architecture/animations/src/HelperFunctions.js"],"names":["anime","Constants","clientNodePositions","setSVGText","params","target","document","getElementById","targetId","text","textContent","addCSSClass","classList","add","removeCSSClass","remove","showElement","element","hideElement","delayedNext","animation","delay","DEFAULT_DELAY","setTimeout","next","setTextWithAnimation","textSect","onComplete","innerHTML","ml4","opacityIn","scaleIn","scaleOut","durationIn","durationOut","targets","opacity","scale","duration","complete","introduceClient","clientTextValue","clientNode","translateY","hideClient","messageFromClient","destination","messageElement","translateX","NODE_C","NODE_A","console","log","easing","begin","onBegin","changeComplete","onChangeComplete","direction","alternate","sendLogMessage","fromNode","toNode","returnAck","isAck","value","commitValue","destinationTimerAnimation","srcTimerAnimation","method","textElementId","sourceNodeTextElementId","messageContrainer","additionalTextElementID","sourceNodeAdditionalTextElementId","messageFromA","NODE_B","CLIENT_NODE","messageFromB","messageFromC","Error","anim","restart","additionalText","COMMITTED","UNCOMMITTED","style","transform","logMessageFromLeaderToFollowers","withAck","nodeATimerAnimation","nodeBTimerAnimation","nodeCTimerAnimation","nodeAAnimation","nodeBAnimation","logMessageAckFromFollowersToLeader","getFinishPromises","animations","animationPromises","forEach","currentAnimation","push","finished","warning","getSetValueText","partitionNodeC","nodeCPartition","startMyLeaseTimer","forNode","percent","myLeaseTimerId","startLeaseTimer","startLeaderLeaseTimer","leaderLeaseTimerId","timer","innerRect","calculatedWidth","width","constructTimerId","prefix","id","error"],"mappings":"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","sourcesContent":["import anime from 'animejs/lib/anime.es.js';\n\nimport {Constants} from './constants';\nimport {clientNodePositions} from './svg/MainDiagram';\n\n\n// Set text content of a SVG text element\n// params:{\n//\ttargetId:\n//\ttext:\n//\taddCSSClass:\n//\tshowElement:\n//}\nexport function setSVGText(params) {\n\tvar target = document.getElementById(params.targetId);\n\tif (params.text) {\n\t\ttarget.textContent = params.text;\n\t}\n\tif (params.addCSSClass) {\n\t\ttarget.classList.add(params.addCSSClass);\n\t}\n\tif (params.removeCSSClass) {\n\t\ttarget.classList.remove(params.removeCSSClass);\n\t}\n\tif (params.showElement) {\n\t\tshowElement(target);\n\t}\n}\n\nexport function showElement(element) {\n\telement.classList.remove('visibility-hidden');\n\telement.classList.add('visibility-visible');\n}\n\nexport function hideElement(element){\n\telement.classList.remove('visibility-visible');\n\telement.classList.add('visibility-hidden');\n}\n\nexport function delayedNext(animation, delay) {\n\tif (!delay) {\n\t\tdelay = Constants.DEFAULT_DELAY;\n\t}\n\tsetTimeout(() => animation.next(), delay);\n}\n\nexport function setTextWithAnimation(textSect, text, onComplete, delay) {\n\ttextSect.innerHTML=text;\n\n\tvar ml4 = {};\n\tml4.opacityIn = [0,1];\n\tml4.scaleIn = [0.2, 1];\n\tml4.scaleOut = 3;\n\tml4.durationIn = 2000;\n\tml4.durationOut = 2000;\n\tml4.delay = (delay?delay:500);\n\n\tanime({\n\t\ttargets: textSect,\n\t\topacity: ml4.opacityIn,\n\t\tscale: ml4.scaleIn,\n\t\tduration: ml4.durationIn,\n\t\tcomplete: onComplete,\n\t\tdelay: ml4.delay,\n\t});\n}\n///////////////////////////////////////////////////////////////\n//Animation Helpers. TODO: Maybe they should go in AnimationHelper module?\n//////////////////////////////////////////////////////////////\n\nexport function introduceClient(clientTextValue) {\n\tvar clientNode = document.getElementById(\"client-node\");\n\tshowElement(clientNode);\n\tif (clientTextValue) {\n\t\tsetSVGText({targetId: \"client-node-value\", text: clientTextValue})\n\t}\n\tvar animation = anime({\n\t\ttargets: clientNode,\n\t\ttranslateY: -84\n\t});\n\treturn animation;\n}\n\nexport function hideClient() {\n\tvar clientNode = document.getElementById(\"client-node\");\n\thideElement(clientNode);\n\thideElement(document.getElementById('client-message-circle'));\n}\n\n\nexport function messageFromClient(destination, params) {\n\tvar messageElement = document.getElementById('client-message');\n\tvar translateX = 0;\n\tvar translateY = 0;\n\n\tswitch (destination) {\n\t\tcase Constants.NODE_C: {\n\t\t\ttranslateX = 140;\n\t\t\ttranslateY = -140;\n\t\t\tbreak;\n\t\t}\n\t\tcase Constants.NODE_A: {\n\t\t\ttranslateX = -160;\n\t\t\ttranslateY = -156;\n\t\t\tbreak;\n\t\t}\n\t\tdefault: {\n\t\t\tconsole.log('messageFromClient: Unrecognized destination: ' + destination);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tvar animation = anime({\n\t\ttargets: messageElement,\n\t\ttranslateX: translateX,\n\t\ttranslateY: translateY,\n\t\teasing: 'linear',\n\t\tduration: 800,\n\t\tbegin: params.onBegin,\n\t\tcomplete: params.onComplete,\n\t\tchangeComplete: params.onChangeComplete,\n\t\tdirection: params.alternate?'alternate':'normal',\n\t});\n\treturn animation;\n}\n\nexport function sendLogMessage(fromNode, toNode, returnAck, isAck, value, commitValue, delay, destinationTimerAnimation, srcTimerAnimation) {\n\tconsole.log('FromNode: ' + fromNode + \" toNode: \" + toNode + \" returnAck: \" + returnAck + \" value: \" + value + \" commitValue: \" + commitValue);\n\tvar method = null;\n\tvar messageElement = null;\n\tvar textElementId = null;\n\tvar sourceNodeTextElementId = null;\n\tvar messageContrainer = null;\n\tvar additionalTextElementID = null;\n\tvar sourceNodeAdditionalTextElementId = null;\n\n\tswitch(fromNode) {\n\t\tcase Constants.NODE_A: {\n\t\t\tmethod = messageFromA;\n\t\t\tsourceNodeTextElementId = 'node-a-extra-text';\n\t\t\tsourceNodeAdditionalTextElementId = 'node-a-extra-text2';\n\n\t\t\tif(toNode == Constants.NODE_B) {\n\t\t\t\tmessageElement = document.getElementById('node-a-message-to-b');\n\t\t\t\ttextElementId = 'node-b-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-b-extra-text2';\n\t\t\t} else if (toNode == Constants.NODE_C) {\n\t\t\t\tmessageElement = document.getElementById('node-a-message-to-c');\n\t\t\t\ttextElementId = 'node-c-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-c-extra-text2';\n\t\t\t} else if (toNode == Constants.CLIENT_NODE) {\n\t\t\t\tmessageElement = document.getElementById('node-a-message-to-client');\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tcase Constants.NODE_B: {\n\t\t\tmethod = messageFromB;\n\t\t\tsourceNodeTextElementId = 'node-b-extra-text';\n\t\t\tsourceNodeAdditionalTextElementId = 'node-b-extra-text2';\n\n\t\t\tif(toNode == Constants.NODE_A) {\n\t\t\t\tmessageElement = document.getElementById('node-b-message-to-a');\n\t\t\t\ttextElementId = 'node-a-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-a-extra-text2';\n\t\t\t} else if (toNode == Constants.NODE_C) {\n\t\t\t\tmessageElement = document.getElementById('node-b-message-to-c');\n\t\t\t\ttextElementId = 'node-c-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-c-extra-text2';\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tcase Constants.NODE_C: {\n\t\t\tmethod = messageFromC;\n\t\t\tsourceNodeTextElementId = 'node-c-extra-text';\n\t\t\tsourceNodeAdditionalTextElementId = 'node-c-extra-text2';\n\n\t\t\tif (toNode == Constants.NODE_A) {\n\t\t\t\tmessageElement = document.getElementById('node-c-message-to-a');\n\t\t\t\ttextElementId = 'node-a-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-a-extra-text2';\n\t\t\t} else if (toNode == Constants.NODE_B) {\n\t\t\t\tmessageElement = document.getElementById('node-c-message-to-b');\n\t\t\t\ttextElementId = 'node-b-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-b-extra-text2';\n\t\t\t} else if (toNode == Constants.CLIENT_NODE) {\n\t\t\t\tmessageElement = document.getElementById('node-c-message-to-client');\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tcase Constants.CLIENT_NODE: {\n\t\t\tmethod = messageFromClient;\n\t\t\tmessageElement = document.getElementById('client-message-circle');\n\t\t\tmessageContrainer = document.getElementById('client-message');\n\n\t\t\tif (toNode == Constants.NODE_A) {\n\t\t\t\ttextElementId = 'node-a-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-a-extra-text2';\n\t\t\t} else if (toNode == Constants.NODE_B) {\n\t\t\t\ttextElementId = 'node-b-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-b-extra-text2';\n\t\t\t} else if (toNode == Constants.NODE_C) {\n\t\t\t\ttextElementId = 'node-c-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-c-extra-text2';\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tdefault: {\n\t\t\tthrow new Error('Unrecognized fromNode: ' + fromNode);\n\t\t}\n\t}\n\n\tvar animation = method(toNode,{\n\t\t\tdelay: delay,\n\t\t\tdestinationTimerAnimation: destinationTimerAnimation,\n\t\t\tonBegin: anim => {\n\t\t\t\tshowElement(messageElement);\n\t\t\t\tif (isAck) {\n\t\t\t\t\tmessageElement.classList.remove('log-message');\n\t\t\t\t\tmessageElement.classList.add('log-message-ack');\n\t\t\t\t} else {\n\t\t\t\t\tmessageElement.classList.add('log-message');\n\t\t\t\t\tmessageElement.classList.remove('log-message-ack');\n\t\t\t\t}\n\t\t\t},\n\t\t\tonChangeComplete: anim => {\n\t\t\t\tconsole.log('In onChangeComplete. messageElement: ' + messageElement);\n\t\t\t\tif (destinationTimerAnimation) {\n\t\t\t\t\tconsole.log('Will restart timer animation');\n\t\t\t\t\tdestinationTimerAnimation.restart();\n\t\t\t\t}\n\n\t\t\t\tif (returnAck) {\n\t\t\t\t\tmessageElement.classList.remove('log-message');\n\t\t\t\t\tmessageElement.classList.add('log-message-ack');\n\t\t\t\t}\n\n\t\t\t\tvar additionalText = null;\n\t\t\t\tif (value && textElementId){\n\t\t\t\t\tvar addCSSClass = \"\";\n\t\t\t\t\tvar removeCSSClass = \"\";\n\n\t\t\t\t\tif (commitValue) {\n\t\t\t\t\t\taddCSSClass = \"set-text-committed\";\n\t\t\t\t\t\tremoveCSSClass = \"set-text-uncommitted\";\n\t\t\t\t\t\tadditionalText = Constants.COMMITTED;\n\t\t\t\t\t} else {\n\t\t\t\t\t\taddCSSClass = \"set-text-uncommitted\";\n\t\t\t\t\t\tremoveCSSClass = \"set-text-committed\";\n\t\t\t\t\t\tadditionalText = Constants.UNCOMMITTED;\n\t\t\t\t\t}\n\t\t\t\t\t// setSVGText({\n\t\t\t\t\t// \ttargetId: textElementId,\n\t\t\t\t\t// \ttext: value,\n\t\t\t\t\t// \taddCSSClass: addCSSClass,\n\t\t\t\t\t// \tremoveCSSClass:removeCSSClass,\n\t\t\t\t\t// \tshowElement: !commitValue,\n\t\t\t\t\t// });\n\n\t\t\t\t\tconsole.log('additionalText: ' + additionalText + 'additionalTextElementID: ' + additionalTextElementID);\n\t\t\t\t\tif (additionalText != null && additionalTextElementID) {\n\t\t\t\t\t\tconsole.log('will update additionalText');\n\t\t\t\t\t\tsetSVGText({\n\t\t\t\t\t\t\ttargetId: additionalTextElementID,\n\t\t\t\t\t\t\ttext: additionalText,\n\t\t\t\t\t\t\taddCSSClass: addCSSClass,\n\t\t\t\t\t\t\tremoveCSSClass:removeCSSClass,\n\t\t\t\t\t\t\tshowElement: !commitValue,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t},\n\t\t\tonComplete: anim => {\n\t\t\t\tif (returnAck) {\n\t\t\t\t\tmessageElement.classList.remove('log-message-ack');\n\t\t\t\t\t// we got the ack back so uncommitted text should be shown as committed now\n\t\t\t\t\tif (value && sourceNodeTextElementId) {\n\t\t\t\t\t\tsetSVGText({targetId: sourceNodeTextElementId, addCSSClass: \"set-text-committed\"});\n\t\t\t\t\t}\n\t\t\t\t\tif (value && sourceNodeAdditionalTextElementId){\n\t\t\t\t\t\tsetSVGText({targetId: sourceNodeAdditionalTextElementId, text: Constants.COMMITTED, addCSSClass: \"set-text-committed\"});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (srcTimerAnimation) {\n\t\t\t\t\tsrcTimerAnimation.restart();\n\t\t\t\t}\n\t\t\t\tmessageElement.style.transform = 'none';\n\t\t\t\tif (messageContrainer) {\n\t\t\t\t\tmessageContrainer.style.transform = 'none';\n\t\t\t\t}\n\t\t\t},\n\t\t\talternate: returnAck,\n\t\t});\n\treturn animation;\n}\n\nexport function logMessageFromLeaderToFollowers(withAck, value, commitValue, delay, nodeATimerAnimation, nodeBTimerAnimation, nodeCTimerAnimation) {\n\tvar nodeAAnimation = sendLogMessage(Constants.NODE_C,Constants.NODE_A, withAck, false, value, commitValue, delay,nodeATimerAnimation, nodeCTimerAnimation);\n\tvar nodeBAnimation = sendLogMessage(Constants.NODE_C,Constants.NODE_B, withAck, false, value, commitValue, delay, nodeBTimerAnimation, nodeCTimerAnimation);\n\n\treturn [nodeAAnimation,nodeBAnimation];\n}\nexport function logMessageAckFromFollowersToLeader(value, commitValue, delay, nodeATimerAnimation, nodeBTimerAnimation, nodeCTimerAnimation) {\n\tvar nodeAAnimation = sendLogMessage(Constants.NODE_A,Constants.NODE_C, false, true, value, commitValue, delay,nodeATimerAnimation, nodeCTimerAnimation);\n\tvar nodeBAnimation = sendLogMessage(Constants.NODE_B,Constants.NODE_C, false, true, value, commitValue, delay, nodeBTimerAnimation, nodeCTimerAnimation);\n\n\treturn [nodeAAnimation,nodeBAnimation];\n}\nexport function getFinishPromises(animations) {\n\tvar animationPromises = [];\n\tanimations.forEach(currentAnimation => {\n\t\tanimationPromises.push(currentAnimation.finished);\n\t});\n\treturn animationPromises;\n}\n\nexport function messageFromC(destination, params) {\n\tvar translateX = 0;\n\tvar translateY = 0;\n\tvar targets = \"\";\n\tif (destination == Constants.NODE_B) {\n\t\ttranslateX = -140;\n\t\ttranslateY = -276;\n\t\ttargets = '#node-c-message-to-b';\n\t} else if (destination == Constants.NODE_A) {\n\t\ttargets = '#node-c-message-to-a';\n\t\ttranslateX = -275;\n\t} else if (destination == Constants.CLIENT_NODE) {\n\t\ttargets = '#node-c-message-to-client';\n\t\ttranslateX = -130;\n\t\ttranslateY = 135;\n\t}\n\n\tvar animation = anime({\n\t\ttargets: targets,\n\t\ttranslateX: translateX,\n\t\ttranslateY: translateY,\n\t\teasing: 'linear',\n\t\tduration: 1000,\n\t\tdirection: params.alternate?'alternate':'normal',\n\t\tbegin: params.onBegin,\n\t\tchangeComplete: params.onChangeComplete,\n\t\tcomplete: params.onComplete,\n\t\tdelay: params.delay?params.delay:0\n\t});\n\treturn animation;\n}\n\nexport function messageFromA(destination, params) {\n\tvar translateX = 0;\n\tvar translateY = 0;\n\tvar targets = \"\";\n\tif (destination == Constants.NODE_B) {\n\t\ttranslateX = 160;\n\t\ttranslateY = -290;\n\t\ttargets = '#node-a-message-to-b';\n\t} else if (destination === Constants.NODE_C) {\n\t\ttranslateX = 275;\n\t\ttargets = '#node-a-message-to-c';\n\t}\n\telse if (destination == Constants.CLIENT_NODE) {\n\t\ttranslateX = 150;\n\t\ttranslateY = 148;\n\t\ttargets = '#node-a-message-to-client';\n\t}\n\telse {\n\t\tconsole.warning('Unsupported destination: ' + destination);\n\t\treturn;\n\t}\n\n\n\tvar animation = anime({\n\t\ttargets: targets,\n\t\ttranslateX: translateX,\n\t\ttranslateY: translateY,\n\t\teasing: 'linear',\n\t\tduration: 1000,\n\t\tdirection: (params.alternate?'alternate':'normal'),\n\t\tbegin: params.onBegin,\n\t\tchangeComplete: params.onChangeComplete,\n\t\tcomplete: params.onComplete,\n\t\tdelay: params.delay?params.delay:0\n\t});\n\treturn animation;\n}\n\nexport function messageFromB(destination, params) {\n\tvar translateX = 0;\n\tvar translateY = 0;\n\tvar targets = \"\";\n\tif (destination == Constants.NODE_A) {\n\t\ttranslateX = -160;\n\t\ttranslateY = 290;\n\t\ttargets = '#node-b-message-to-a';\n\t} else if (destination === Constants.NODE_C) {\n\t\ttranslateX = 140;\n\t\ttranslateY = 276;\n\t\ttargets = '#node-b-message-to-c';\n\t}\n\telse {\n\t\tconsole.warning('Unsupported destination: ' + destination);\n\t\treturn;\n\t}\n\n\n\tvar animation = anime({\n\t\ttargets: targets,\n\t\ttranslateX: translateX,\n\t\ttranslateY: translateY,\n\t\teasing: 'linear',\n\t\tduration: 1000,\n\t\tdirection: (params.alternate?'alternate':'normal'),\n\t\tbegin: params.onBegin,\n\t\tchangeComplete: params.onChangeComplete,\n\t\tcomplete: params.onComplete,\n\t\tdelay: params.delay?params.delay:0\n\t});\n\treturn animation;\n}\n\nexport function getSetValueText(value) {\n\treturn \"Value: \" + value;\n}\n\nexport function partitionNodeC() {\n\tvar nodeCPartition = document.getElementById('node-c-partition-wrap');\n\tshowElement(nodeCPartition);\n}\n\nexport function startMyLeaseTimer(forNode, duration, percent){\n\tvar targetId = myLeaseTimerId(forNode);\n\treturn startLeaseTimer(targetId, duration, percent);\n}\nexport function startLeaderLeaseTimer(forNode, duration, percent){\n\tvar targetId = leaderLeaseTimerId(forNode);\n\treturn startLeaseTimer(targetId, duration, percent);\n}\n\n/**\n * Function that returns animation for a lease timer. This animation will run for\n * a specific `duration` until it reaches the specified `percent` limit.\n * @param {string} targetId String of html element id for this animation to run on\n * @param {number} duration Milliseconds until animation finishes\n * @param {number} percent  Target percentage to be remaining after animation is over, default is 0.\n */\nexport function startLeaseTimer(targetId, duration, percent = 0){\n\tvar timer = document.getElementById(targetId);\n\tshowElement(timer);\n\tvar innerRect = document.getElementById(targetId + '-inner');\n\tconst calculatedWidth = `${percent / 100.0 * 80}px`;\n\tvar animation = anime({\n\t\ttargets: innerRect,\n\t\twidth: calculatedWidth,\n\t\teasing: 'easeOutCubic',\n\t\tduration: duration,\n\t});\n\treturn animation;\n}\n\nexport function myLeaseTimerId(forNode) {\n\treturn constructTimerId(\"mlease-rect-\", forNode);\n}\n\nexport function leaderLeaseTimerId(forNode) {\n\treturn constructTimerId(\"llease-rect\", forNode);\n}\n\nfunction constructTimerId(prefix, forNode) {\n\tvar id = prefix;\n\tswitch(forNode) {\n\t\tcase Constants.NODE_C: {\n\t\t\tid += \"node-c\";\n\t\t\tbreak;\n\t\t}\n\t\tcase Constants.NODE_B: {\n\t\t\tid += \"node-b\";\n\t\t\tbreak;\n\t\t}\n\t\tcase Constants.NODE_A: {\n\t\t\tid += \"node-a\";\n\t\t\tbreak;\n\t\t}\n\t\tdefault: {\n\t\t\tconsole.error(\"Unrecognized Node: \" + forNode);\n\t\t}\n\t}\n\treturn id;\n}\n"]},"metadata":{},"sourceType":"module"}