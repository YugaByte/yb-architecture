{"ast":null,"code":"import anime from 'animejs/lib/anime.es.js';\nimport { Constants } from './constants';\nimport { clientNodePositions } from './svg/MainDiagram'; // Set text content of a SVG text element\n// params:{\n//\ttargetId:\n//\ttext:\n//\taddCSSClass:\n//\tshowElement:\n//}\n\nexport function setSVGText(params) {\n  var target = document.getElementById(params.targetId);\n\n  if (params.text) {\n    target.textContent = params.text;\n  }\n\n  if (params.addCSSClass) {\n    target.classList.add(params.addCSSClass);\n  }\n\n  if (params.removeCSSClass) {\n    target.classList.remove(params.removeCSSClass);\n  }\n\n  if (params.showElement) {\n    showElement(target);\n  }\n}\nexport function showElement(element) {\n  element.classList.remove('visibility-hidden');\n  element.classList.add('visibility-visible');\n}\nexport function hideElement(element) {\n  element.classList.remove('visibility-visible');\n  element.classList.add('visibility-hidden');\n}\nexport function delayedNext(animation, delay) {\n  if (!delay) {\n    delay = Constants.DEFAULT_DELAY;\n  }\n\n  setTimeout(function () {\n    return animation.next();\n  }, delay);\n}\nexport function setTextWithAnimation(textSect, text, onComplete, delay) {\n  textSect.innerHTML = text;\n  var ml4 = {};\n  ml4.opacityIn = [0, 1];\n  ml4.scaleIn = [0.2, 1];\n  ml4.scaleOut = 3;\n  ml4.durationIn = 2000;\n  ml4.durationOut = 2000;\n  ml4.delay = delay ? delay : 500;\n  anime({\n    targets: textSect,\n    opacity: ml4.opacityIn,\n    scale: ml4.scaleIn,\n    duration: ml4.durationIn,\n    complete: onComplete,\n    delay: ml4.delay\n  });\n} ///////////////////////////////////////////////////////////////\n//Animation Helpers. TODO: Maybe they should go in AnimationHelper module?\n//////////////////////////////////////////////////////////////\n\nexport function introduceClient(clientTextValue) {\n  var clientNode = document.getElementById(\"client-node\");\n\n  if (clientTextValue) {\n    setSVGText({\n      targetId: \"client-node-value\",\n      text: clientTextValue\n    });\n  }\n\n  var animation = anime({\n    targets: clientNode,\n    translateY: -84\n  });\n  return animation;\n}\nexport function messageFromClient(destination, params) {\n  var messageElement = document.getElementById('client-message');\n  var translateX = 0;\n  var translateY = 0;\n\n  switch (destination) {\n    case Constants.NODE_C:\n      {\n        translateX = 140;\n        translateY = -140;\n        break;\n      }\n\n    case Constants.NODE_A:\n      {\n        translateX = -160;\n        translateY = -156;\n        break;\n      }\n\n    default:\n      {\n        console.log('messageFromClient: Unrecognized destination: ' + destination);\n        return;\n      }\n  }\n\n  var animation = anime({\n    targets: messageElement,\n    translateX: translateX,\n    translateY: translateY,\n    easing: 'linear',\n    duration: 800,\n    begin: params.onBegin,\n    complete: params.onComplete,\n    changeComplete: params.onChangeComplete,\n    direction: params.alternate ? 'alternate' : 'normal'\n  });\n  return animation;\n}\nexport function sendLogMessage(fromNode, toNode, withAck, value, commitValue, delay, destinationTimerAnimation, srcTimerAnimation) {\n  console.log('FromNode: ' + fromNode + \" toNode: \" + toNode + \" withAck: \" + withAck + \" value: \" + value + \" commitValue: \" + commitValue);\n  var method = null;\n  var messageElement = null;\n  var textElementId = null;\n  var sourceNodeTextElementId = null;\n  var messageContrainer = null;\n  var additionalTextElementID = null;\n  var sourceNodeAdditionalTextElementId = null;\n\n  switch (fromNode) {\n    case Constants.NODE_A:\n      {\n        method = messageFromA;\n        sourceNodeTextElementId = 'node-a-extra-text';\n        sourceNodeAdditionalTextElementId = 'node-a-extra-text2';\n\n        if (toNode == Constants.NODE_B) {\n          messageElement = document.getElementById('node-a-message-to-b');\n          textElementId = 'node-b-extra-text';\n          additionalTextElementID = 'node-b-extra-text2';\n        } else if (toNode == Constants.CLIENT_NODE) {\n          messageElement = document.getElementById('node-a-message-to-client');\n        }\n\n        break;\n      }\n\n    case Constants.NODE_C:\n      {\n        method = messageFromC;\n        sourceNodeTextElementId = 'node-c-extra-text';\n        sourceNodeAdditionalTextElementId = 'node-c-extra-text2';\n\n        if (toNode == Constants.NODE_A) {\n          messageElement = document.getElementById('node-c-message-to-a');\n          textElementId = 'node-a-extra-text';\n          additionalTextElementID = 'node-a-extra-text2';\n        } else if (toNode == Constants.NODE_B) {\n          messageElement = document.getElementById('node-c-message-to-b');\n          textElementId = 'node-b-extra-text';\n          additionalTextElementID = 'node-b-extra-text2';\n        } else if (toNode == Constants.CLIENT_NODE) {\n          messageElement = document.getElementById('node-c-message-to-client');\n        }\n\n        break;\n      }\n\n    case Constants.CLIENT_NODE:\n      {\n        method = messageFromClient;\n        messageElement = document.getElementById('client-message-circle');\n        messageContrainer = document.getElementById('client-message');\n\n        if (toNode == Constants.NODE_A) {\n          textElementId = 'node-a-extra-text';\n          additionalTextElementID = 'node-a-extra-text2';\n        } else if (toNode == Constants.NODE_B) {\n          textElementId = 'node-b-extra-text';\n          additionalTextElementID = 'node-b-extra-text2';\n        } else if (toNode == Constants.NODE_C) {\n          textElementId = 'node-c-extra-text';\n          additionalTextElementID = 'node-c-extra-text2';\n        }\n\n        break;\n      }\n\n    default:\n      {\n        throw new Error('Unrecognized fromNode: ' + fromNode);\n      }\n  }\n\n  var animation = method(toNode, {\n    delay: delay,\n    destinationTimerAnimation: destinationTimerAnimation,\n    onBegin: function onBegin(anim) {\n      showElement(messageElement);\n      messageElement.classList.add('log-message');\n    },\n    onChangeComplete: function onChangeComplete(anim) {\n      console.log('In onChangeComplete. messageElement: ' + messageElement);\n\n      if (destinationTimerAnimation) {\n        console.log('Will restart timer animation');\n        destinationTimerAnimation.restart();\n      }\n\n      if (withAck) {\n        messageElement.classList.remove('log-message');\n        messageElement.classList.add('log-message-ack');\n      }\n\n      var additionalText = null;\n\n      if (value && textElementId) {\n        var addCSSClass = \"\";\n        var removeCSSClass = \"\";\n\n        if (commitValue) {\n          addCSSClass = \"set-text-committed\";\n          removeCSSClass = \"set-text-uncommitted\";\n          additionalText = Constants.COMMITED;\n        } else {\n          addCSSClass = \"set-text-uncommitted\";\n          removeCSSClass = \"set-text-committed\";\n          additionalText = Constants.UNCOMMITED;\n        }\n\n        setSVGText({\n          targetId: textElementId,\n          text: value,\n          addCSSClass: addCSSClass,\n          removeCSSClass: removeCSSClass,\n          showElement: true\n        });\n        console.log('additionalText: ' + additionalText + 'additionalTextElementID: ' + additionalTextElementID);\n\n        if (additionalText != null && additionalTextElementID) {\n          console.log('will update additionalText');\n          setSVGText({\n            targetId: additionalTextElementID,\n            text: additionalText,\n            addCSSClass: addCSSClass,\n            removeCSSClass: removeCSSClass,\n            showElement: true\n          });\n        }\n      }\n    },\n    onComplete: function onComplete(anim) {\n      if (withAck) {\n        messageElement.classList.remove('log-message-ack'); // we got the ack back so uncommited text should be shown as commited now\n\n        if (value && sourceNodeTextElementId) {\n          setSVGText({\n            targetId: sourceNodeTextElementId,\n            addCSSClass: \"set-text-committed\"\n          });\n        }\n\n        if (value && sourceNodeAdditionalTextElementId) {\n          setSVGText({\n            targetId: sourceNodeAdditionalTextElementId,\n            text: Constants.COMMITED,\n            addCSSClass: \"set-text-committed\"\n          });\n        }\n      }\n\n      if (srcTimerAnimation) {\n        srcTimerAnimation.restart();\n      }\n\n      messageElement.style.transform = 'none';\n\n      if (messageContrainer) {\n        messageContrainer.style.transform = 'none';\n      }\n    },\n    alternate: withAck\n  });\n  return animation;\n}\nexport function logMessageFromLeaderToFollowers(withAck, value, commitValue, delay, nodeATimerAnimation, nodeBTimerAnimation, nodeCTimerAnimation) {\n  var nodeAAnimation = sendLogMessage(Constants.NODE_C, Constants.NODE_A, withAck, value, commitValue, delay, nodeATimerAnimation, nodeCTimerAnimation); // message to Node B\n  // var messageToB = document.getElementById('node-c-message-to-b');\n\n  var nodeBAnimation = sendLogMessage(Constants.NODE_C, Constants.NODE_B, withAck, value, commitValue, delay, nodeBTimerAnimation, nodeCTimerAnimation);\n  return [nodeAAnimation, nodeBAnimation];\n}\nexport function getFinishPromises(animations) {\n  var animationPromises = [];\n  animations.forEach(function (currentAnimation) {\n    animationPromises.push(currentAnimation.finished);\n  });\n  return animationPromises;\n}\nexport function messageFromC(destination, params) {\n  var translateX = 0;\n  var translateY = 0;\n  var targets = \"\";\n\n  if (destination == Constants.NODE_B) {\n    translateX = -132;\n    translateY = -290;\n    targets = '#node-c-message-to-b';\n  } else if (destination == Constants.NODE_A) {\n    targets = '#node-c-message-to-a';\n    translateX = -270;\n  } else if (destination == Constants.CLIENT_NODE) {\n    targets = '#node-c-message-to-client';\n    translateX = -100;\n    translateY = 130;\n  }\n\n  var animation = anime({\n    targets: targets,\n    translateX: translateX,\n    translateY: translateY,\n    easing: 'linear',\n    duration: 1000,\n    direction: params.alternate ? 'alternate' : 'normal',\n    begin: params.onBegin,\n    changeComplete: params.onChangeComplete,\n    complete: params.onComplete,\n    delay: params.delay ? params.delay : 0\n  });\n  return animation;\n}\nexport function messageFromA(destination, params) {\n  var translateX = 0;\n  var translateY = 0;\n  var targets = \"\";\n\n  if (destination == Constants.NODE_B) {\n    translateX = 160;\n    translateY = -290;\n    targets = '#node-a-message-to-b';\n  } else if (destination == Constants.CLIENT_NODE) {\n    translateX = 150;\n    translateY = 148;\n    targets = '#node-a-message-to-client';\n  } else {\n    console.warning('Unsupported destination: ' + destination);\n    return;\n  }\n\n  var animation = anime({\n    targets: targets,\n    translateX: translateX,\n    translateY: translateY,\n    easing: 'linear',\n    duration: 1000,\n    direction: params.alternate ? 'alternate' : 'normal',\n    begin: params.onBegin,\n    changeComplete: params.onChangeComplete,\n    complete: params.onComplete,\n    delay: params.delay ? params.delay : 0\n  });\n  return animation;\n}\nexport function getSetValueText(value) {\n  return \"Value: \" + value;\n}\nexport function partitionNodeC() {\n  var nodeCPartition = document.getElementById('node-c-partition-wrap');\n  showElement(nodeCPartition);\n}\nexport function startMyLeaseTimer(forNode, duration) {\n  var targetId = myLeaseTimerId(forNode);\n  return startLeaseTimer(targetId, forNode, duration);\n}\nexport function startLeaderLeaseTimer(forNode, duration) {\n  var targetId = leaderLeaseTimerId(forNode);\n  return startLeaseTimer(targetId, forNode, duration);\n}\nexport function startLeaseTimer(targetId, forNode, duration) {\n  var timer = document.getElementById(targetId);\n  showElement(timer);\n  var innerRect = document.getElementById(targetId + '-inner');\n  var animation = anime({\n    targets: innerRect,\n    width: '0',\n    easing: 'easeOutCubic',\n    duration: duration\n  });\n  return animation;\n}\nexport function myLeaseTimerId(forNode) {\n  return constructTimerId(\"mlease-rect-\", forNode);\n}\nexport function leaderLeaseTimerId(forNode) {\n  return constructTimerId(\"llease-rect\", forNode);\n}\n\nfunction constructTimerId(prefix, forNode) {\n  var id = prefix;\n\n  switch (forNode) {\n    case Constants.NODE_C:\n      {\n        id += \"node-c\";\n        break;\n      }\n\n    case Constants.NODE_B:\n      {\n        id += \"node-b\";\n        break;\n      }\n\n    case Constants.NODE_A:\n      {\n        id += \"node-a\";\n        break;\n      }\n\n    default:\n      {\n        console.error(\"Unrecognized Node: \" + forNode);\n      }\n  }\n\n  return id;\n}","map":{"version":3,"sources":["/Users/andrew/code/yb-architecture/animations/src/HelperFunctions.js"],"names":["anime","Constants","clientNodePositions","setSVGText","params","target","document","getElementById","targetId","text","textContent","addCSSClass","classList","add","removeCSSClass","remove","showElement","element","hideElement","delayedNext","animation","delay","DEFAULT_DELAY","setTimeout","next","setTextWithAnimation","textSect","onComplete","innerHTML","ml4","opacityIn","scaleIn","scaleOut","durationIn","durationOut","targets","opacity","scale","duration","complete","introduceClient","clientTextValue","clientNode","translateY","messageFromClient","destination","messageElement","translateX","NODE_C","NODE_A","console","log","easing","begin","onBegin","changeComplete","onChangeComplete","direction","alternate","sendLogMessage","fromNode","toNode","withAck","value","commitValue","destinationTimerAnimation","srcTimerAnimation","method","textElementId","sourceNodeTextElementId","messageContrainer","additionalTextElementID","sourceNodeAdditionalTextElementId","messageFromA","NODE_B","CLIENT_NODE","messageFromC","Error","anim","restart","additionalText","COMMITED","UNCOMMITED","style","transform","logMessageFromLeaderToFollowers","nodeATimerAnimation","nodeBTimerAnimation","nodeCTimerAnimation","nodeAAnimation","nodeBAnimation","getFinishPromises","animations","animationPromises","forEach","currentAnimation","push","finished","warning","getSetValueText","partitionNodeC","nodeCPartition","startMyLeaseTimer","forNode","myLeaseTimerId","startLeaseTimer","startLeaderLeaseTimer","leaderLeaseTimerId","timer","innerRect","width","constructTimerId","prefix","id","error"],"mappings":"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","sourcesContent":["import anime from 'animejs/lib/anime.es.js';\n\nimport {Constants} from './constants';\nimport {clientNodePositions} from './svg/MainDiagram';\n\n\n// Set text content of a SVG text element\n// params:{\n//\ttargetId:\n//\ttext:\n//\taddCSSClass:\n//\tshowElement:\n//}\nexport function setSVGText(params) {\n\tvar target = document.getElementById(params.targetId);\n\tif (params.text) {\n\t\ttarget.textContent = params.text;\n\t}\n\tif (params.addCSSClass) {\n\t\ttarget.classList.add(params.addCSSClass);\n\t}\n\tif (params.removeCSSClass) {\n\t\ttarget.classList.remove(params.removeCSSClass);\n\t}\n\tif (params.showElement) {\n\t\tshowElement(target);\n\t}\n}\n\nexport function showElement(element) {\n\telement.classList.remove('visibility-hidden');\n\telement.classList.add('visibility-visible');\n}\n\nexport function hideElement(element){\n\telement.classList.remove('visibility-visible');\n\telement.classList.add('visibility-hidden');\n}\n\nexport function delayedNext(animation, delay) {\n\tif (!delay) {\n\t\tdelay = Constants.DEFAULT_DELAY;\n\t}\n\tsetTimeout(() => animation.next(), delay);\n}\n\nexport function setTextWithAnimation(textSect, text, onComplete, delay) {\n\ttextSect.innerHTML=text;\n\n\tvar ml4 = {};\n\tml4.opacityIn = [0,1];\n\tml4.scaleIn = [0.2, 1];\n\tml4.scaleOut = 3;\n\tml4.durationIn = 2000;\n\tml4.durationOut = 2000;\n\tml4.delay = (delay?delay:500);\n\n\tanime({\n\t\ttargets: textSect,\n\t\topacity: ml4.opacityIn,\n\t\tscale: ml4.scaleIn,\n\t\tduration: ml4.durationIn,\n\t\tcomplete: onComplete,\n\t\tdelay: ml4.delay,\n\t});\n}\n///////////////////////////////////////////////////////////////\n//Animation Helpers. TODO: Maybe they should go in AnimationHelper module?\n//////////////////////////////////////////////////////////////\n\nexport function introduceClient(clientTextValue) {\n\tvar clientNode = document.getElementById(\"client-node\");\n\tif (clientTextValue) {\n\t\tsetSVGText({targetId: \"client-node-value\", text: clientTextValue})\n\t}\n\tvar animation = anime({\n\t\ttargets: clientNode,\n\t\ttranslateY: -84\n\t});\n\treturn animation;\n}\n\n\nexport function messageFromClient(destination, params) {\n\tvar messageElement = document.getElementById('client-message');\n\tvar translateX = 0;\n\tvar translateY = 0;\n\n\tswitch (destination) {\n\t\tcase Constants.NODE_C: {\n\t\t\ttranslateX = 140;\n\t\t\ttranslateY = -140;\n\t\t\tbreak;\n\t\t}\n\t\tcase Constants.NODE_A: {\n\t\t\ttranslateX = -160;\n\t\t\ttranslateY = -156;\n\t\t\tbreak;\n\t\t}\n\t\tdefault: {\n\t\t\tconsole.log('messageFromClient: Unrecognized destination: ' + destination);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tvar animation = anime({\n\t\ttargets: messageElement,\n\t\ttranslateX: translateX,\n\t\ttranslateY: translateY,\n\t\teasing: 'linear',\n\t\tduration: 800,\n\t\tbegin: params.onBegin,\n\t\tcomplete: params.onComplete,\n\t\tchangeComplete: params.onChangeComplete,\n\t\tdirection: params.alternate?'alternate':'normal',\n\t});\n\treturn animation;\n}\n\nexport function sendLogMessage(fromNode, toNode, withAck, value, commitValue, delay, destinationTimerAnimation, srcTimerAnimation) {\n\tconsole.log('FromNode: ' + fromNode + \" toNode: \" + toNode + \" withAck: \" + withAck + \" value: \" + value + \" commitValue: \" + commitValue);\n\tvar method = null;\n\tvar messageElement = null;\n\tvar textElementId = null;\n\tvar sourceNodeTextElementId = null;\n\tvar messageContrainer = null;\n\tvar additionalTextElementID = null;\n\tvar sourceNodeAdditionalTextElementId = null;\n\n\tswitch(fromNode) {\n\t\tcase Constants.NODE_A: {\n\t\t\tmethod = messageFromA;\n\t\t\tsourceNodeTextElementId = 'node-a-extra-text';\n\t\t\tsourceNodeAdditionalTextElementId = 'node-a-extra-text2';\n\n\t\t\tif(toNode == Constants.NODE_B) {\n\t\t\t\tmessageElement = document.getElementById('node-a-message-to-b');\n\t\t\t\ttextElementId = 'node-b-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-b-extra-text2';\n\t\t\t} else if (toNode == Constants.CLIENT_NODE) {\n\t\t\t\tmessageElement = document.getElementById('node-a-message-to-client');\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tcase Constants.NODE_C: {\n\t\t\tmethod = messageFromC;\n\t\t\tsourceNodeTextElementId = 'node-c-extra-text';\n\t\t\tsourceNodeAdditionalTextElementId = 'node-c-extra-text2';\n\n\t\t\tif (toNode == Constants.NODE_A) {\n\t\t\t\tmessageElement = document.getElementById('node-c-message-to-a');\n\t\t\t\ttextElementId = 'node-a-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-a-extra-text2';\n\t\t\t} else if (toNode == Constants.NODE_B) {\n\t\t\t\tmessageElement = document.getElementById('node-c-message-to-b');\n\t\t\t\ttextElementId = 'node-b-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-b-extra-text2';\n\t\t\t} else if (toNode == Constants.CLIENT_NODE) {\n\t\t\t\tmessageElement = document.getElementById('node-c-message-to-client');\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tcase Constants.CLIENT_NODE: {\n\t\t\tmethod = messageFromClient;\n\t\t\tmessageElement = document.getElementById('client-message-circle');\n\t\t\tmessageContrainer = document.getElementById('client-message');\n\n\t\t\tif (toNode == Constants.NODE_A) {\n\t\t\t\ttextElementId = 'node-a-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-a-extra-text2';\n\t\t\t} else if (toNode == Constants.NODE_B) {\n\t\t\t\ttextElementId = 'node-b-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-b-extra-text2';\n\t\t\t} else if (toNode == Constants.NODE_C) {\n\t\t\t\ttextElementId = 'node-c-extra-text';\n\t\t\t\tadditionalTextElementID = 'node-c-extra-text2';\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tdefault: {\n\t\t\tthrow new Error('Unrecognized fromNode: ' + fromNode);\n\t\t}\n\t}\n\n\tvar animation = method(toNode,{\n\t\t\tdelay: delay,\n\t\t\tdestinationTimerAnimation: destinationTimerAnimation,\n\t\t\tonBegin: anim => {\n\t\t\t\tshowElement(messageElement);\n\t\t\t\tmessageElement.classList.add('log-message')\n\t\t\t},\n\t\t\tonChangeComplete: anim => {\n\t\t\t\tconsole.log('In onChangeComplete. messageElement: ' + messageElement);\n\t\t\t\tif (destinationTimerAnimation) {\n\t\t\t\t\tconsole.log('Will restart timer animation');\n\t\t\t\t\tdestinationTimerAnimation.restart();\n\t\t\t\t}\n\n\t\t\t\tif (withAck) {\n\t\t\t\t\tmessageElement.classList.remove('log-message');\n\t\t\t\t\tmessageElement.classList.add('log-message-ack');\n\t\t\t\t}\n\n\t\t\t\tvar additionalText = null;\n\t\t\t\tif (value && textElementId){\n\t\t\t\t\tvar addCSSClass = \"\";\n\t\t\t\t\tvar removeCSSClass = \"\";\n\t\t\t\t\tif (commitValue) {\n\t\t\t\t\t\taddCSSClass = \"set-text-committed\";\n\t\t\t\t\t\tremoveCSSClass = \"set-text-uncommitted\";\n\t\t\t\t\t\tadditionalText = Constants.COMMITED;\n\t\t\t\t\t} else {\n\t\t\t\t\t\taddCSSClass = \"set-text-uncommitted\";\n\t\t\t\t\t\tremoveCSSClass = \"set-text-committed\";\n\t\t\t\t\t\tadditionalText = Constants.UNCOMMITED;\n\t\t\t\t\t}\n\n\t\t\t\t\tsetSVGText({\n\t\t\t\t\t\ttargetId: textElementId,\n\t\t\t\t\t\ttext: value,\n\t\t\t\t\t\taddCSSClass: addCSSClass,\n\t\t\t\t\t\tremoveCSSClass:removeCSSClass,\n\t\t\t\t\t\tshowElement: true,\n\t\t\t\t\t});\n\n\t\t\t\t\tconsole.log('additionalText: ' + additionalText + 'additionalTextElementID: ' + additionalTextElementID);\n\t\t\t\t\tif (additionalText != null && additionalTextElementID){\n\t\t\t\t\t\tconsole.log('will update additionalText');\n\t\t\t\t\t\tsetSVGText({\n\t\t\t\t\t\t\ttargetId: additionalTextElementID,\n\t\t\t\t\t\t\ttext: additionalText,\n\t\t\t\t\t\t\taddCSSClass: addCSSClass,\n\t\t\t\t\t\t\tremoveCSSClass:removeCSSClass,\n\t\t\t\t\t\t\tshowElement: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonComplete: anim => {\n\t\t\t\tif (withAck) {\n\t\t\t\t\tmessageElement.classList.remove('log-message-ack');\n\t\t\t\t\t// we got the ack back so uncommited text should be shown as commited now\n\t\t\t\t\tif (value && sourceNodeTextElementId) {\n\t\t\t\t\t\tsetSVGText({targetId: sourceNodeTextElementId, addCSSClass: \"set-text-committed\"});\n\t\t\t\t\t}\n\t\t\t\t\tif (value && sourceNodeAdditionalTextElementId){\n\t\t\t\t\t\tsetSVGText({targetId: sourceNodeAdditionalTextElementId, text: Constants.COMMITED, addCSSClass: \"set-text-committed\"});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (srcTimerAnimation) {\n\t\t\t\t\tsrcTimerAnimation.restart();\n\t\t\t\t}\n\t\t\t\tmessageElement.style.transform = 'none';\n\t\t\t\tif (messageContrainer) {\n\t\t\t\t\tmessageContrainer.style.transform = 'none';\n\t\t\t\t}\n\n\t\t\t},\n\t\t\talternate: withAck,\n\t\t});\n\treturn animation;\n}\n\nexport function logMessageFromLeaderToFollowers(withAck, value, commitValue, delay, nodeATimerAnimation, nodeBTimerAnimation, nodeCTimerAnimation) {\n\tvar nodeAAnimation = sendLogMessage(Constants.NODE_C,Constants.NODE_A, withAck, value, commitValue, delay,nodeATimerAnimation, nodeCTimerAnimation);\n\n\t// message to Node B\n\t// var messageToB = document.getElementById('node-c-message-to-b');\n\tvar nodeBAnimation = sendLogMessage(Constants.NODE_C,Constants.NODE_B, withAck, value, commitValue, delay, nodeBTimerAnimation, nodeCTimerAnimation);\n\n\treturn [nodeAAnimation,nodeBAnimation];\n}\nexport function getFinishPromises(animations) {\n\tvar animationPromises = [];\n\tanimations.forEach(currentAnimation => {\n\t\tanimationPromises.push(currentAnimation.finished);\n\t});\n\treturn animationPromises;\n}\n\nexport function messageFromC(destination, params) {\n\tvar translateX = 0;\n\tvar translateY = 0;\n\tvar targets = \"\";\n\tif (destination == Constants.NODE_B) {\n\t\ttranslateX = -132;\n\t\ttranslateY = -290;\n\t\ttargets = '#node-c-message-to-b';\n\t} else if (destination == Constants.NODE_A) {\n\t\ttargets = '#node-c-message-to-a';\n\t\ttranslateX = -270;\n\t} else if (destination == Constants.CLIENT_NODE) {\n\t\ttargets = '#node-c-message-to-client';\n\t\ttranslateX = -100;\n\t\ttranslateY = 130;\n\t}\n\n\tvar animation = anime({\n\t\ttargets: targets,\n\t\ttranslateX: translateX,\n\t\ttranslateY: translateY,\n\t\teasing: 'linear',\n\t\tduration: 1000,\n\t\tdirection: params.alternate?'alternate':'normal',\n\t\tbegin: params.onBegin,\n\t\tchangeComplete: params.onChangeComplete,\n\t\tcomplete: params.onComplete,\n\t\tdelay: params.delay?params.delay:0\n\t});\n\treturn animation;\n}\n\nexport function messageFromA(destination, params) {\n\tvar translateX = 0;\n\tvar translateY = 0;\n\tvar targets = \"\";\n\tif (destination == Constants.NODE_B) {\n\t\ttranslateX = 160;\n\t\ttranslateY = -290;\n\t\ttargets = '#node-a-message-to-b';\n\t}\n\telse if (destination == Constants.CLIENT_NODE) {\n\t\ttranslateX = 150;\n\t\ttranslateY = 148;\n\t\ttargets = '#node-a-message-to-client';\n\t}\n\telse {\n\t\tconsole.warning('Unsupported destination: ' + destination);\n\t\treturn;\n\t}\n\n\n\tvar animation = anime({\n\t\ttargets: targets,\n\t\ttranslateX: translateX,\n\t\ttranslateY: translateY,\n\t\teasing: 'linear',\n\t\tduration: 1000,\n\t\tdirection: (params.alternate?'alternate':'normal'),\n\t\tbegin: params.onBegin,\n\t\tchangeComplete: params.onChangeComplete,\n\t\tcomplete: params.onComplete,\n\t\tdelay: params.delay?params.delay:0\n\t});\n\treturn animation;\n}\n\nexport function getSetValueText(value) {\n\treturn \"Value: \" + value;\n}\n\nexport function partitionNodeC() {\n\tvar nodeCPartition = document.getElementById('node-c-partition-wrap');\n\tshowElement(nodeCPartition);\n}\n\nexport function startMyLeaseTimer(forNode, duration){\n\tvar targetId = myLeaseTimerId(forNode);\n\treturn startLeaseTimer(targetId, forNode, duration);\n}\nexport function startLeaderLeaseTimer(forNode, duration){\n\tvar targetId = leaderLeaseTimerId(forNode);\n\treturn startLeaseTimer(targetId, forNode, duration);\n}\n\nexport function startLeaseTimer(targetId, forNode, duration){\n\tvar timer = document.getElementById(targetId);\n\tshowElement(timer);\n\n\tvar innerRect = document.getElementById(targetId + '-inner');\n\tvar animation = anime({\n\t\ttargets: innerRect,\n\t\twidth: '0',\n\t\teasing: 'easeOutCubic',\n\t\tduration: duration,\n\t});\n\treturn animation;\n}\n\nexport function myLeaseTimerId(forNode) {\n\treturn constructTimerId(\"mlease-rect-\", forNode);\n}\n\nexport function leaderLeaseTimerId(forNode) {\n\treturn constructTimerId(\"llease-rect\", forNode);\n}\n\nfunction constructTimerId(prefix, forNode) {\n\tvar id = prefix;\n\tswitch(forNode) {\n\t\tcase Constants.NODE_C: {\n\t\t\tid += \"node-c\";\n\t\t\tbreak;\n\t\t}\n\t\tcase Constants.NODE_B: {\n\t\t\tid += \"node-b\";\n\t\t\tbreak;\n\t\t}\n\t\tcase Constants.NODE_A: {\n\t\t\tid += \"node-a\";\n\t\t\tbreak;\n\t\t}\n\t\tdefault: {\n\t\t\tconsole.error(\"Unrecognized Node: \" + forNode);\n\t\t}\n\t}\n\treturn id;\n}\n"]},"metadata":{},"sourceType":"module"}