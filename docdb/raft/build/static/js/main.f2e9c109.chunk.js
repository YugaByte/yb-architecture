(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var a={DEFAULT_DELAY:2e3,NODE_A:"NODE_A",NODE_B:"NODE_B",NODE_C:"NODE_C",CLIENT_NODE:"CLIENT_NODE",ANIMATION_STATE_INITIAL:"ANIMATION_STATE_INITIAL",ANIMATION_STATE_FINISHED:"ANIMATION_STATE_FINISHED",COMMITTED:"(committed)",UNCOMMITTED:"(uncommitted)"}},12:function(e,t,n){},13:function(e,t,n){"use strict";n.r(t),n.d(t,"setSVGText",function(){return s}),n.d(t,"showElement",function(){return o}),n.d(t,"hideElement",function(){return d}),n.d(t,"delayedNext",function(){return r}),n.d(t,"setTextWithAnimation",function(){return l}),n.d(t,"introduceClient",function(){return m}),n.d(t,"hideClient",function(){return c}),n.d(t,"messageFromClient",function(){return E}),n.d(t,"sendLogMessage",function(){return u}),n.d(t,"logMessageFromLeaderToFollowers",function(){return g}),n.d(t,"logMessageAckFromFollowersToLeader",function(){return T}),n.d(t,"getFinishPromises",function(){return h}),n.d(t,"messageFromC",function(){return I}),n.d(t,"messageFromA",function(){return A}),n.d(t,"messageFromB",function(){return y}),n.d(t,"getSetValueText",function(){return x}),n.d(t,"partitionNodeC",function(){return _}),n.d(t,"startMyLeaseTimer",function(){return N}),n.d(t,"startLeaderLeaseTimer",function(){return L}),n.d(t,"startLeaseTimer",function(){return O}),n.d(t,"myLeaseTimerId",function(){return b}),n.d(t,"leaderLeaseTimerId",function(){return S});var a=n(2),i=n(1);function s(e){var t=document.getElementById(e.targetId);e.text&&(t.textContent=e.text),e.addCSSClass&&t.classList.add(e.addCSSClass),e.removeCSSClass&&t.classList.remove(e.removeCSSClass),e.showElement&&o(t)}function o(e){e.classList.remove("visibility-hidden"),e.classList.add("visibility-visible")}function d(e){e.classList.remove("visibility-visible"),e.classList.add("visibility-hidden")}function r(e,t){t||(t=i.a.DEFAULT_DELAY),setTimeout(function(){return e.next()},t)}function l(e,t,n,i){e.innerHTML=t;var s={opacityIn:[0,1],scaleIn:[.2,1],scaleOut:3,durationIn:2e3,durationOut:2e3};s.delay=i||500,Object(a.a)({targets:e,opacity:s.opacityIn,scale:s.scaleIn,duration:s.durationIn,complete:n,delay:s.delay})}function m(e){var t=document.getElementById("client-node");return o(t),e&&s({targetId:"client-node-value",text:e}),Object(a.a)({targets:t,translateY:-84})}function c(){d(document.getElementById("client-node")),d(document.getElementById("client-message-circle"))}function E(e,t){var n=document.getElementById("client-message"),s=0,o=0;switch(e){case i.a.NODE_C:s=140,o=-140;break;case i.a.NODE_A:s=-160,o=-156;break;default:return void console.log("messageFromClient: Unrecognized destination: "+e)}return Object(a.a)({targets:n,translateX:s,translateY:o,easing:"linear",duration:800,begin:t.onBegin,complete:t.onComplete,changeComplete:t.onChangeComplete,direction:t.alternate?"alternate":"normal"})}function u(e,t,n,a,d,r,l,m,c){console.log("FromNode: "+e+" toNode: "+t+" returnAck: "+n+" value: "+d+" commitValue: "+r);var u=null,g=null,T=null,h=null,x=null,_=null,N=null;switch(e){case i.a.NODE_A:u=A,h="node-a-extra-text",N="node-a-extra-text2",t===i.a.NODE_B?(g=document.getElementById("node-a-message-to-b"),T="node-b-extra-text",_="node-b-extra-text2"):t===i.a.NODE_C?(g=document.getElementById("node-a-message-to-c"),T="node-c-extra-text",_="node-c-extra-text2"):t===i.a.CLIENT_NODE&&(g=document.getElementById("node-a-message-to-client"));break;case i.a.NODE_B:u=y,h="node-b-extra-text",N="node-b-extra-text2",t===i.a.NODE_A?(g=document.getElementById("node-b-message-to-a"),T="node-a-extra-text",_="node-a-extra-text2"):t===i.a.NODE_C&&(g=document.getElementById("node-b-message-to-c"),T="node-c-extra-text",_="node-c-extra-text2");break;case i.a.NODE_C:u=I,h="node-c-extra-text",N="node-c-extra-text2",t===i.a.NODE_A?(g=document.getElementById("node-c-message-to-a"),T="node-a-extra-text",_="node-a-extra-text2"):t===i.a.NODE_B?(g=document.getElementById("node-c-message-to-b"),T="node-b-extra-text",_="node-b-extra-text2"):t===i.a.CLIENT_NODE&&(g=document.getElementById("node-c-message-to-client"));break;case i.a.CLIENT_NODE:u=E,g=document.getElementById("client-message-circle"),x=document.getElementById("client-message"),t===i.a.NODE_A?(T="node-a-extra-text",_="node-a-extra-text2"):t===i.a.NODE_B?(T="node-b-extra-text",_="node-b-extra-text2"):t===i.a.NODE_C&&(T="node-c-extra-text",_="node-c-extra-text2");break;default:throw new Error("Unrecognized fromNode: "+e)}return u(t,{delay:l,destinationTimerAnimation:m,onBegin:function(e){o(g),a?(g.classList.remove("log-message"),g.classList.add("log-message-ack")):(g.classList.add("log-message"),g.classList.remove("log-message-ack"))},onChangeComplete:function(e){console.log("In onChangeComplete. messageElement: "+g),m&&(console.log("Will restart timer animation"),m.restart()),n&&(g.classList.remove("log-message"),g.classList.add("log-message-ack"));var t=null;if(d&&T){var a="",o="";r?(a="set-text-committed",o="set-text-uncommitted",t=i.a.COMMITTED):(a="set-text-uncommitted",o="set-text-committed",t=i.a.UNCOMMITTED),console.log("additionalText: "+t+"additionalTextElementID: "+_),null!=t&&_&&s({targetId:_,text:t,addCSSClass:a,removeCSSClass:o,showElement:!r})}},onComplete:function(e){n&&(g.classList.remove("log-message-ack"),d&&h&&s({targetId:h,addCSSClass:"set-text-committed"}),d&&N&&s({targetId:N,text:i.a.COMMITTED,addCSSClass:"set-text-committed"})),c&&c.restart(),g.style.transform="none",x&&(x.style.transform="none")},alternate:n})}function g(e,t,n,a,s,o,d){return[u(i.a.NODE_C,i.a.NODE_A,e,!1,t,n,a,s,d),u(i.a.NODE_C,i.a.NODE_B,e,!1,t,n,a,o,d)]}function T(e,t,n,a,s,o){return[u(i.a.NODE_A,i.a.NODE_C,!1,!0,e,t,n,a,o),u(i.a.NODE_B,i.a.NODE_C,!1,!0,e,t,n,s,o)]}function h(e){var t=[];return e.forEach(function(e){t.push(e.finished)}),t}function I(e,t){var n=0,s=0,o="";return e===i.a.NODE_B?(n=-140,s=-276,o="#node-c-message-to-b"):e===i.a.NODE_A?(o="#node-c-message-to-a",n=-275):e===i.a.CLIENT_NODE&&(o="#node-c-message-to-client",n=-130,s=135),Object(a.a)({targets:o,translateX:n,translateY:s,easing:"linear",duration:1e3,direction:t.alternate?"alternate":"normal",begin:t.onBegin,changeComplete:t.onChangeComplete,complete:t.onComplete,delay:t.delay?t.delay:0})}function A(e,t){var n=0,s=0,o="";if(e===i.a.NODE_B)n=160,s=-290,o="#node-a-message-to-b";else if(e===i.a.NODE_C)n=275,o="#node-a-message-to-c";else{if(e!==i.a.CLIENT_NODE)return void console.warning("Unsupported destination: "+e);n=150,s=148,o="#node-a-message-to-client"}return Object(a.a)({targets:o,translateX:n,translateY:s,easing:"linear",duration:1e3,direction:t.alternate?"alternate":"normal",begin:t.onBegin,changeComplete:t.onChangeComplete,complete:t.onComplete,delay:t.delay?t.delay:0})}function y(e,t){var n=0,s=0,o="";if(e===i.a.NODE_A)n=-160,s=290,o="#node-b-message-to-a";else{if(e!==i.a.NODE_C)return void console.warning("Unsupported destination: "+e);n=140,s=276,o="#node-b-message-to-c"}return Object(a.a)({targets:o,translateX:n,translateY:s,easing:"linear",duration:1e3,direction:t.alternate?"alternate":"normal",begin:t.onBegin,changeComplete:t.onChangeComplete,complete:t.onComplete,delay:t.delay?t.delay:0})}function x(e){return"Value: "+e}function _(){o(document.getElementById("node-c-partition-wrap"))}function N(e,t){return O(b(e),t.duration,t.targetPercent,t.startPercent,t.disableAutoPlay)}function L(e,t){return O(S(e),t.duration,t.targetPercent,t.startPercent,t.disableAutoPlay)}function O(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,s=arguments.length>4?arguments[4]:void 0;o(document.getElementById(e));var d=document.getElementById(e+"-inner"),r=i/100*80,l=n/100*80;return Object(a.a)({targets:d,width:[r,l],easing:"easeOutCubic",duration:t,autoplay:!s})}function b(e){return f("mlease-rect-",e)}function S(e){return f("llease-rect-",e)}function f(e,t){var n=e;switch(t){case i.a.NODE_C:n+="node-c";break;case i.a.NODE_B:n+="node-b";break;case i.a.NODE_A:n+="node-a";break;default:console.error("Unrecognized Node: "+t)}return n}},19:function(e,t,n){e.exports=n(29)},25:function(e,t,n){},29:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),s=n(17),o=n.n(s),d=(n(25),n(5)),r=n(6),l=n(9),m=n(7),c=n(8),E=(n(12),n(33)),u=n(32),g=n(31),T=n(2),h=function(){return i.a.createElement("svg",{width:"100",height:"100",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("g",{id:"analog-clock",transform:"translate(10,10)"},i.a.createElement("circle",{id:"face",stroke:"black",strokeWidth:"3px",cx:"10",cy:"20",r:"10",fill:"transparent"}),i.a.createElement("g",{id:"hands"},i.a.createElement("rect",{id:"hour",x:"9",y:"12",width:"2",height:"10",rx:"2.5",ry:"2.55",strokeWidth:"1px",fill:"#333",stroke:"555"}),i.a.createElement("rect",{id:"min",x:"9",y:"20",width:"9",height:"2",rx:"2.5",ry:"2.55",strokeWidth:"1px",fill:"#333",stroke:"555"}))))},I=function(e){function t(){return Object(d.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return i.a.createElement("g",{transform:"translate(10,10)",className:this.props.className,id:this.props.uid},i.a.createElement("text",{x:this.props.x+36,y:this.props.y-4,fill:"black"},this.props.label),i.a.createElement("rect",{id:this.props.uid+"-inner",x:this.props.x+32,y:this.props.y,width:"80",height:"6",rx:"2.5",ry:"2.55",strokeWidth:"1px",fill:"#333",stroke:"#555"}),i.a.createElement("rect",{id:this.props.uid+"-outer",x:this.props.x+32,y:this.props.y,width:"80",height:"7",rx:"2.5",ry:"2.55",strokeWidth:"2px",fill:"transparent",stroke:"black"}),"}")}}]),t}(a.Component),A=n(1),y=n(13),x={mainText:{x:186,y:559},clientMessage:{x:186,y:478}},_={base:{x:42,y:324},messageToB:{x:48,y:324},messageToClient:{x:48,y:324},leaseTimer:{x:-6,y:419}},N={base:{x:320,y:324},messageToB:{x:352,y:324},messageToA:{x:352,y:324},messageToClient:{x:352,y:324},partitionText1:{x:240,y:254},partitionText2:{x:240,y:269}},L={base:{x:168,y:42},messageToA:{x:158,y:42},messageToC:{x:200,y:42}},O=function(e){function t(){return Object(d.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=x.clientMessage.x,t=x.clientMessage.y,n=_.base.x,a=_.base.y,s=L.base.x,o=L.base.y,d=N.base.x,r=N.base.y;return i.a.createElement("svg",{height:"500",width:"720"},i.a.createElement("defs",null,i.a.createElement(h,null)),i.a.createElement("foreignObject",{x:30,y:160,width:"400",height:"300"},i.a.createElement("div",{id:"center-message-text",style:{fontFamily:"Verdana",fontSize:"1em",padding:"30px"}})),i.a.createElement("g",null,i.a.createElement("text",{id:"center-message-rect",className:"visibility-hidden",x:e,y:170,fontFamily:"Verdana",fontSize:"1em"},i.a.createElement("tspan",{id:"center-message-text1",x:50,dy:"1.2em"}),i.a.createElement("tspan",{id:"center-message-text2",x:50,dy:"1.2em"}))),i.a.createElement("circle",{id:"node-c-message-to-b",className:"node-small-circle",cx:N.messageToB.x,cy:N.messageToB.y}),i.a.createElement("circle",{id:"node-c-message-to-a",className:"node-small-circle",cx:N.messageToA.x,cy:N.messageToB.y}),i.a.createElement("circle",{id:"node-c-message-to-client",className:"node-small-circle visibility-hidden",cx:N.messageToClient.x,cy:N.messageToClient.y}),i.a.createElement("g",{id:"node-c-partition-wrap",className:"visibility-hidden"},i.a.createElement("path",{d:"M250,360a83,75,0,1,1,190,-15",id:"node-c-partition",className:"node-partition"}),i.a.createElement("text",{fill:"black"},i.a.createElement("tspan",{x:N.partitionText1.x,y:N.partitionText1.y},"Partitioned"),i.a.createElement("tspan",{x:N.partitionText2.x,y:N.partitionText2.y},"from A & B"))),i.a.createElement("g",null,i.a.createElement("rect",{id:"client-message-status-bg",className:"visibility-hidden",x:e-92,y:t-152,fill:"white",width:"210",height:"76"}),i.a.createElement("text",{id:"client-query-message",x:e-90,y:t-148,className:"visibility-hidden"},i.a.createElement("tspan",{id:"client-query-message-anchor",x:e-80,dy:"1.2em"},"Query: "),i.a.createElement("tspan",{id:"client-query-message-text1",dx:5,className:"code-block"}),i.a.createElement("tspan",{id:"client-query-message-text2",x:e-83,dy:"1.2em",className:"code-block"}),i.a.createElement("tspan",{id:"client-query-message-text3",x:e-83,dy:"1.2em",className:"code-block"})),i.a.createElement("foreignObject",{x:e-85,y:t-148,width:"200",height:"70"},i.a.createElement("div",{id:"client-message-status"})),i.a.createElement("path",{id:"client-message-bubble",className:"visibility-hidden",d:"M".concat(e+3,",").concat(t-50," l0,-26 l-90,0 c0,0 -5,0 -5,-5 l0,-65 c0,0 0,-5 5,-5 l200,0 c0,0 5,0 5,5 l0,65 c0,0 0,5 -5,5 l-90,0 z"),style:{fillOpacity:0,stroke:"black",strokeWidth:1}})),i.a.createElement("g",{id:"client-message",className:"visibility-hidden"},i.a.createElement("circle",{id:"client-message-circle",className:"client-message",cx:e,cy:t}),i.a.createElement("text",{id:"client-message-text",x:e-18,y:t+24})),i.a.createElement("image",{href:"./warning-sign.jpg",width:"200",x:"0",y:"0"}),i.a.createElement("circle",{id:"node-b-small-circle",className:"node-small-circle",cx:s+24,cy:o+12}),i.a.createElement("circle",{id:"node-a-message-to-b",className:"node-small-circle visibility-hidden",cx:_.messageToB.x,cy:_.messageToB.y}),i.a.createElement("circle",{id:"node-a-message-to-c",className:"node-small-circle visibility-hidden",cx:_.messageToB.x,cy:_.messageToB.y}),i.a.createElement("circle",{id:"node-a-message-to-client",className:"node-small-circle visibility-hidden",cx:_.messageToClient.x,cy:_.messageToClient.y}),i.a.createElement("g",{id:"node-c-wrap"},i.a.createElement("circle",{id:"node-c-outer-circle",className:"node-outer-circle",cx:d+32,cy:r,r:"38",stroke:"rgb(158, 196, 226)",strokeWidth:"6",fill:"transparent"}),i.a.createElement("circle",{id:"node-c-circle",cx:d+32,cy:r,r:"35",stroke:"rgb(70, 130, 180)",strokeWidth:"0",fill:"rgb(70, 130, 180)"}),i.a.createElement("text",{id:"node-c-main-text",x:d+30,y:r+6,className:"node-text",fill:"black"},"Node C"),i.a.createElement(I,{className:"visibility-hidden",uid:y.myLeaseTimerId(A.a.NODE_C),x:d-48,y:r+93,label:"My Lease"}),i.a.createElement(I,{className:"visibility-hidden",uid:y.leaderLeaseTimerId(A.a.NODE_C),x:d-48,y:r+93,label:"Leader Lease"})),i.a.createElement("g",null,i.a.createElement("rect",{id:"node-c-text-highlight",className:"visibility-hidden",x:d+5,y:r+62,width:"55",height:"24",fill:"yellow"}),i.a.createElement("text",{id:"node-c-term-text-rect",x:d+10,y:r+40,fill:"black",className:"visibility-hidden"},i.a.createElement("tspan",{id:"node-c-term-text",x:d+10,dy:"1.2em"}),i.a.createElement("tspan",{id:"node-c-extra-text",className:"node-extra-text",x:d+10,dy:"1.2em"}),i.a.createElement("tspan",{id:"node-c-extra-text2",className:"node-extra-text2",dx:"0.5em"}))),i.a.createElement("foreignObject",{x:d-15,y:r-174,width:"235",height:"80"},i.a.createElement("div",{id:"node-c-message-text-alt"})),i.a.createElement("text",{id:"node-c-message-status",x:d-10,y:r-130,className:"visibility-hidden"},i.a.createElement("tspan",{id:"node-c-message-status-text1",x:d-10,dy:"1.2em"}),i.a.createElement("tspan",{id:"node-c-message-status-text2",x:d-10,dy:"1.2em"})),i.a.createElement("path",{id:"node-c-message-bubble",className:"visibility-hidden",d:"M".concat(d+40,",").concat(d-40," l0,-26 l-55,0 c0,0 -5,0 -5,-5 l0,-65 c0,0 0,-5 5,-5 l215,0 c0,0 5,0 5,5 l0,65 c0,0 0,5 -5,5 l-140,0 z"),style:{fillOpacity:0,stroke:"black",strokeWidth:1}}),i.a.createElement("path",{id:"node-c-message-bubble-alt",className:"visibility-hidden",d:"M".concat(d+45,",").concat(d-50," l15,-40 l-80,0 c0,0 -5,0 -5,-5 l0,-80 c0,0 0,-5 5,-5 l235,0 c0,0 5,0 5,5 l0,80 c0,0 0,5 -5,5 l-135,0 z"),style:{fillOpacity:0,stroke:"black",strokeWidth:1}}),i.a.createElement("g",{id:"node-a-wrap"},i.a.createElement("circle",{id:"node-a-outer-circle",className:"node-outer-circle",cx:n,cy:a,r:"38",stroke:"rgb(158, 196, 226)",strokeWidth:"6",fill:"transparent"}),i.a.createElement("circle",{id:"node-a-circle",cx:n,cy:a,r:"35",stroke:"rgb(70, 130, 180)",strokeWidth:"0",fill:"rgb(70, 130, 180)"}),i.a.createElement("text",{id:"node-a-main-text",x:n,y:a+6,className:"node-text"},"Node A"),i.a.createElement("rect",{id:"node-a-timer-highlight",className:"visibility-hidden",x:_.leaseTimer.x+18,y:_.leaseTimer.y-12,width:"75",height:"20",fill:"yellow"}),i.a.createElement(I,{className:"visibility-hidden",uid:y.myLeaseTimerId(A.a.NODE_A),x:_.leaseTimer.x-24,y:_.leaseTimer.y,label:"My Lease"}),i.a.createElement(I,{className:"visibility-hidden",uid:y.leaderLeaseTimerId(A.a.NODE_A),x:_.leaseTimer.x-24,y:_.leaseTimer.y,label:"Leader Lease"})),i.a.createElement("g",null,i.a.createElement("rect",{id:"node-a-term-highlight",className:"visibility-hidden",x:n-30,y:a+41,width:"63",height:"24",fill:"yellow"}),i.a.createElement("rect",{id:"node-a-text-highlight",className:"visibility-hidden",x:n-30,y:a+62,width:"55",height:"24",fill:"yellow"}),i.a.createElement("text",{id:"node-a-term-text-rect",x:n,y:a+40,fill:"black",className:"visibility-hidden"},i.a.createElement("tspan",{id:"node-a-term-text",x:n-24,dy:"1.2em"}),i.a.createElement("tspan",{id:"node-a-extra-text",className:"node-extra-text",x:n-24,dy:"1.2em"}),i.a.createElement("tspan",{id:"node-a-extra-text2",className:"node-extra-text2",dx:"0.5em"}))),i.a.createElement("circle",{id:"node-b-message-to-a",className:"node-small-circle visibility-hidden",cx:L.messageToA.x,cy:L.messageToA.y}),i.a.createElement("circle",{id:"node-b-message-to-c",className:"node-small-circle visibility-visible log-message",cx:L.messageToC.x,cy:L.messageToC.y}),i.a.createElement("g",{id:"node-b-wrap"},i.a.createElement("circle",{id:"node-b-circle",cx:s+24,cy:o,r:"35",stroke:"rgb(70, 130, 180)",strokeWidth:"0",fill:"rgb(70, 130, 180)"}),i.a.createElement("circle",{id:"node-b-outer-circle",className:"node-outer-circle",cx:s+24,cy:o,r:"38",stroke:"rgb(158, 196, 226)",strokeWidth:"6",fill:"transparent"}),i.a.createElement("text",{id:"node-b-main-text",x:s+24,y:o+6,className:"node-text"},"Node B"),i.a.createElement(I,{className:"visibility-hidden",uid:y.myLeaseTimerId(A.a.NODE_B),x:s-54,y:o+95,label:"My Lease"}),i.a.createElement(I,{className:"visibility-hidden",uid:y.leaderLeaseTimerId(A.a.NODE_B),x:s-54,y:o+95,label:"Leader Lease"})),i.a.createElement("g",null,i.a.createElement("rect",{id:"node-b-term-highlight",className:"visibility-hidden",x:s-6,y:o+45,width:"63",height:"24",fill:"yellow"}),i.a.createElement("rect",{id:"node-b-text-highlight",className:"visibility-hidden",x:s-6,y:o+65,width:"55",height:"24",fill:"yellow"}),i.a.createElement("text",{id:"node-b-term-text-rect",x:s,y:o+43,fill:"black",className:"visibility-hidden"},i.a.createElement("tspan",{id:"node-b-term-text",x:s,dy:"1.2em"}),i.a.createElement("tspan",{id:"node-b-extra-text",className:"node-extra-text",x:s,dy:"1.2em"}),i.a.createElement("tspan",{id:"node-b-extra-text2",className:"node-extra-text2",dx:"0.5em"}))),i.a.createElement("rect",{id:"node-a-message-status-bg",className:"visibility-hidden",x:n-40,y:a-167,fill:"white",width:"207",height:"100"}),i.a.createElement("foreignObject",{x:n-32,y:a-155,width:"200",height:"80"},i.a.createElement("div",{id:"node-a-message-status"})),i.a.createElement("path",{id:"node-a-message-bubble",className:"visibility-hidden",d:"M62,284 l0,-26 l-55,0 c0,0 -5,0 -5,-5 l0,-90 c0,0 0,-5 5,-5 l196,0 c0,0 5,0 5,5 l0,90 c0,0 0,5 -5,5 l-126,0 z",style:{fillOpacity:0,stroke:"black",strokeWidth:1}}),i.a.createElement("g",{id:"client-node",className:"visibility-visible"},i.a.createElement("circle",{className:"client-node",cx:186,cy:550}),i.a.createElement("text",{id:"client-node-main-text",x:186,y:559,className:"client-node-text"},"Client"),i.a.createElement("text",{id:"client-node-value",x:226,y:559}),i.a.createElement("text",{id:"client-node-value-alt",x:226,y:559,className:"visibility-hidden"},i.a.createElement("tspan",{fill:"red",x:226,fontSize:"1.5em"},"\xd7"),i.a.createElement("tspan",{id:"client-node-value-error-header",dx:"4px"}),i.a.createElement("tspan",{id:"client-node-value-error-subtitle",fill:"red",x:226,dy:"1.2em"}))),i.a.createElement("g",{id:"node-c-lease-to-node-a",className:"visibility-hidden"},i.a.createElement("use",{href:"#analog-clock",x:d+6,y:r-36})),i.a.createElement("g",{id:"node-c-lease-to-node-b",className:"visibility-hidden"},i.a.createElement("use",{href:"#analog-clock",x:d+24,y:r-36})),i.a.createElement("g",{id:"node-a-lease-to-node-b",className:"visibility-hidden"},i.a.createElement("use",{href:"#analog-clock",x:n,y:a-36})))}}]),t}(a.Component),b=n(13),S=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).animationState=A.a.ANIMATION_STATE_INITIAL,n.state={animationFinished:!1,previousEnabled:!0},n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){this.mainTextSect=document.getElementById("center-message-text")}},{key:"pause",value:function(){}},{key:"resume",value:function(){}},{key:"onNext",value:function(){var e=this;return new Promise(function(t,n){e.onNextInternal(t,n)})}},{key:"onNextInternal",value:function(e,t){var n=this,a=document.getElementById("node-a-term-text-rect"),i=document.getElementById("node-b-term-text-rect"),s=document.getElementById("node-c-term-text-rect"),o=document.getElementById("node-a-term-text"),d=document.getElementById("node-b-term-text"),r=document.getElementById("node-c-term-text"),l=document.getElementById("node-a-term-highlight"),m=document.getElementById("node-b-term-highlight"),c=document.getElementById("node-a-extra-text"),E=document.getElementById("node-b-extra-text"),u=document.getElementById("node-c-extra-text"),g=document.getElementById("node-a-text-highlight"),h=document.getElementById("node-a-extra-text2"),I=document.getElementById("node-a-message-bubble"),y=document.getElementById("node-a-message-status"),x=document.getElementById("client-message-bubble"),_=document.getElementById("client-query-message"),N=document.getElementById("client-message-status-bg");switch(this.animationState){case A.a.ANIMATION_STATE_INITIAL:for(var L=document.getElementsByClassName("node-outer-circle"),O=0;O<L.length;O++)b.hideElement(L[O]);this.changeMainText("Let's say we have a 3-node raft group.<br />C is the raft leader, all nodes have data <br />k = V1",function(){document.getElementById("node-c-circle").classList.add("leader-node"),b.showElement(a),b.showElement(i),b.showElement(s),o.innerHTML="Term: 1",d.innerHTML="Term: 1",r.innerHTML="Term: 1",c.innerHTML="(k, V1)",E.innerHTML="(k, V1)",u.innerHTML="(k, V1)",n.animationState="ANIMATION_STATE_UNSAFE_READ",e({animationState:n.animationState,delay:100})});break;case"ANIMATION_STATE_UNSAFE_READ":this.changeMainText(""),b.showElement(document.getElementById("node-c-message-bubble-alt"));var S=document.getElementById("node-c-message-text-alt"),f={index:0,str:"Unsafe to read from raft leader without majority heartbeats. This sequence explains why."};Object(T.a)({targets:f,index:f.str.length,easing:"linear",duration:1500,update:function(){S.innerText=f.str.substr(0,f.index)},complete:function(){n.animationState="ANIMATION_STATE_NODE_C_PARTITIONED",e({animationState:n.animationState,delay:100})}});break;case"ANIMATION_STATE_NODE_C_PARTITIONED":this.changeMainText("");var M=document.getElementById("node-c-message-text-alt");b.showElement(document.getElementById("node-c-message-bubble-alt"));var B={index:0,str:"Now imagine raft leader C gets\n partitioned from followers\n[but not from client]"};Object(T.a)({targets:B,index:B.str.length,easing:"linear",duration:1500,update:function(){M.innerText=B.str.substr(0,B.index)},complete:function(){b.partitionNodeC(),n.animationState="ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER",e({animationState:n.animationState,delay:100})}});break;case"ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER":document.getElementById("node-c-message-text-alt").innerText="",b.hideElement(document.getElementById("node-c-message-bubble-alt")),b.showElement(I);var C={index:0,str:"This results in A and B\n electing a new raft\nleader, say A."};Object(T.a)({targets:C,index:C.str.length,easing:"linear",duration:1300,update:function(){y.innerHTML=C.str.substr(0,C.index)},complete:function(){document.getElementById("node-a-circle").classList.add("leader-node"),b.setSVGText({targetId:"node-a-term-text",text:"Term: 2"}),b.setSVGText({targetId:"node-b-term-text",text:"Term: 2"}),b.showElement(l),b.showElement(m),n.animationState="ANIMATION_STATE_CLIENT_SET_OPERATION",e({animationState:n.animationState,delay:100})}});break;case"ANIMATION_STATE_CLIENT_SET_OPERATION":y.innerHTML="",b.hideElement(I),b.hideElement(l),b.hideElement(m),b.introduceClient();var D={index:0,str:"UPDATE T SET"},v={index:0,str:"value = V2 WHERE"},p={index:0,str:" key = k"},R=document.getElementById("client-query-message-text1"),w=document.getElementById("client-query-message-text2"),k=document.getElementById("client-query-message-text3");b.showElement(x),b.showElement(N),b.showElement(_),Object(T.a)({targets:D,index:D.str.length,easing:"linear",duration:400,update:function(){R.textContent=D.str.substr(0,D.index)},complete:function(){Object(T.a)({targets:v,index:v.str.length,easing:"linear",duration:400,update:function(){w.textContent=v.str.substr(0,v.index)},complete:function(){Object(T.a)({targets:p,index:p.str.length,easing:"linear",duration:400,update:function(){k.textContent=p.str.substr(0,p.index)},complete:function(){b.sendLogMessage(A.a.CLIENT_NODE,A.a.NODE_A,!1,!1,"(k, V2)").finished.then(function(){b.sendLogMessage(A.a.NODE_A,A.a.NODE_B,!0,!1,"(k, V2)").finished.then(function(){document.getElementById("client-query-message-text1").innerHTML="",document.getElementById("client-query-message-text2").innerHTML="",document.getElementById("client-query-message-text3").innerHTML="",b.hideElement(x),b.hideElement(_),b.showElement(I);var t=b.sendLogMessage(A.a.NODE_A,A.a.NODE_B,!1,!1,"",!0,600);c.innerHTML="(k, V2)",b.showElement(g),b.hideElement(h),t.finished.then(function(){b.showElement(document.getElementById("node-b-text-highlight")),document.getElementById("node-b-extra-text").innerHTML="(k, V2)",b.hideElement(document.getElementById("node-b-extra-text2"))}),y.innerHTML="",b.hideElement(I),b.sendLogMessage(A.a.NODE_A,A.a.CLIENT_NODE).finished.then(function(){b.showElement(x),b.hideElement(_),document.getElementById("client-message-status").textContent="Update successful!",n.animationState="ANIMATION_STATE_CLIENT_READ_FROM_NODE_C",e({animationState:n.animationState,delay:100})})})})}})}})}});break;case"ANIMATION_STATE_CLIENT_READ_FROM_NODE_C":y.innerHTML="",b.hideElement(I),b.hideElement(document.getElementById("node-a-text-highlight")),b.hideElement(document.getElementById("node-b-text-highlight")),document.getElementById("client-query-message-text1").innerHTML="",document.getElementById("client-query-message-text2").innerHTML="",document.getElementById("client-query-message-text3").innerHTML="",b.hideElement(x),b.hideElement(_),document.getElementById("client-message-status").innerHTML="",this.changeMainText("Now the client queries C. This should return value = V2",function(){n.animationState="ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER",e({animationState:n.animationState,delay:100})});break;case"ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER":this.changeMainText("");var H=document.getElementById("client-query-message-text1"),P=document.getElementById("client-query-message-text2");H.innerHTML="",P.innerHTML="",b.showElement(x),b.showElement(N),b.showElement(_),b.hideElement(document.getElementById("node-c-extra-text2"));var j={index:0,str:"SELECT value"},V={index:0,str:"FROM T WHERE key = k"};Object(T.a)({targets:j,index:j.str.length,easing:"linear",duration:400,update:function(){H.innerHTML=j.str.substr(0,j.index)},complete:function(){Object(T.a)({targets:V,index:V.str.length,easing:"linear",duration:600,update:function(){P.innerHTML=V.str.substr(0,V.index)},complete:function(){b.sendLogMessage(A.a.CLIENT_NODE,A.a.NODE_C,!1),n.animationState="ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE",e({animationState:n.animationState,delay:100})}})}});break;case"ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE":b.hideElement(x),b.hideElement(N),b.hideElement(_);var F=document.getElementById("node-c-message-text-alt");b.showElement(document.getElementById("node-c-message-bubble-alt"));var U={index:0,str:"C thinks it is the raft leader.\nWithout majority heartbeats,\nC will respond with value = V1"};Object(T.a)({targets:U,index:U.str.length,easing:"linear",duration:1500,update:function(){F.innerText=U.str.substr(0,U.index)},complete:function(){b.sendLogMessage(A.a.NODE_C,A.a.CLIENT_NODE,!1).finished.then(function(){b.showElement(document.getElementById("client-node-value-alt")),document.getElementById("client-node-value-error-header").innerHTML="Value: V1",document.getElementById("client-node-value-error-subtitle").innerHTML="Expected value = V2"}),n.animationState=A.a.ANIMATION_STATE_FINISHED,n.setState({animationFinished:!0}),e({animationState:n.animationState,delay:100})}});break;case A.a.ANIMATION_STATE_FINISHED:e({animationState:this.animationState,delay:100});break;default:console.error("Unrecognized state: "+this.animationState)}}},{key:"onPrevious",value:function(){var e=this;return new Promise(function(t,n){e.onPreviousInternal(t,n)})}},{key:"onPreviousInternal",value:function(e,t){var n=this,a=document.getElementById("node-a-term-text-rect"),i=document.getElementById("node-b-term-text-rect"),s=document.getElementById("node-c-term-text-rect"),o=document.getElementById("node-a-term-text"),d=document.getElementById("node-b-term-text"),r=document.getElementById("node-c-term-text"),l=document.getElementById("node-a-term-highlight"),m=document.getElementById("node-b-term-highlight"),c=document.getElementById("node-a-extra-text"),E=document.getElementById("node-b-extra-text"),u=document.getElementById("node-c-extra-text"),g=document.getElementById("node-a-text-highlight"),h=document.getElementById("node-b-text-highlight"),I=document.getElementById("node-a-extra-text2"),y=document.getElementById("node-a-message-bubble"),x=document.getElementById("node-a-message-status"),_=document.getElementById("client-message-bubble"),N=document.getElementById("client-query-message"),L=document.getElementById("client-message-status-bg"),O=document.getElementById("node-c-partition-wrap");switch(this.animationState){case"ANIMATION_STATE_UNSAFE_READ":document.getElementById("node-c-circle").classList.remove("leader-node"),b.hideElement(a),b.hideElement(i),b.hideElement(s),o.innerHTML="",d.innerHTML="",r.innerHTML="",c.innerHTML="",E.innerHTML="",u.innerHTML="",this.changeMainText(""),this.animationState=A.a.ANIMATION_STATE_INITIAL,e({animationState:this.animationState,delay:100});break;case"ANIMATION_STATE_NODE_C_PARTITIONED":var S=document.getElementById("node-c-circle");S.classList.remove("leader-node"),b.hideElement(document.getElementById("node-c-message-bubble-alt")),document.getElementById("node-c-message-text-alt").innerText="",o.innerHTML="",d.innerHTML="",r.innerHTML="",c.innerHTML="",E.innerHTML="",u.innerHTML="",this.changeMainText("Let's say we have a 3-node raft group.<br />C is the raft leader, all nodes have data <br />k = V1",function(){o.innerHTML="Term: 1",d.innerHTML="Term: 1",r.innerHTML="Term: 1",c.innerHTML="(k, V1)",E.innerHTML="(k, V1)",u.innerHTML="(k, V1)",S.classList.add("leader-node"),n.animationState="ANIMATION_STATE_UNSAFE_READ",e({animationState:n.animationState,delay:100})});break;case"ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER":b.hideElement(O);var f=document.getElementById("node-c-message-text-alt");f.innerText="";var M={index:0,str:"Unsafe to read from raft leader without majority heartbeats. This sequence explains why."};Object(T.a)({targets:M,index:M.str.length,easing:"linear",duration:1500,update:function(){f.innerText=M.str.substr(0,M.index)},complete:function(){n.animationState="ANIMATION_STATE_NODE_C_PARTITIONED",e({animationState:n.animationState,delay:100})}});break;case"ANIMATION_STATE_CLIENT_SET_OPERATION":document.getElementById("node-a-circle").classList.remove("leader-node"),b.hideElement(O),o.innerHTML="Term: 1",d.innerHTML="Term: 1",b.hideElement(l),b.hideElement(m),b.hideElement(document.getElementById("node-a-message-bubble")),x.innerText="";var B=document.getElementById("node-c-message-text-alt");b.showElement(document.getElementById("node-c-message-bubble-alt"));var C={index:0,str:"Now imagine raft leader C gets\n partitioned from followers\n[but not from client]"};Object(T.a)({targets:C,index:C.str.length,easing:"linear",duration:1500,update:function(){B.innerText=C.str.substr(0,C.index)},complete:function(){b.showElement(O),n.animationState="ANIMATION_STATE_NODE_A_ELECTED_AS_LEADER",e({animationState:n.animationState,delay:100})}});break;case"ANIMATION_STATE_CLIENT_READ_FROM_NODE_C":b.hideElement(_),b.hideElement(document.getElementById("client-node")),b.hideElement(document.getElementById("client-message-circle")),document.getElementById("client-message-status").innerHTML="",b.hideElement(g),b.hideElement(h),b.hideElement(N),c.innerText="(k, V1)",E.innerText="(k, V1)",b.setSVGText({targetId:"node-a-term-text",text:"Term: 1"}),b.setSVGText({targetId:"node-b-term-text",text:"Term: 1"}),b.showElement(y);var D={index:0,str:"This results in A and B\n electing a new raft\nleader, say A."};Object(T.a)({targets:D,index:D.str.length,easing:"linear",duration:1300,update:function(){x.innerHTML=D.str.substr(0,D.index)},complete:function(){document.getElementById("node-a-circle").classList.add("leader-node"),b.setSVGText({targetId:"node-a-term-text",text:"Term: 2"}),b.setSVGText({targetId:"node-b-term-text",text:"Term: 2"}),b.showElement(l),b.showElement(m),n.animationState="ANIMATION_STATE_CLIENT_SET_OPERATION",e({animationState:n.animationState,delay:100})}});break;case"ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER":this.changeMainText(""),x.innerHTML="",b.hideElement(y),b.hideElement(l),b.hideElement(m),b.introduceClient();var v={index:0,str:"UPDATE T SET"},p={index:0,str:"value = V2 WHERE"},R={index:0,str:" key = k"},w=document.getElementById("client-query-message-text1"),k=document.getElementById("client-query-message-text2"),H=document.getElementById("client-query-message-text3");w.innerHTML="",k.innerHTML="",H.innerHTML="",b.showElement(_),b.showElement(L),b.showElement(N),Object(T.a)({targets:v,index:v.str.length,easing:"linear",duration:400,update:function(){w.textContent=v.str.substr(0,v.index)},complete:function(){Object(T.a)({targets:p,index:p.str.length,easing:"linear",duration:400,update:function(){k.textContent=p.str.substr(0,p.index)},complete:function(){Object(T.a)({targets:R,index:R.str.length,easing:"linear",duration:400,update:function(){H.textContent=R.str.substr(0,R.index)},complete:function(){b.sendLogMessage(A.a.CLIENT_NODE,A.a.NODE_A,!1,!1,"(k, V2)").finished.then(function(){b.sendLogMessage(A.a.NODE_A,A.a.NODE_B,!0,!1,"(k, V2)").finished.then(function(){document.getElementById("client-query-message-text1").innerHTML="",document.getElementById("client-query-message-text2").innerHTML="",document.getElementById("client-query-message-text3").innerHTML="",b.hideElement(_),b.showElement(y);var t=b.sendLogMessage(A.a.NODE_A,A.a.NODE_B,!1,!1,"",!0,600);c.innerHTML="(k, V2)",b.showElement(g),b.hideElement(I),t.finished.then(function(){b.showElement(document.getElementById("node-b-text-highlight")),document.getElementById("node-b-extra-text").innerHTML="(k, V2)",b.hideElement(document.getElementById("node-b-extra-text2"))}),x.innerHTML="",b.hideElement(y),b.sendLogMessage(A.a.NODE_A,A.a.CLIENT_NODE).finished.then(function(){b.showElement(_),document.getElementById("client-message-status").textContent="Update successful!",n.animationState="ANIMATION_STATE_CLIENT_READ_FROM_NODE_C",e({animationState:n.animationState,delay:100})})})})}})}})}});break;case"ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE":b.hideElement(L),b.hideElement(N),b.hideElement(_),this.changeMainText("Now the client queries C. This should return value = V2",function(){n.animationState="ANIMATION_STATE_CLIENT_SENDS_QUERY_TO_OLD_LEADER",e({animationState:n.animationState,delay:100})});break;case A.a.ANIMATION_STATE_FINISHED:this.setState({animationFinished:!1}),document.getElementById("node-c-message-text-alt").innerHTML="",b.hideElement(document.getElementById("client-node-value-alt")),b.hideElement(document.getElementById("node-c-message-bubble-alt"));var P=document.getElementById("client-query-message-text1"),j=document.getElementById("client-query-message-text2");P.innerHTML="",j.innerHTML="",b.showElement(_),b.showElement(L),b.showElement(N),b.hideElement(document.getElementById("node-c-extra-text2"));var V={index:0,str:"SELECT value"},F={index:0,str:"FROM T WHERE key = k"};Object(T.a)({targets:V,index:V.str.length,easing:"linear",duration:400,update:function(){P.innerHTML=V.str.substr(0,V.index)},complete:function(){Object(T.a)({targets:F,index:F.str.length,easing:"linear",duration:600,update:function(){j.innerHTML=F.str.substr(0,F.index)},complete:function(){b.sendLogMessage(A.a.CLIENT_NODE,A.a.NODE_C,!1),n.animationState="ANIMATION_STATE_NODE_C_RETURNS_INCORRECT_VALUE",e({animationState:n.animationState,delay:100})}})}});break;default:console.error("Unrecognized state: "+this.animationState)}}},{key:"changeMainText",value:function(e,t){b.setTextWithAnimation(this.mainTextSect,e,t)}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",{id:"main-diagram"},i.a.createElement(O,null)),i.a.createElement("div",{id:"main-text-sect"}))}}]),t}(a.Component),f=n(13),M=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).animationState=A.a.ANIMATION_STATE_INITIAL,n.state={animationFinished:!1,previousEnabled:!0},n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){this.mainTextSect=document.getElementById("center-message-text")}},{key:"pause",value:function(){}},{key:"resume",value:function(){}},{key:"onNext",value:function(){var e=this;return new Promise(function(t,n){e.onNextInternal(t,n)})}},{key:"onNextInternal",value:function(e,t){var n=this,a=document.getElementById("node-a-term-text-rect"),i=document.getElementById("node-b-term-text-rect"),s=document.getElementById("node-c-term-text-rect"),o=document.getElementById("node-a-term-text"),d=document.getElementById("node-b-term-text"),r=document.getElementById("node-c-term-text"),l=document.getElementById("node-a-extra-text"),m=document.getElementById("node-b-extra-text"),c=document.getElementById("node-c-extra-text"),E=document.getElementById("node-a-text-highlight"),u=document.getElementById("node-b-text-highlight"),g=document.getElementById("node-c-text-highlight"),h=document.getElementById("client-message-bubble");switch(this.animationState){case A.a.ANIMATION_STATE_INITIAL:for(var I=document.getElementsByClassName("node-outer-circle"),y=0;y<I.length;y++)f.hideElement(I[y]);this.changeMainText("Let\u2019s say we have a 3-node raft group."),this.animationState="ANIMATION_STATE_EXPLAIN_PROTOCOL",e({animationState:"ANIMATION_STATE_EXPLAIN_PROTOCOL",delay:100});break;case"ANIMATION_STATE_EXPLAIN_PROTOCOL":this.changeMainText("Nodes would have performed leader election..",function(){f.showElement(a),f.showElement(i),f.showElement(s),l.innerHTML="Voted For C",m.innerHTML="Voted For C",c.innerHTML="Voted For C"}),this.animationState="ANIMATION_STATE_LEADER_ELECTION",e({animationState:"ANIMATION_STATE_LEADER_ELECTION",delay:100});break;case"ANIMATION_STATE_LEADER_ELECTION":this.changeMainText(""),f.showElement(document.getElementById("node-c-message-bubble")),f.showElement(document.getElementById("node-c-message-status"));var x={index:0,str:"C is the current raft leader,"},_={index:0,str:"denoted by a black border."},N=document.getElementById("node-c-message-status-text1"),L=document.getElementById("node-c-message-status-text2");Object(T.a)({targets:x,index:x.str.length,easing:"linear",duration:600,update:function(){N.innerHTML=x.str.substr(0,x.index)},complete:function(){Object(T.a)({targets:_,index:_.str.length,easing:"linear",duration:900,update:function(){L.innerHTML=_.str.substr(0,_.index)},complete:function(){document.getElementById("node-c-circle").classList.add("leader-node"),o.innerHTML="Term: 1",d.innerHTML="Term: 1",r.innerHTML="Term: 1",n.animationState="ANIMATION_STATE_NODE_DATA",e({animationState:"ANIMATION_STATE_NODE_DATA",delay:100})}})}});break;case"ANIMATION_STATE_NODE_DATA":f.hideElement(document.getElementById("node-c-message-bubble")),f.hideElement(document.getElementById("node-c-message-status")),document.getElementById("node-c-message-status-text1").innerHTML="",document.getElementById("node-c-message-status-text2").innerHTML="",this.changeMainText("Assume all nodes have data: <br />(key,value) = (k, V1)",function(){l.innerHTML="(k, V1)",m.innerHTML="(k, V1)",c.innerHTML="(k, V1)",f.showElement(E),f.showElement(u),f.showElement(g)}),this.animationState="ANIMATION_STATE_CLIENT_INTRODUCED",e({animationState:"ANIMATION_STATE_CLIENT_INTRODUCED",delay:100});break;case"ANIMATION_STATE_CLIENT_INTRODUCED":var O=f.introduceClient("");this.changeMainText(""),O.finished.then(function(){f.hideElement(E),f.hideElement(u),f.hideElement(g),f.showElement(document.getElementById("client-message"));var t=document.getElementById("client-query-message");document.getElementById("client-query-message-text1");var a={index:0,str:"SELECT value"},i={index:0,str:"FROM T WHERE key = k"},s=document.getElementById("client-query-message-text1"),o=document.getElementById("client-query-message-text2");f.showElement(h),f.showElement(t),Object(T.a)({targets:a,index:a.str.length,easing:"linear",duration:600,update:function(){s.textContent=a.str.substr(0,a.index)},complete:function(){Object(T.a)({targets:i,index:i.str.length,easing:"linear",duration:900,update:function(){o.innerHTML=i.str.substr(0,i.index)},complete:function(){return f.sendLogMessage(A.a.CLIENT_NODE,A.a.NODE_C,!1)}})}}),n.animationState="ANIMATION_STATE_PERFORMED_READ_ON_LEADER",e({animationState:"ANIMATION_STATE_PERFORMED_READ_ON_LEADER",delay:100})});break;case"ANIMATION_STATE_PERFORMED_READ_ON_LEADER":f.hideElement(document.getElementById("client-query-message")),f.hideElement(h),document.getElementById("client-query-message-text1").innerHTML="",document.getElementById("client-query-message-text2").innerHTML="";var b=document.getElementById("node-c-message-status");f.showElement(document.getElementById("node-c-message-bubble")),f.showElement(b);var S={index:0,str:"Per raft protocol, leader should"},M={index:0,str:"obtain majority heartbeat."},B=document.getElementById("node-c-message-status-text1"),C=document.getElementById("node-c-message-status-text2");Object(T.a)({targets:S,index:S.str.length,easing:"linear",duration:800,update:function(){B.textContent=S.str.substr(0,S.index)},complete:function(){Object(T.a)({targets:M,index:M.str.length,easing:"linear",duration:1040,update:function(){C.textContent=M.str.substr(0,M.index)},complete:function(){return f.logMessageFromLeaderToFollowers(!1)}}),n.animationState="ANIMATION_STATE_LEADER_RECEIVED_MAJORITY_ON_VALUE_FROM_FOLLOWERS"}}),e({animationState:this.animationState,delay:1e3});break;case"ANIMATION_STATE_LEADER_RECEIVED_MAJORITY_ON_VALUE_FROM_FOLLOWERS":f.logMessageAckFromFollowersToLeader()[0].finished.then(function(){document.getElementById("node-c-message-status-text1").textContent="Leader:",document.getElementById("node-c-message-status-text2").textContent="";var t={index:7,str:"Majority heartbeat obtained,"},a={index:0,str:"raft leader can serve read."},i=document.getElementById("node-c-message-status-text1"),s=document.getElementById("node-c-message-status-text2");Object(T.a)({targets:t,index:t.str.length,easing:"linear",duration:800,update:function(){i.textContent=t.str.substr(0,t.index)},complete:function(){Object(T.a)({targets:a,index:a.str.length,easing:"linear",duration:1080,update:function(){s.textContent=a.str.substr(0,a.index)},complete:function(){f.sendLogMessage(A.a.NODE_C,A.a.CLIENT_NODE).finished.then(function(){f.setSVGText({targetId:"client-node-value",text:"value: ".concat("V1"),showElement:!0}),n.animationState="ANIMATION_STATE_CLIENT_FINISH_OPERATION",e({animationState:n.animationState,delay:100})})}})}})});break;case"ANIMATION_STATE_CLIENT_FINISH_OPERATION":f.hideElement(document.getElementById("node-c-message-bubble")),f.hideElement(document.getElementById("node-c-message-status")),this.changeMainText(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"550.45",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"627.77";return'<svg id="Layer_3" xmlns="http://www.w3.org/2000/svg" height='.concat(e,'" width="').concat(t,'" version="1.0" viewBox="0 0 627.769 550.45">\n\t\t\t<path id="path2231" fill="#ea0000" d="m614.57 504.94l-279.4-483.94c-4.38-7.588-12.47-12.262-21.23-12.262s-16.85 4.674-21.23 12.258l-279.41 483.94c-4.375 7.58-4.375 16.93 0.003 24.52 4.379 7.58 12.472 12.25 21.23 12.25h558.81c8.76 0 16.86-4.67 21.23-12.25 4.38-7.59 4.38-16.94 0-24.52z"/>\n\t\t\t<polygon id="polygon2233" points="93.977 482.88 533.9 482.88 313.94 101.89" fill="#fff"/>\n\t\t\t<path id="path2235" d="m291.87 343.36c1.21 11.49 3.21 20.04 6.02 25.66 2.81 5.63 7.82 8.43 15.04 8.43h2.01c7.22 0 12.24-2.8 15.04-8.43 2.81-5.62 4.82-14.17 6.02-25.66l6.42-88.75c1.21-17.3 1.81-29.71 1.81-37.25 0-10.25-2.91-18.25-8.73-23.99-5.53-5.46-13.38-8.59-21.56-8.59s-16.04 3.13-21.57 8.59c-5.81 5.74-8.72 13.74-8.72 23.99 0 7.54 0.6 19.95 1.8 37.25l6.42 88.75z"/>\n\t\t\t<circle id="circle2237" cy="430.79" cx="313.94" r="30.747"/>\n\t\t</svg>')}(26,28)+" If nodes are in different regions, obtaining majority heartbeat is expensive. Query has high latency."),this.animationState=A.a.ANIMATION_STATE_FINISHED,this.setState({animationFinished:!0}),e({animationState:this.animationState,delay:100});break;case A.a.ANIMATION_STATE_FINISHED:e({animationState:this.animationState,delay:100});break;default:console.error("Unrecognized state: "+this.animationState),t("Unrecognized state: "+this.animationState)}}},{key:"onPrevious",value:function(){var e=this;return new Promise(function(t,n){e.onPreviousInternal(t,n)})}},{key:"onPreviousInternal",value:function(e,t){var n=this,a=document.getElementById("node-a-term-text-rect"),i=document.getElementById("node-b-term-text-rect"),s=document.getElementById("node-c-term-text-rect"),o=document.getElementById("node-a-term-text"),d=document.getElementById("node-b-term-text"),r=document.getElementById("node-c-term-text"),l=document.getElementById("node-a-extra-text"),m=document.getElementById("node-b-extra-text"),c=document.getElementById("node-c-extra-text"),E=document.getElementById("node-a-text-highlight"),u=document.getElementById("node-b-text-highlight"),g=document.getElementById("node-c-text-highlight"),h=document.getElementById("client-message-bubble");switch(this.animationState){case"ANIMATION_STATE_EXPLAIN_PROTOCOL":this.changeMainText(""),this.animationState=A.a.ANIMATION_STATE_INITIAL,e({animationState:A.a.ANIMATION_STATE_INITIAL,delay:100});break;case"ANIMATION_STATE_LEADER_ELECTION":f.hideElement(a),f.hideElement(i),f.hideElement(s),f.showElement(this.mainTextSect),this.changeMainText("Let\u2019s say we have a 3-node raft group.",function(){n.animationState="ANIMATION_STATE_EXPLAIN_PROTOCOL"}),e({animationState:"ANIMATION_STATE_EXPLAIN_PROTOCOL",delay:100});break;case"ANIMATION_STATE_NODE_DATA":document.getElementById("node-c-circle").classList.remove("leader-node"),f.hideElement(document.getElementById("node-c-message-bubble")),f.hideElement(document.getElementById("node-c-message-status")),document.getElementById("node-c-message-status-text1").innerHTML="",document.getElementById("node-c-message-status-text2").innerHTML="",o.innerHTML="",d.innerHTML="",r.innerHTML="",l.innerHTML="",m.innerHTML="",c.innerHTML="",this.changeMainText("Nodes would have performed leader election..",function(){l.innerHTML="Voted For C",m.innerHTML="Voted For C",c.innerHTML="Voted For C"}),this.animationState="ANIMATION_STATE_LEADER_ELECTION",e({animationState:"ANIMATION_STATE_LEADER_ELECTION",delay:100});break;case"ANIMATION_STATE_CLIENT_INTRODUCED":this.changeMainText(""),document.getElementById("node-c-circle").classList.remove("leader-node"),f.hideElement(E),f.hideElement(u),f.hideElement(g),l.innerHTML="Voted for C",m.innerHTML="Voted for C",c.innerHTML="Voted for C",f.showElement(document.getElementById("node-c-message-bubble")),f.showElement(document.getElementById("node-c-message-status"));var I={index:0,str:"C is the current raft leader,"},y={index:0,str:"denoted by the black border."},x=document.getElementById("node-c-message-status-text1"),_=document.getElementById("node-c-message-status-text2");Object(T.a)({targets:I,index:I.str.length,easing:"linear",duration:600,update:function(){x.innerHTML=I.str.substr(0,I.index)},complete:function(){Object(T.a)({targets:y,index:y.str.length,easing:"linear",duration:900,update:function(){_.innerHTML=y.str.substr(0,y.index)},complete:function(){document.getElementById("node-c-circle").classList.add("leader-node"),o.innerHTML="Term: 1",d.innerHTML="Term: 1",r.innerHTML="Term: 1",n.animationState="ANIMATION_STATE_NODE_DATA",e({animationState:"ANIMATION_STATE_NODE_DATA",delay:100})}})}});break;case"ANIMATION_STATE_PERFORMED_READ_ON_LEADER":f.hideElement(document.getElementById("client-query-message")),f.hideElement(h),f.hideClient(),document.getElementById("client-query-message-text1").innerHTML="",document.getElementById("client-query-message-text2").innerHTML="",this.changeMainText("Assume all nodes have data: <br />(key,value) = (k, V1)",function(){f.showElement(E),f.showElement(u),f.showElement(g),n.animationState="ANIMATION_STATE_CLIENT_INTRODUCED",e({animationState:"ANIMATION_STATE_CLIENT_INTRODUCED",delay:100})});break;case"ANIMATION_STATE_LEADER_RECEIVED_MAJORITY_ON_VALUE_FROM_FOLLOWERS":var N=document.getElementById("node-c-message-status");f.hideElement(document.getElementById("node-c-message-bubble")),f.hideElement(N),document.getElementById("node-c-message-status-text1").innerHTML="",document.getElementById("node-c-message-status-text2").innerHTML="";var L=f.introduceClient("");this.changeMainText(""),L.finished.then(function(){f.hideElement(E),f.hideElement(u),f.hideElement(g),f.showElement(document.getElementById("client-message"));var t=document.getElementById("client-query-message");document.getElementById("client-query-message-text1");var a={index:0,str:"SELECT value"},i={index:0,str:"FROM T WHERE key = k"},s=document.getElementById("client-query-message-text1"),o=document.getElementById("client-query-message-text2");f.showElement(h),f.showElement(t),Object(T.a)({targets:a,index:a.str.length,easing:"linear",duration:600,update:function(){s.innerHTML=a.str.substr(0,a.index)},complete:function(){Object(T.a)({targets:i,index:i.str.length,easing:"linear",duration:900,update:function(){o.innerHTML=i.str.substr(0,i.index)},complete:function(){f.sendLogMessage(A.a.CLIENT_NODE,A.a.NODE_C,!1).finished.then(function(){n.animationState="ANIMATION_STATE_PERFORMED_READ_ON_LEADER",e({animationState:"ANIMATION_STATE_PERFORMED_READ_ON_LEADER",delay:100})})}})}})});break;case"ANIMATION_STATE_CLIENT_FINISH_OPERATION":var O=document.getElementById("node-c-message-status-text1"),b=document.getElementById("node-c-message-status-text2");f.hideElement(document.getElementById("client-node-value")),O.innerHTML="",b.innerHTML="";var S={index:0,str:"Per raft protocol, leader should"},M={index:0,str:"obtain majority heartbeat."};Object(T.a)({targets:S,index:S.str.length,easing:"linear",duration:800,update:function(){O.textContent=S.str.substr(0,S.index)},complete:function(){Object(T.a)({targets:M,index:M.str.length,easing:"linear",duration:1040,update:function(){b.textContent=M.str.substr(0,M.index)},complete:function(){return f.logMessageFromLeaderToFollowers(!1)}}),n.animationState="ANIMATION_STATE_LEADER_RECEIVED_MAJORITY_ON_VALUE_FROM_FOLLOWERS",e({animationState:n.animationState,delay:100})}});break;case A.a.ANIMATION_STATE_FINISHED:this.changeMainText(""),f.hideElement(document.getElementById("client-node-value")),document.getElementById("node-c-message-status-text1").innerHTML="",document.getElementById("node-c-message-status-text2").innerHTML="",this.setState({animationFinished:!1}),f.logMessageAckFromFollowersToLeader()[0].finished.then(function(){var t=document.getElementById("node-c-message-status");f.showElement(document.getElementById("node-c-message-bubble")),f.showElement(t);var a={index:7,str:"Majority heartbeat obtained,"},i={index:0,str:"raft leader can serve read."},s=document.getElementById("node-c-message-status-text1"),o=document.getElementById("node-c-message-status-text2");Object(T.a)({targets:a,index:a.str.length,easing:"linear",duration:800,update:function(){s.textContent=a.str.substr(0,a.index)},complete:function(){Object(T.a)({targets:i,index:i.str.length,easing:"linear",duration:1080,update:function(){o.textContent=i.str.substr(0,i.index)},complete:function(){f.sendLogMessage(A.a.NODE_C,A.a.CLIENT_NODE).finished.then(function(){f.setSVGText({targetId:"client-node-value",text:"value: ".concat("V1"),showElement:!0}),n.animationState="ANIMATION_STATE_CLIENT_FINISH_OPERATION",e({animationState:n.animationState,delay:100})})}})}})});break;default:console.error("Unrecognized state or unimplemented: "+this.animationState),t("Unrecognized state or unimplemented: "+this.animationState)}}},{key:"changeMainText",value:function(e,t){f.setTextWithAnimation(this.mainTextSect,e,t)}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",{id:"main-diagram"},i.a.createElement(O,null)))}}]),t}(a.Component),B=n(13),C=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).animationState=A.a.ANIMATION_STATE_INITIAL,n.state={previousEnabled:!0},n.init(),n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"init",value:function(){this.nodeATimerAnimation=null,this.nodeBTimerAnimation=null,this.nodeCTimerAnimation=null}},{key:"componentDidMount",value:function(){this.mainTextSect=document.getElementById("center-message-text"),this.timersAreActive=!1}},{key:"pause",value:function(){this.timersAreActive&&this.pauseTimers()}},{key:"resume",value:function(){this.timersAreActive&&this.resumeTimers()}},{key:"onNext",value:function(){var e=this;return new Promise(function(t,n){e.onNextInternal(t,n)})}},{key:"onNextInternal",value:function(e,t){var n=this,a=document.getElementById("node-a-term-text-rect"),i=document.getElementById("node-b-term-text-rect"),s=document.getElementById("node-c-term-text-rect"),o=document.getElementById("node-a-term-text"),d=document.getElementById("node-b-term-text"),r=document.getElementById("node-c-term-text"),l=document.getElementById("node-a-term-highlight"),m=document.getElementById("node-b-term-highlight"),c=document.getElementById("node-a-extra-text"),E=document.getElementById("node-b-extra-text"),u=document.getElementById("node-c-extra-text"),g=document.getElementById("node-a-text-highlight"),h=document.getElementById("node-b-text-highlight"),I=document.getElementById("node-a-extra-text2"),y=document.getElementById("node-b-extra-text2"),x=document.getElementById("node-a-message-bubble"),_=document.getElementById("node-a-message-status"),N=document.getElementById("node-c-message-bubble"),L=document.getElementById("node-c-message-status"),O=document.getElementById("client-message-bubble"),b=document.getElementById("client-query-message"),S=document.getElementById("client-message-status"),f=document.getElementById("client-message-status-bg");switch(this.animationState){case A.a.ANIMATION_STATE_INITIAL:for(var M=document.getElementsByClassName("node-outer-circle"),C=0;C<M.length;C++)B.hideElement(M[C]);this.changeMainText("Let's say we have a 3-node raft group.<br />C is the raft leader, all nodes have data <br />k = V1",function(){document.getElementById("node-c-circle").classList.add("leader-node"),B.showElement(a),B.showElement(i),B.showElement(s),B.showElement(o),B.showElement(d),B.showElement(r),B.showElement(c),B.showElement(E),B.showElement(u),o.innerHTML="Term: 1",d.innerHTML="Term: 1",r.innerHTML="Term: 1",c.innerHTML="(k, V1)",E.innerHTML="(k, V1)",u.innerHTML="(k, V1)",n.animationState="ANIMATION_STATE_LEADER_READS_PROTOCOL",e({animationState:n.animationState,delay:1e3})});break;case"ANIMATION_STATE_LEADER_READS_PROTOCOL":this.changeMainText("This sequence shows how to safely perform reads from the leader using leader leases.",function(){n.animationState="ANIMATION_STATE_START_LEADER_LEASE",e({animationState:n.animationState,delay:1e3})});break;case"ANIMATION_STATE_START_LEADER_LEASE":this.changeMainText(""),B.showElement(N),B.showElement(L);var D=document.getElementById("node-c-message-status-text1"),v=document.getElementById("node-c-message-status-text2"),p={index:0,str:"Raft leader starts a"},R={index:0,str:"new lease timer for itself."};Object(T.a)({targets:p,index:p.str.length,easing:"linear",duration:600,update:function(){D.textContent=p.str.substr(0,p.index)},complete:function(){Object(T.a)({targets:R,index:R.str.length,easing:"linear",duration:600,update:function(){v.textContent=R.str.substr(0,R.index)},complete:function(){n.timersAreActive=!0,n.nodeCTimerAnimation=B.startMyLeaseTimer(A.a.NODE_C,{duration:3e3,targetPercent:90,disableAutoPlay:!0}),n.nodeCTimerAnimation.play(),n.animationState="ANIMATION_STATE_LEADER_REPLICATES_LEASE",e({animationState:n.animationState,delay:100,asyncAnimation:!0})}})}});break;case"ANIMATION_STATE_LEADER_REPLICATES_LEASE":this.nodeCTimerAnimation.seek(0),B.hideElement(N),B.hideElement(L),B.showElement(document.getElementById("node-c-message-bubble-alt"));var w=document.getElementById("node-c-message-text-alt"),k=document.getElementById("node-c-lease-to-node-a"),H={index:0,str:"Raft leader then replicates a\nlease interval to followers. Note\nthe lease timer on C has started\nbefore replicating to A and B."},P=Object(T.a)({targets:H,index:H.str.length,easing:"linear",duration:2500,update:function(){w.innerText=H.str.substr(0,H.index)}}),j=Object(T.a)({targets:k,translateX:-280,translateY:0,easing:"linear",duration:1500,begin:function(){B.showElement(k)},complete:function(){B.hideElement(k),k.style.transform="none"}});this.nodeCTimerAnimation=B.startMyLeaseTimer(A.a.NODE_C,{duration:5e3,targetPercent:60,startPercent:90});var V=document.getElementById("node-c-lease-to-node-b"),F=Object(T.a)({targets:V,translateX:-150,translateY:-280,easing:"linear",duration:1500,begin:function(){B.showElement(V)},complete:function(){B.hideElement(V),V.style.transform="none"}});Promise.all([P.finished,j.finished,F.finished,this.nodeCTimerAnimation]).then(function(){n.nodeATimerAnimation=B.startLeaderLeaseTimer(A.a.NODE_A,{duration:3e3,targetPercent:85}),n.nodeBTimerAnimation=B.startLeaderLeaseTimer(A.a.NODE_B,{duration:3e3,targetPercent:90}),n.animationState="ANIMATION_STATE_LEADER_LEASE_DURATION",e({animationState:n.animationState,delay:500,asyncAnimation:!0})});break;case"ANIMATION_STATE_LEADER_LEASE_DURATION":B.hideElement(document.getElementById("node-c-message-bubble-alt")),document.getElementById("node-c-message-text-alt").innerHTML="",this.changeMainText("Any new leader must wait out the existing Leader Lease duration before acquiring lease.",function(){n.animationState="ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED",e({animationState:n.animationState,delay:100})});break;case"ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED":this.changeMainText("Now suppose the original leader gets network partitioned",function(){B.partitionNodeC(),n.animationState="ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED",e({animationState:n.animationState,delay:100})});break;case"ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED":this.changeMainText(""),B.showElement(x),B.showElement(document.getElementById("node-a-message-status-bg"));var U={index:0,str:"A wins new leader election\n but cannot perform any\noperations until Leader\nLease on A runs out."};Object(T.a)({targets:U,index:U.str.length,easing:"linear",duration:1500,update:function(){_.innerText=U.str.substr(0,U.index)},complete:function(){document.getElementById("node-a-circle").classList.add("leader-candidate-node"),B.setSVGText({targetId:"node-a-term-text",text:"Term: 2"}),B.setSVGText({targetId:"node-b-term-text",text:"Term: 2"}),B.showElement(l),B.showElement(m),n.animationState="ANIMATION_STATE_CLIENT_UPDATE_FAILS",e({animationState:n.animationState,delay:100})}});break;case"ANIMATION_STATE_CLIENT_UPDATE_FAILS":B.hideElement(x),B.hideElement(document.getElementById("node-a-message-status-bg")),_.innerHTML="",B.hideElement(l),B.hideElement(m),this.changeMainText("If client tries to write to A, operation is rejected..",function(){B.introduceClient(),B.showElement(O),B.showElement(f),B.showElement(b);var t={index:0,str:"UPDATE T SET"},a={index:0,str:"value = V2 WHERE"},i={index:0,str:" key = k"},s=document.getElementById("client-query-message-text1"),o=document.getElementById("client-query-message-text2"),d=document.getElementById("client-query-message-text3");Object(T.a)({targets:t,index:t.str.length,easing:"linear",duration:400,update:function(){s.textContent=t.str.substr(0,t.index)},complete:function(){Object(T.a)({targets:a,index:a.str.length,easing:"linear",duration:400,update:function(){o.textContent=a.str.substr(0,a.index)},complete:function(){Object(T.a)({targets:i,index:i.str.length,easing:"linear",duration:400,update:function(){d.textContent=i.str.substr(0,i.index)},complete:function(){var t=document.getElementById("client-message"),a=document.getElementById("client-message-circle");B.messageFromClient(A.a.NODE_A,{onBegin:function(){B.showElement(t),a.classList.add("log-message"),B.setSVGText({targetId:"client-message-text",text:""})},onChangeComplete:function(){a.classList.remove("log-message"),a.classList.add("error-message"),B.setSVGText({targetId:"client-message-text",text:"Rejected"})},onComplete:function(){a.classList.remove("error-message"),B.hideElement(t),t.style.transform="none",B.setSVGText({targetId:"client-message-text",text:""}),B.showElement(document.getElementById("client-node-value-alt")),document.getElementById("client-node-value-error-header").innerHTML="Query Rejected:",document.getElementById("client-node-value-error-subtitle").innerHTML="Cannot find raft leader"},alternate:!0}),n.animationState="ANIMATION_STATE_OLD_LEADER_STILL_READABLE",e({animationState:n.animationState,delay:100})}})}})}})});break;case"ANIMATION_STATE_OLD_LEADER_STILL_READABLE":this.changeMainText(""),B.hideElement(document.getElementById("client-query-message")),B.hideElement(document.getElementById("client-node-value-alt"));var q={index:0,str:"Client can still read from C and get a valid response. Writes, however, are unavailable at this moment."};Object(T.a)({targets:q,index:q.str.length,easing:"linear",duration:2e3,update:function(){S.textContent=q.str.substr(0,q.index)},complete:function(){B.hideElement(document.getElementById("client-node-value-alt")),n.animationState="ANIMATION_STATE_OLD_LEASE_EXPIRES",e({animationState:n.animationState,delay:100})}});break;case"ANIMATION_STATE_OLD_LEASE_EXPIRES":B.hideElement(O),document.getElementById("client-message-status").innerHTML="",B.showElement(document.getElementById("node-c-message-bubble-alt"));var G=document.getElementById("node-c-message-text-alt"),W={index:0,str:"Leader Lease of C will run out\nfirst [since it started first]. \nC now steps down as leader."};this.nodeATimerAnimation=B.startLeaderLeaseTimer(A.a.NODE_A,{duration:6e3,startPercent:85,targetPercent:35}),this.nodeBTimerAnimation=B.startLeaderLeaseTimer(A.a.NODE_B,{duration:6e3,startPercent:90,targetPercent:40}),this.nodeCTimerAnimation=B.startMyLeaseTimer(A.a.NODE_C,{duration:6e3,startPercent:60}),Object(T.a)({targets:W,index:W.str.length,easing:"linear",duration:2e3,update:function(){G.textContent=W.str.substr(0,W.index)}}),this.nodeCTimerAnimation.finished.then(function(){document.getElementById("node-c-circle").classList.remove("leader-node"),n.animationState="ANIMATION_STATE_NEW_LEADER_ELECTED",e({animationState:n.animationState,delay:100,asyncAnimation:!0})});break;case"ANIMATION_STATE_NEW_LEADER_ELECTED":B.hideElement(document.getElementById("node-c-message-bubble-alt")),document.getElementById("node-c-message-text-alt").innerHTML="",B.showElement(document.getElementById("node-a-message-bubble")),B.showElement(document.getElementById("node-a-message-status-bg"));var Y=document.getElementById("node-a-message-status"),z={index:0,str:"Once Leader Lease on A expires, it becomes raft leader."};Object(T.a)({targets:z,index:z.str.length,easing:"linear",duration:800,update:function(){Y.textContent=z.str.substr(0,z.index)},complete:function(){n.nodeATimerAnimation=B.startLeaderLeaseTimer(A.a.NODE_A,{duration:2500,startPercent:35}),n.nodeBTimerAnimation=B.startLeaderLeaseTimer(A.a.NODE_B,{duration:2500,targetPercent:10,startPercent:40,disableAutoPlay:!0}),n.nodeBTimerAnimation.play(),n.nodeATimerAnimation.finished.then(function(){var t=document.getElementById("node-a-circle");B.showElement(document.getElementById("node-a-timer-highlight")),t.classList.remove("leader-candidate-node"),t.classList.add("leader-node"),B.hideElement(document.getElementById(B.leaderLeaseTimerId(A.a.NODE_A))),n.nodeATimerAnimation=B.startMyLeaseTimer(A.a.NODE_A,{duration:3e3,targetPercent:60});var a=document.getElementById("node-a-lease-to-node-b");Object(T.a)({targets:a,translateX:150,translateY:-280,easing:"linear",duration:1500,begin:function(){B.showElement(a)},complete:function(){B.hideElement(a),a.style.transform="none",n.nodeBTimerAnimation=B.startLeaderLeaseTimer(A.a.NODE_B,{duration:2500,targetPercent:80}),n.animationState="ANIMATION_STATE_NEW_LEADER_SENT_LEASES",e({animationState:n.animationState,delay:100,asyncAnimation:!0})}})})}});break;case"ANIMATION_STATE_NEW_LEADER_SENT_LEASES":B.hideElement(document.getElementById("node-a-message-bubble")),B.hideElement(document.getElementById("node-a-message-status-bg")),B.hideElement(document.getElementById("node-a-timer-highlight")),document.getElementById("node-a-message-status").innerHTML="",B.showElement(O);var X=document.getElementById("client-message-status"),J={index:0,str:"From here on, client can issue reads/writes to the new leader."};Object(T.a)({targets:J,index:J.str.length,easing:"linear",duration:2e3,update:function(){X.textContent=J.str.substr(0,J.index)},complete:function(){n.nodeATimerAnimation.restart(),B.sendLogMessage(A.a.CLIENT_NODE,A.a.NODE_A,!1,!1,"(k, V2)").finished.then(function(){c.innerHTML="(k, V2)",B.sendLogMessage(A.a.NODE_A,A.a.NODE_B,!0,!1,"(k, V2)",!1,0,n.nodeBTimerAnimation,n.nodeATimerAnimation).finished.then(function(){E.innerHTML="(k, V2)",B.hideElement(I),B.showElement(g);var t=B.startLeaderLeaseTimer(A.a.NODE_B,{duration:2500,startPercent:100,targetPercent:80}),a=B.sendLogMessage(A.a.NODE_A,A.a.CLIENT_NODE,!1,!1,"",!0),i=B.sendLogMessage(A.a.NODE_A,A.a.NODE_B,!1,!1,"",!0,300,t);Promise.all([a.finished,i.finished]).then(function(){B.hideElement(y),E.innerHTML="(k, V2)",B.showElement(h),n.animationState="ANIMATION_STATE_LEADER_LEASE_CONCLUSION",n.stopTimers(),e({animationState:n.animationState,delay:100})})})})}});break;case"ANIMATION_STATE_LEADER_LEASE_CONCLUSION":B.hideElement(g),B.hideElement(h),B.hideElement(O),B.hideElement(f),document.getElementById("client-message-status").innerHTML="",this.changeMainText("Leader Leases ensure low latency reads even when nodes are across regions.",function(){n.animationState=A.a.ANIMATION_STATE_FINISHED,n.stopTimers(),n.setState({animationFinished:!0}),e({animationState:n.animationState,delay:100})});break;case A.a.ANIMATION_STATE_FINISHED:console.log("Animation finished. Nothing to do"),e({animationState:this.animationState,delay:100});break;default:console.error("Unrecognized state: "+this.animationState),t("Unrecognized state")}}},{key:"onPrevious",value:function(){var e=this;return new Promise(function(t,n){e.onPreviousInternal(t,n)})}},{key:"onPreviousInternal",value:function(e,t){var n=this,a=document.getElementById("node-a-term-text-rect"),i=document.getElementById("node-b-term-text-rect"),s=document.getElementById("node-c-term-text-rect"),o=document.getElementById("node-a-term-text"),d=document.getElementById("node-b-term-text"),r=document.getElementById("node-c-term-text"),l=document.getElementById("node-a-term-highlight"),m=document.getElementById("node-b-term-highlight"),c=document.getElementById("node-a-extra-text"),E=document.getElementById("node-b-extra-text"),u=document.getElementById("node-c-extra-text"),g=document.getElementById("node-a-text-highlight"),h=document.getElementById("node-b-text-highlight"),I=document.getElementById("node-a-extra-text2"),y=document.getElementById("node-b-extra-text2"),x=document.getElementById("node-a-message-bubble"),_=document.getElementById("node-a-message-status"),N=document.getElementById("node-c-message-bubble"),L=document.getElementById("node-c-message-status"),O=document.getElementById("client-message-bubble"),b=document.getElementById("client-query-message"),S=document.getElementById("client-message-status"),f=document.getElementById("client-message-status-bg");switch(this.animationState){case"ANIMATION_STATE_LEADER_READS_PROTOCOL":B.hideElement(o),B.hideElement(d),B.hideElement(r),B.hideElement(c),B.hideElement(E),B.hideElement(u),document.getElementById("node-c-circle").classList.remove("leader-node"),this.changeMainText(""),this.animationState=A.a.ANIMATION_STATE_INITIAL,e({animationState:this.animationState,delay:1e3});break;case"ANIMATION_STATE_START_LEADER_LEASE":B.hideElement(o),B.hideElement(d),B.hideElement(r),B.hideElement(c),B.hideElement(E),B.hideElement(u);var M=document.getElementById("node-c-circle");M.classList.remove("leader-node");for(var C=document.getElementsByClassName("node-outer-circle"),D=0;D<C.length;D++)B.hideElement(C[D]);this.changeMainText("Let's say we have a 3-node raft group.<br />C is the raft leader, all nodes have data <br />k = V1",function(){M.classList.add("leader-node"),B.showElement(a),B.showElement(i),B.showElement(s),B.showElement(o),B.showElement(d),B.showElement(r),B.showElement(c),B.showElement(E),B.showElement(u),o.innerHTML="Term: 1",d.innerHTML="Term: 1",r.innerHTML="Term: 1",c.innerHTML="(k, V1)",E.innerHTML="(k, V1)",u.innerHTML="(k, V1)",n.animationState="ANIMATION_STATE_LEADER_READS_PROTOCOL",e({animationState:n.animationState,delay:1e3})});break;case"ANIMATION_STATE_LEADER_REPLICATES_LEASE":B.hideElement(N),document.getElementById("node-c-message-status-text1").innerHTML="",document.getElementById("node-c-message-status-text2").innerHTML="",B.hideElement(document.getElementById("mlease-rect-node-c")),this.changeMainText("This sequence shows how to safely perform reads from the leader using leader leases.",function(){n.animationState="ANIMATION_STATE_START_LEADER_LEASE",e({animationState:n.animationState,delay:1e3})});break;case"ANIMATION_STATE_LEADER_LEASE_DURATION":B.hideElement(document.getElementById("llease-rect-node-a")),B.hideElement(document.getElementById("llease-rect-node-b")),B.hideElement(document.getElementById("node-c-message-bubble-alt")),B.hideElement(document.getElementById("mlease-rect-node-c")),document.getElementById("node-c-message-text-alt").innerHTML="",this.changeMainText(""),B.showElement(N),B.showElement(L);var v=document.getElementById("node-c-message-status-text1");v.innerHTML="";var p=document.getElementById("node-c-message-status-text2");p.innerHTML="";var R={index:0,str:"Raft leader starts a"},w={index:0,str:"new lease timer for itself."};Object(T.a)({targets:R,index:R.str.length,easing:"linear",duration:600,update:function(){v.textContent=R.str.substr(0,R.index)},complete:function(){Object(T.a)({targets:w,index:w.str.length,easing:"linear",duration:600,update:function(){p.textContent=w.str.substr(0,w.index)},complete:function(){n.timersAreActive=!0,B.startMyLeaseTimer(A.a.NODE_C,{duration:3e3,targetPercent:90}),n.animationState="ANIMATION_STATE_LEADER_REPLICATES_LEASE",e({animationState:n.animationState,delay:100,asyncAnimation:!0})}})}});break;case"ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED":this.changeMainText(""),B.hideElement(N),B.hideElement(L),B.showElement(document.getElementById("node-c-message-bubble-alt")),B.hideElement(document.getElementById("llease-rect-node-a")),B.hideElement(document.getElementById("llease-rect-node-b"));var k=document.getElementById("node-c-message-text-alt"),H=document.getElementById("node-c-lease-to-node-a"),P={index:0,str:"Raft leader then replicates a\nlease interval to followers. Note\nthe lease timer on C has started\nbefore replicating to A and B."},j=Object(T.a)({targets:P,index:P.str.length,easing:"linear",duration:2500,update:function(){k.innerText=P.str.substr(0,P.index)}}),V=Object(T.a)({targets:H,translateX:-280,translateY:0,easing:"linear",duration:1500,begin:function(){B.showElement(H)},complete:function(){B.hideElement(H),H.style.transform="none"}});this.nodeCTimerAnimation=B.startMyLeaseTimer(A.a.NODE_C,{duration:5e3,targetPercent:60,startPercent:90}),this.nodeCTimerAnimation.restart();var F=document.getElementById("node-c-lease-to-node-b"),U=Object(T.a)({targets:F,translateX:-150,translateY:-280,easing:"linear",duration:1500,begin:function(){B.showElement(F)},complete:function(){B.hideElement(F),F.style.transform="none"}});Promise.all([j.finished,V.finished,U.finished,this.nodeCTimerAnimation]).then(function(){n.nodeATimerAnimation=B.startLeaderLeaseTimer(A.a.NODE_A,{duration:3e3,targetPercent:85}),n.nodeBTimerAnimation=B.startLeaderLeaseTimer(A.a.NODE_B,{duration:3e3,targetPercent:90}),console.log(n.nodeBTimerAnimation),n.nodeATimerAnimation.restart(),n.nodeBTimerAnimation.restart(),n.animationState="ANIMATION_STATE_LEADER_LEASE_DURATION",e({animationState:n.animationState,delay:1e3,asyncAnimation:!0})});break;case"ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED":this.changeMainText(""),B.hideElement(document.getElementById("node-c-partition-wrap")),this.changeMainText("Any new leader must wait out existing Leader Lease duration before acquiring lease.",function(){n.animationState="ANIMATION_STATE_ORIGINAL_LEADER_PARITIONED",e({animationState:n.animationState,delay:1e3})});break;case"ANIMATION_STATE_CLIENT_UPDATE_FAILS":B.hideElement(l),B.hideElement(m),B.hideElement(x),B.hideElement(document.getElementById("node-c-partition-wrap")),B.hideElement(document.getElementById("node-a-message-status-bg")),document.getElementById("node-a-message-status").innerHTML="",document.getElementById("node-a-circle").classList.remove("leader-candidate-node"),this.changeMainText("Now suppose the original leader gets network partitioned",function(){B.partitionNodeC(),n.animationState="ANIMATION_STATE_NEW_LEADER_CANDIDATE_ELECTED",e({animationState:n.animationState,delay:100})});break;case"ANIMATION_STATE_OLD_LEADER_STILL_READABLE":document.getElementById("node-a-circle").classList.remove("leader-candidate-node"),B.hideElement(O),B.hideElement(b),document.getElementById("client-query-message-text1").innerHTML="",document.getElementById("client-query-message-text2").innerHTML="",document.getElementById("client-query-message-text3").innerHTML="",B.hideElement(document.getElementById("client-node")),B.hideElement(document.getElementById("client-node-value-alt")),document.getElementById("client-message-text").innerHTML="",this.changeMainText(""),B.showElement(x),B.showElement(document.getElementById("node-a-message-status-bg"));var q={index:0,str:"A wins new leader election\n but cannot perform any\noperations until Leader\nLease on A runs out."};Object(T.a)({targets:q,index:q.str.length,easing:"linear",duration:1500,update:function(){_.innerText=q.str.substr(0,q.index)},complete:function(){document.getElementById("node-a-circle").classList.add("leader-candidate-node"),B.setSVGText({targetId:"node-a-term-text",text:"Term: 2"}),B.setSVGText({targetId:"node-b-term-text",text:"Term: 2"}),B.showElement(l),B.showElement(m),n.animationState="ANIMATION_STATE_CLIENT_UPDATE_FAILS",e({animationState:n.animationState,delay:100})}});break;case"ANIMATION_STATE_OLD_LEASE_EXPIRES":S.innerHTML="",B.hideElement(O),B.hideElement(document.getElementById("client-node")),document.getElementById("client-message-text").innerHTML="",document.getElementById("client-query-message-text1").innerHTML="",document.getElementById("client-query-message-text2").innerHTML="",document.getElementById("client-query-message-text3").innerHTML="",this.changeMainText("If client tries to write to A, operation is rejected..",function(){B.introduceClient(),B.showElement(O),B.showElement(f),B.showElement(b);var t={index:0,str:"UPDATE T SET"},a={index:0,str:"value = V2 WHERE"},i={index:0,str:" key = k"},s=document.getElementById("client-query-message-text1"),o=document.getElementById("client-query-message-text2"),d=document.getElementById("client-query-message-text3");Object(T.a)({targets:t,index:t.str.length,easing:"linear",duration:400,update:function(){s.textContent=t.str.substr(0,t.index)},complete:function(){Object(T.a)({targets:a,index:a.str.length,easing:"linear",duration:400,update:function(){o.textContent=a.str.substr(0,a.index)},complete:function(){Object(T.a)({targets:i,index:i.str.length,easing:"linear",duration:400,update:function(){d.textContent=i.str.substr(0,i.index)},complete:function(){var t=document.getElementById("client-message"),a=document.getElementById("client-message-circle");B.messageFromClient(A.a.NODE_A,{onBegin:function(){B.showElement(t),a.classList.add("log-message"),B.setSVGText({targetId:"client-message-text",text:""})},onChangeComplete:function(){a.classList.remove("log-message"),a.classList.add("error-message"),B.setSVGText({targetId:"client-message-text",text:"Rejected"})},onComplete:function(){a.classList.remove("error-message"),B.hideElement(t),t.style.transform="none",B.setSVGText({targetId:"client-message-text",text:""}),B.showElement(document.getElementById("client-node-value-alt"))},alternate:!0}),n.animationState="ANIMATION_STATE_OLD_LEADER_STILL_READABLE",e({animationState:n.animationState,delay:100})}})}})}})});break;case"ANIMATION_STATE_NEW_LEADER_ELECTED":this.changeMainText(""),B.hideElement(document.getElementById("client-query-message")),B.hideElement(document.getElementById("client-node-value-alt")),B.hideElement(document.getElementById("node-c-message-bubble-alt")),document.getElementById("node-c-message-text-alt").innerHTML="",document.getElementById("node-c-circle").classList.add("leader-node");var G={index:0,str:"Client can still read from C and get a valid response. Writes, however, are unavailable at this moment."};B.showElement(O),Object(T.a)({targets:G,index:G.str.length,easing:"linear",duration:2e3,update:function(){S.textContent=G.str.substr(0,G.index)},complete:function(){n.animationState="ANIMATION_STATE_OLD_LEASE_EXPIRES",e({animationState:n.animationState,delay:100})}});break;case"ANIMATION_STATE_NEW_LEADER_SENT_LEASES":B.hideElement(document.getElementById("node-a-timer-highlight")),B.hideElement(document.getElementById("node-a-message-bubble")),document.getElementById("node-c-circle").classList.add("leader-node"),document.getElementById("node-a-circle").classList.add("leader-candidate-node"),B.hideElement(x),document.getElementById("node-a-message-status").innerHTML="",B.hideElement(O),document.getElementById("client-message-status").innerHTML="",B.showElement(document.getElementById("node-c-message-bubble-alt"));var W=document.getElementById("node-c-message-text-alt"),Y={index:0,str:"Leader Lease of C will run out\nfirst [since it started first]. \nC now steps down as leader."};B.hideElement(document.getElementById("mlease-rect-node-a")),this.nodeATimerAnimation=B.startLeaderLeaseTimer(A.a.NODE_A,{duration:6e3,targetPercent:35}),this.nodeBTimerAnimation=B.startLeaderLeaseTimer(A.a.NODE_B,{duration:6e3,targetPercent:40}),this.nodeCTimerAnimation=B.startMyLeaseTimer(A.a.NODE_C,{duration:6e3}),Object(T.a)({targets:Y,index:Y.str.length,easing:"linear",duration:2e3,update:function(){W.textContent=Y.str.substr(0,Y.index)}}),this.nodeCTimerAnimation.finished.then(function(){document.getElementById("node-c-circle").classList.remove("leader-node"),n.animationState="ANIMATION_STATE_NEW_LEADER_ELECTED",e({animationState:n.animationState,delay:100,asyncAnimation:!0})});break;case"ANIMATION_STATE_LEADER_LEASE_CONCLUSION":B.hideElement(g),B.hideElement(h),B.hideElement(O);var z=document.getElementById("node-a-circle");z.classList.add("leader-candidate-node"),z.classList.remove("leader-node"),document.getElementById("client-message-status").innerHTML="",B.hideElement(document.getElementById("node-c-message-bubble-alt")),document.getElementById("node-c-message-text-alt").innerHTML="",B.showElement(document.getElementById("node-a-message-bubble")),B.showElement(document.getElementById("node-a-message-status-bg")),B.hideElement(document.getElementById("mlease-rect-node-a"));var X=document.getElementById("node-a-message-status"),J={index:0,str:"Once Leader Lease on A expires, it becomes raft leader."};Object(T.a)({targets:J,index:J.str.length,easing:"linear",duration:800,update:function(){X.textContent=J.str.substr(0,J.index)},complete:function(){n.nodeATimerAnimation=B.startLeaderLeaseTimer(A.a.NODE_A,{duration:2500,startPercent:35}),n.nodeBTimerAnimation=B.startLeaderLeaseTimer(A.a.NODE_B,{duration:2500,targetPercent:10,startPercent:40}),n.nodeATimerAnimation.finished.then(function(){z.classList.remove("leader-candidate-node"),z.classList.add("leader-node"),B.showElement(document.getElementById("node-a-timer-highlight")),B.hideElement(document.getElementById(B.leaderLeaseTimerId(A.a.NODE_A))),n.nodeATimerAnimation=B.startMyLeaseTimer(A.a.NODE_A,{duration:3e3,targetPercent:60});var t=document.getElementById("node-a-lease-to-node-b");Object(T.a)({targets:t,translateX:150,translateY:-280,easing:"linear",duration:1500,begin:function(){B.showElement(t)},complete:function(){B.hideElement(t),t.style.transform="none",n.nodeBTimerAnimation=B.startLeaderLeaseTimer(A.a.NODE_B,{duration:2500,targetPercent:80}),n.animationState="ANIMATION_STATE_NEW_LEADER_SENT_LEASES",e({animationState:n.animationState,delay:100,asyncAnimation:!0})}})})}});break;case A.a.ANIMATION_STATE_FINISHED:this.setState({animationFinished:!1}),this.changeMainText(""),document.getElementById("node-a-message-status").innerHTML="",B.showElement(document.getElementById("client-message-status-bg")),B.showElement(O);var Q=document.getElementById("client-message-status"),K={index:0,str:"From here on, client can issue reads/writes to the new leader."};Object(T.a)({targets:K,index:K.str.length,easing:"linear",duration:2e3,update:function(){Q.textContent=K.str.substr(0,K.index)},complete:function(){B.sendLogMessage(A.a.CLIENT_NODE,A.a.NODE_A,!1,!1,"(k, V2)").finished.then(function(){c.innerHTML="(k, V2)",B.sendLogMessage(A.a.NODE_A,A.a.NODE_B,!0,!1,"(k, V2)",!1,0,n.nodeBTimerAnimation,n.nodeATimerAnimation).finished.then(function(){E.innerHTML="(k, V2)",B.hideElement(I),B.showElement(g);var t=B.sendLogMessage(A.a.NODE_A,A.a.CLIENT_NODE,!1,!1,"",!0),a=B.sendLogMessage(A.a.NODE_A,A.a.NODE_B,!1,!1,"",!0,300,n.nodeBTimerAnimation);Promise.all([t.finished,a.finished]).then(function(){B.hideElement(y),E.innerHTML="(k, V2)",B.showElement(h),n.animationState="ANIMATION_STATE_LEADER_LEASE_CONCLUSION",e({animationState:n.animationState,delay:100})})})})}}),this.animationState="ANIMATION_STATE_LEADER_LEASE_CONCLUSION",e({animationState:this.animationState,delay:100});break;default:console.error("Unrecognized state: "+this.animationState)}}},{key:"changeMainText",value:function(e,t,n){B.setTextWithAnimation(this.mainTextSect,e,t,n)}},{key:"restartTimers",value:function(){this.nodeATimerAnimation&&this.nodeATimerAnimation.restart(),this.nodeBTimerAnimation&&this.nodeBTimerAnimation.restart(),this.nodeCTimerAnimation&&this.nodeCTimerAnimation.restart()}},{key:"stopTimers",value:function(){this.timersAreActive=!1,this.pauseTimers()}},{key:"pauseTimers",value:function(){this.nodeATimerAnimation&&this.nodeATimerAnimation.pause(),this.nodeBTimerAnimation&&this.nodeBTimerAnimation.pause(),this.nodeCTimerAnimation&&this.nodeCTimerAnimation.pause()}},{key:"resumeTimers",value:function(){this.nodeATimerAnimation&&this.nodeATimerAnimation.play(),this.nodeBTimerAnimation&&this.nodeBTimerAnimation.play(),this.nodeCTimerAnimation&&this.nodeCTimerAnimation.play()}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",{id:"main-diagram"},i.a.createElement(O,null)),i.a.createElement("div",{id:"main-text-sect"}))}}]),t}(a.Component),D=n(14),v=n(13),p=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).onPlayClicked=n.onPlayClicked.bind(Object(D.a)(n)),n.onPreviousClicked=n.onPreviousClicked.bind(Object(D.a)(n)),n.onRestartClicked=n.onRestartClicked.bind(Object(D.a)(n)),n.state={animationPlaying:!1},n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.mainTextSect=document.getElementById("main-text-sect"),setTimeout(function(){return e.next()},100)}},{key:"changeMainText",value:function(e,t){v.setTextWithAnimation(this.mainTextSect,e,t)}},{key:"next",value:function(){var e=this;this.setState({animationPlaying:!0}),this.currentAnimation.onNext().then(function(t){console.log("Result: "+JSON.stringify(t)),e.setState({animationPlaying:!1}),setTimeout(function(){"CONTINOUS"===e.runMode?(e.currentAnimation.resume(),e.next()):t.asyncAnimation||e.currentAnimation.pause()},t.delay?t.delay:A.a.DEFAULT_DELAY)})}},{key:"previous",value:function(){var e=this;this.setState({animationPlaying:!0}),this.currentAnimation.onPrevious().then(function(t){console.log("Undo: "+JSON.stringify(t)),e.setState({animationPlaying:!1}),setTimeout(function(){"CONTINOUS"===e.runMode?(e.currentAnimation.resume(),e.next()):e.currentAnimation.pause()},t.delay?t.delay:A.a.DEFAULT_DELAY)})}},{key:"onPlayClicked",value:function(){this.next()}},{key:"onRestartClicked",value:function(){this.restart()}},{key:"onPreviousClicked",value:function(){this.previous()}},{key:"restart",value:function(){window.location.reload()}},{key:"render",value:function(){var e=this,t=this.props.animationToRun,n=this.state.animationPlaying||this.currentAnimation&&this.currentAnimation.state.animationFinished,a=this.state.animationPlaying||this.currentAnimation&&!this.currentAnimation.state.previousEnabled||this.currentAnimation&&this.currentAnimation.animationState===A.a.ANIMATION_STATE_INITIAL,s=this.currentAnimation&&this.currentAnimation.state.animationFinished;return i.a.createElement("div",{className:"animation-runner"},i.a.createElement("div",{id:"main-text-sect"}),i.a.createElement(t,{ref:function(t){return e.currentAnimation=t}}),i.a.createElement("div",{className:"control-btns"},i.a.createElement("button",{id:"animation-ctrl-previous",className:"yb-btn",disabled:a,onClick:this.onPreviousClicked},i.a.createElement("i",{className:"fas fa-undo","aria-hidden":"true"}),i.a.createElement("span",{className:"yb-button-text"},"Previous")),i.a.createElement("button",{id:"animation-ctrl-next",className:"yb-btn",disabled:n,onClick:this.onPlayClicked},i.a.createElement("i",{className:"fas fa-play","aria-hidden":"true"}),i.a.createElement("span",{className:"yb-button-text"},s?"End":"Next")),i.a.createElement("button",{id:"animation-ctrl-restart",className:"yb-btn",onClick:this.onRestartClicked},i.a.createElement("i",{className:"fas fa-fast-backward","aria-hidden":"true"}),i.a.createElement("span",{className:"yb-button-text"},"Restart"))))}}]),t}(a.Component),R=n(13),w={INITIAL:"INITIAL",LEADER_ELECTION_NODE_TIMED_OUT:"LEADER_ELECTION_NODE_TIMED_OUT",LEADER_ELECTION_LEADER_HAS_VOTED_FOR_ITSELF:"LEADER_ELECTION_LEADER_HAS_VOTED_FOR_ITSELF",LEADER_ELECTION_LEADER_RECEIVED_VOTES_FROM_OTHER_NODES:"LEADER_ELECTION_LEADER_RECEIVED_VOTES_FROM_OTHER_NODES",LOG_REPLICATION_START:"LOG_REPLICATION_START",LOG_REPLICATION_INTRODUCE_CLIENT:"LOG_REPLICATION_INTRODUCE_CLIENT",LOG_REPLICATION_MESSAGE_RECEIVED_BY_LEADER:"LOG_REPLICATION_MESSAGE_RECEIVED_BY_LEADER",LOG_REPLICATION_LEADER_RECEIVED_ALL_LOG_ACKS:"LOG_REPLICATION_LEADER_RECEIVED_ALL_LOG_ACKS",LOG_REPLICATION_LEADER_HAS_COMMITTED_ENTRY:"LOG_REPLICATION_LEADER_HAS_COMMITTED_ENTRY",LOG_REPLICATION_FOLLOWERS_RECEIVED_COMMIT_MESSAGE_FROM_LEADER:"LOG_REPLICATION_FOLLOWERS_RECEIVED_COMMIT_MESSAGE_FROM_LEADER"},k=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(l.a)(this,Object(m.a)(t).call(this,e))).animationState=w.INITIAL,n.state={animationFinished:!1},n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"pause",value:function(){}},{key:"resume",value:function(){}},{key:"onNext",value:function(){var e=this;return new Promise(function(t,n){e.onNextInternal(t,n)})}},{key:"onNextInternal",value:function(e,t){var n=this;switch(this.animationState){case w.INITIAL:this.changeMainText("Leader election starts ..."),setTimeout(function(){n.changeMainText("If there is no leader, a election timeout is triggered");var t=document.getElementById("node-a-outer-circle");t.classList.add("animation-delay-3s"),t.classList.add("animate-circle-stroke");var a=document.getElementById("node-b-outer-circle");a.classList.add("animation-delay-2s"),a.classList.add("animate-circle-stroke");var i=document.getElementById("node-c-outer-circle");i.classList.add("animate-circle-stroke");var s=function(){t.classList.add("pause-animation"),a.classList.add("pause-animation"),i.style.display="none",n.animationState=w.LEADER_ELECTION_NODE_TIMED_OUT,e({animationState:n.animationState,delay:100})};i.addEventListener("webkitAnimationEnd",s,!1),i.addEventListener("animationend",s,!1)},A.a.DEFAULT_DELAY);break;case w.LEADER_ELECTION_NODE_TIMED_OUT:document.getElementById("node-c-outer-circle").classList.add("leader-candidate-node"),document.getElementById("node-c-extra-text").classList.remove("visibility-hidden"),this.changeMainText("After election timeout the follower becomes a candidate. It starts a new election term and votes for itself",function(){n.animationState=w.LEADER_ELECTION_LEADER_HAS_VOTED_FOR_ITSELF,e({animationState:n.animationState,delay:2e3})});break;case w.LEADER_ELECTION_LEADER_HAS_VOTED_FOR_ITSELF:var a=document.getElementById("node-c-message-to-b"),i=R.messageFromC(A.a.NODE_B,{onBegin:function(e){a.classList.add("vote-request-circle")},onChangeComplete:function(e){a.classList.remove("vote-request-circle"),a.classList.add("vote-ack-circle")},onComplete:function(e){a.classList.remove("vote-ack-circle")},alternate:!0}),s=document.getElementById("node-c-message-to-a"),o=R.messageFromC(A.a.NODE_A,{onBegin:function(e){s.classList.add("vote-request-circle")},onChangeComplete:function(e){s.classList.remove("vote-request-circle"),s.classList.add("vote-ack-circle")},onComplete:function(e){s.classList.remove("vote-ack-circle")},alternate:!0});Promise.all([i.finished,o.finished]).then(function(){n.animationState=w.LEADER_ELECTION_LEADER_RECEIVED_VOTES_FROM_OTHER_NODES,e({animationState:n.animationState,delay:1e3})});break;case w.LEADER_ELECTION_LEADER_RECEIVED_VOTES_FROM_OTHER_NODES:this.changeMainText("Once a candidate has majority of votes it becomes the leader"),document.getElementById("node-a-extra-text").classList.remove("visibility-hidden"),document.getElementById("node-b-extra-text").classList.remove("visibility-hidden"),document.getElementById("node-c-extra-text").textContent="Leader Node";var d=document.getElementById("node-c-outer-circle");d.classList.remove("leader-candidate-node"),d.classList.add("leader-node");var r=document.getElementById("node-a-outer-circle");R.hideElement(r);var l=document.getElementById("node-b-outer-circle");R.hideElement(l),this.animationState=w.LOG_REPLICATION_START,e({animationState:this.animationState,delay:2e3});break;case w.LOG_REPLICATION_START:for(var m=document.getElementsByClassName("node-extra-text"),c=0;c<m.length;c++)R.hideElement(m[c]);this.changeMainText("Log replication ..."),this.animationState=w.LOG_REPLICATION_INTRODUCE_CLIENT,e({animationState:this.animationState,delay:2e3});break;case w.LOG_REPLICATION_INTRODUCE_CLIENT:this.changeMainText("Clients always communicate with the leader."),R.introduceClient().finished.then(function(){R.sendLogMessage(A.a.CLIENT_NODE,A.a.NODE_C,!1,!1,R.getSetValueText("5")).finished.then(function(){n.animationState=w.LOG_REPLICATION_MESSAGE_RECEIVED_BY_LEADER,e({animationState:n.animationState,delay:1e3})})});break;case w.LOG_REPLICATION_MESSAGE_RECEIVED_BY_LEADER:this.changeMainText("The log entry is currently uncommitted, so it won't update the node's value. To commit the entry the node first replicates it to the follower nodes",function(){var t=R.logMessageFromLeaderToFollowers(!0,R.getSetValueText("5")),a=R.getFinishPromises(t);Promise.all(a).then(function(){n.animationState=w.LOG_REPLICATION_LEADER_RECEIVED_ALL_LOG_ACKS,e({animationState:n.animationState,delay:100})})});break;case w.LOG_REPLICATION_LEADER_RECEIVED_ALL_LOG_ACKS:this.changeMainText("Once the leader receives acks from majority of follower nodes, it commits the value and sets it state to '5'",function(){R.setSVGText({targetId:"node-c-extra-text",addCSSClass:"set-text-committed"}),R.setSVGText({targetId:"node-c-main-text",text:"5",showElement:!0}),n.animationState=w.LOG_REPLICATION_LEADER_HAS_COMMITTED_ENTRY,e({animationState:n.animationState,delay:1e3})});break;case w.LOG_REPLICATION_LEADER_HAS_COMMITTED_ENTRY:this.changeMainText("The leader then notifies followers and the client that entry is committed",function(){var t=R.logMessageFromLeaderToFollowers(!1,R.getSetValueText("5"),!0),a=R.getFinishPromises(t);R.sendLogMessage(A.a.NODE_C,A.a.CLIENT_NODE),Promise.all(a).then(function(){n.animationState=w.LOG_REPLICATION_FOLLOWERS_RECEIVED_COMMIT_MESSAGE_FROM_LEADER,e({animationState:n.animationState,delay:100})})});break;case w.LOG_REPLICATION_FOLLOWERS_RECEIVED_COMMIT_MESSAGE_FROM_LEADER:R.setSVGText({targetId:"node-a-main-text",text:"5",showElement:!0}),R.setSVGText({targetId:"node-b-main-text",text:"5",showElement:!0}),this.changeMainText("The cluster has now come to consensus about the system state"),this.animationState=A.a.ANIMATION_STATE_FINISHED,this.setState({animationFinished:!0}),e({animationState:this.animationState,delay:100});break;case A.a.ANIMATION_STATE_FINISHED:e({animationState:this.animationState,delay:100});break;default:console.error("Unrecognized state: "+this.animationState)}}},{key:"componentDidMount",value:function(){this.mainTextSect=document.getElementById("main-text-sect")}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",{id:"main-diagram"},i.a.createElement(O,null)),i.a.createElement("div",{id:"main-text-sect"}))}},{key:"changeMainText",value:function(e,t){R.setTextWithAnimation(this.mainTextSect,e,t)}}]),t}(a.Component),H=function(e){function t(){return Object(d.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return i.a.createElement(E.a,null,i.a.createElement("div",{className:"App"},i.a.createElement(u.a,{exact:!0,path:"/",component:P}),i.a.createElement(u.a,{path:"/raft-write-operation",render:function(e){return i.a.createElement(p,Object.assign({},e,{animationToRun:k}))}}),i.a.createElement(u.a,{path:"/why-raft-read-fails-without-quorum",render:function(e){return i.a.createElement(p,Object.assign({},e,{animationToRun:S}))}}),i.a.createElement(u.a,{path:"/raft-read-with-leader-leases",render:function(e){return i.a.createElement(p,Object.assign({},e,{animationToRun:C}))}}),i.a.createElement(u.a,{path:"/read-operation-in-raft",render:function(e){return i.a.createElement(p,Object.assign({},e,{animationToRun:M}))}})))}}]),t}(a.Component),P=function(e){function t(){return Object(d.a)(this,t),Object(l.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{id:"home-link-container"},i.a.createElement("h3",null,"Read:"),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement(g.a,{to:"/read-operation-in-raft"},"Read operation in raft")),i.a.createElement("li",null,i.a.createElement(g.a,{to:"/why-raft-read-fails-without-quorum"},"Why raft read failes without quorum")),i.a.createElement("li",null,i.a.createElement(g.a,{to:"/raft-read-with-leader-leases"},"Raft read with leader leases"))),i.a.createElement("h3",null,"Write:"),i.a.createElement("div",{class:"write-link-container"},i.a.createElement(g.a,{to:"/raft-write-operation"},"Raft write operation")))}}]),t}(a.Component),j=H;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(j,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[19,1,2]]]);
//# sourceMappingURL=main.f2e9c109.chunk.js.map